{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.updateHeaderFilterItemSelectionState = updateHeaderFilterItemSelectionState;\nexports.headerFilterMixin = exports.allowHeaderFiltering = exports.HeaderFilterView = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _uiGrid_core = _interopRequireDefault(require(\"./ui.grid_core.modules\"));\n\nvar _uiGrid_core2 = _interopRequireDefault(require(\"./ui.grid_core.utils\"));\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _popup = _interopRequireDefault(require(\"../popup\"));\n\nvar _tree_view = _interopRequireDefault(require(\"../tree_view\"));\n\nvar _list = _interopRequireDefault(require(\"../list\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\n\nfunction resetChildrenItemSelection(items) {\n  items = items || [];\n\n  for (var i = 0; i < items.length; i++) {\n    items[i].selected = false;\n    resetChildrenItemSelection(items[i].items);\n  }\n}\n\nfunction updateSelectAllState(e, filterValues) {\n  if (e.component.option(\"searchValue\")) {\n    return;\n  }\n\n  var selectAllCheckBox = (0, _renderer.default)(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\n\n  if (selectAllCheckBox && filterValues && filterValues.length) {\n    selectAllCheckBox.option(\"value\", void 0);\n  }\n}\n\nfunction isSearchEnabled(that, options) {\n  var headerFilter = options.headerFilter;\n\n  if (headerFilter && (0, _type.isDefined)(headerFilter.allowSearch)) {\n    return headerFilter.allowSearch;\n  }\n\n  return that.option(\"headerFilter.allowSearch\");\n}\n\nfunction updateHeaderFilterItemSelectionState(item, filterValuesMatch, isExcludeFilter) {\n  if (filterValuesMatch ^ isExcludeFilter) {\n    item.selected = true;\n\n    if (isExcludeFilter && item.items) {\n      for (var j = 0; j < item.items.length; j++) {\n        if (!item.items[j].selected) {\n          item.selected = void 0;\n          break;\n        }\n      }\n    }\n  } else {\n    if (isExcludeFilter || item.selected) {\n      item.selected = false;\n      resetChildrenItemSelection(item.items);\n    }\n  }\n}\n\nvar HeaderFilterView = _uiGrid_core.default.View.inherit({\n  getPopupContainer: function () {\n    return this._popupContainer;\n  },\n  getListContainer: function () {\n    return this._listContainer;\n  },\n  applyHeaderFilter: function (options) {\n    var that = this;\n    var list = that.getListContainer();\n    var searchValue = list.option(\"searchValue\");\n    var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\n    var filterValues = [];\n\n    var fillSelectedItemKeys = function fillSelectedItemKeys(filterValues, items, isExclude) {\n      (0, _iterator.each)(items, function (_, item) {\n        if (void 0 !== item.selected && !!item.selected ^ isExclude) {\n          var node = list._getNode(item);\n\n          var hasChildren = list._hasChildren(node);\n\n          var hasChildrenWithSelection = hasChildren && item.items && item.items.some(function (item) {\n            return item.selected;\n          });\n\n          if (!searchValue || !hasChildrenWithSelection) {\n            filterValues.push(item.value);\n            return;\n          }\n        }\n\n        if (item.items && item.items.length) {\n          fillSelectedItemKeys(filterValues, item.items, isExclude);\n        }\n      });\n    };\n\n    if (!isSelectAll) {\n      if (\"tree\" === options.type) {\n        if (options.filterType) {\n          options.filterType = \"include\";\n        }\n\n        fillSelectedItemKeys(filterValues, list.option(\"items\"), false);\n        options.filterValues = filterValues;\n      }\n    } else {\n      if (\"tree\" === options.type) {\n        options.filterType = \"exclude\";\n      }\n\n      if (Array.isArray(options.filterValues)) {\n        options.filterValues = [];\n      }\n    }\n\n    if (options.filterValues && !options.filterValues.length) {\n      options.filterValues = null;\n    }\n\n    options.apply();\n    that.hideHeaderFilterMenu();\n  },\n  showHeaderFilterMenu: function ($columnElement, options) {\n    var that = this;\n\n    if (options) {\n      that._initializePopupContainer(options);\n\n      var popupContainer = that.getPopupContainer();\n      that.hideHeaderFilterMenu();\n      that.updatePopup($columnElement, options);\n      popupContainer.show();\n    }\n  },\n  hideHeaderFilterMenu: function () {\n    var headerFilterMenu = this.getPopupContainer();\n    headerFilterMenu && headerFilterMenu.hide();\n  },\n  updatePopup: function ($element, options) {\n    var that = this;\n    var alignment = \"right\" === options.alignment ? \"left\" : \"right\";\n\n    if (that._popupContainer) {\n      that._cleanPopupContent();\n\n      that._popupContainer.option(\"position\", {\n        my: alignment + \" top\",\n        at: alignment + \" bottom\",\n        of: $element,\n        collision: \"flip fit\"\n      });\n    }\n  },\n  _getSearchExpr: function (options) {\n    var lookup = options.lookup;\n    var useDefaultSearchExpr = options.useDefaultSearchExpr;\n    var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\n\n    if (useDefaultSearchExpr || (0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\n      return DEFAULT_SEARCH_EXPRESSION;\n    }\n\n    if (lookup) {\n      return lookup.displayExpr || \"this\";\n    }\n\n    if (options.dataSource) {\n      var group = options.dataSource.group;\n\n      if (Array.isArray(group) && group.length > 0) {\n        return group[0].selector;\n      } else {\n        if ((0, _type.isFunction)(group) && !options.remoteFiltering) {\n          return group;\n        }\n      }\n    }\n\n    return options.dataField || options.selector;\n  },\n  _cleanPopupContent: function () {\n    this._popupContainer && this._popupContainer.$content().empty();\n  },\n  _initializePopupContainer: function (options) {\n    var that = this;\n    var $element = that.element();\n    var headerFilterOptions = that.option(\"headerFilter\");\n    var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\n    var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\n    var dxPopupOptions = {\n      width: width,\n      height: height,\n      visible: false,\n      shading: false,\n      showTitle: false,\n      showCloseButton: false,\n      closeOnTargetScroll: false,\n      dragEnabled: false,\n      closeOnOutsideClick: true,\n      focusStateEnabled: false,\n      toolbarItems: [{\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.ok,\n          onClick: function () {\n            that.applyHeaderFilter(options);\n          }\n        }\n      }, {\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.cancel,\n          onClick: function () {\n            that.hideHeaderFilterMenu();\n          }\n        }\n      }],\n      resizeEnabled: true,\n      onShowing: function (e) {\n        e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\n\n        that._initializeListContainer(options);\n\n        options.onShowing && options.onShowing(e);\n      },\n      onShown: function () {\n        that.getListContainer().focus();\n      },\n      onHidden: options.onHidden,\n      onInitialized: function (e) {\n        var component = e.component;\n        component.option(\"animation\", component._getDefaultOptions().animation);\n      }\n    };\n\n    if (!(0, _type.isDefined)(that._popupContainer)) {\n      that._popupContainer = that._createComponent($element, _popup.default, dxPopupOptions);\n    } else {\n      that._popupContainer.option(dxPopupOptions);\n    }\n  },\n  _initializeListContainer: function (options) {\n    var that = this;\n\n    var $content = that._popupContainer.$content();\n\n    var widgetOptions = {\n      searchEnabled: isSearchEnabled(that, options),\n      searchTimeout: that.option(\"headerFilter.searchTimeout\"),\n      searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\n      dataSource: options.dataSource,\n      onContentReady: function () {\n        that.renderCompleted.fire();\n      },\n      itemTemplate: function (data, _, element) {\n        var $element = (0, _renderer.default)(element);\n\n        if (options.encodeHtml) {\n          return $element.text(data.text);\n        }\n\n        return $element.html(data.text);\n      }\n    };\n\n    function onOptionChanged(e) {\n      if (\"searchValue\" === e.fullName && !options.isFilterBuilder && false !== that.option(\"headerFilter.hideSelectAllOnSearch\")) {\n        if (\"tree\" === options.type) {\n          e.component.option(\"showCheckBoxesMode\", e.value ? \"normal\" : \"selectAll\");\n        } else {\n          e.component.option(\"selectionMode\", e.value ? \"multiple\" : \"all\");\n        }\n      }\n    }\n\n    if (\"tree\" === options.type) {\n      that._listContainer = that._createComponent((0, _renderer.default)(\"<div>\").appendTo($content), _tree_view.default, (0, _extend.extend)(widgetOptions, {\n        showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\n        onOptionChanged: onOptionChanged,\n        keyExpr: \"id\"\n      }));\n    } else {\n      that._listContainer = that._createComponent((0, _renderer.default)(\"<div>\").appendTo($content), _list.default, (0, _extend.extend)(widgetOptions, {\n        searchExpr: that._getSearchExpr(options),\n        pageLoadMode: \"scrollBottom\",\n        showSelectionControls: true,\n        selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\n        onOptionChanged: onOptionChanged,\n        onSelectionChanged: function (e) {\n          var items = e.component.option(\"items\");\n          var selectedItems = e.component.option(\"selectedItems\");\n\n          if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\n            var filterValues = options.filterValues || [];\n            var isExclude = \"exclude\" === options.filterType;\n\n            if (0 === selectedItems.length && items.length && (filterValues.length <= 1 || isExclude && filterValues.length === items.length - 1)) {\n              options.filterType = \"include\";\n              options.filterValues = [];\n            } else {\n              if (selectedItems.length === items.length) {\n                options.filterType = \"exclude\";\n                options.filterValues = [];\n              }\n            }\n          }\n\n          (0, _iterator.each)(items, function (index, item) {\n            var selected = _uiGrid_core2.default.getIndexByKey(item, selectedItems, null) >= 0;\n            var oldSelected = !!item.selected;\n\n            if (oldSelected !== selected) {\n              item.selected = selected;\n              options.filterValues = options.filterValues || [];\n\n              var filterValueIndex = _uiGrid_core2.default.getIndexByKey(item.value, options.filterValues, null);\n\n              if (filterValueIndex >= 0) {\n                options.filterValues.splice(filterValueIndex, 1);\n              }\n\n              if (selected ^ \"exclude\" === options.filterType) {\n                options.filterValues.push(item.value);\n              }\n            }\n          });\n          updateSelectAllState(e, options.filterValues);\n        },\n        onContentReady: function (e) {\n          var component = e.component;\n          var items = component.option(\"items\");\n          var selectedItems = [];\n          (0, _iterator.each)(items, function () {\n            if (this.selected) {\n              selectedItems.push(this);\n            }\n          });\n          component._selectedItemsUpdating = true;\n          component.option(\"selectedItems\", selectedItems);\n          component._selectedItemsUpdating = false;\n          updateSelectAllState(e, options.filterValues);\n        }\n      }));\n    }\n  },\n  _renderCore: function () {\n    this.element().addClass(HEADER_FILTER_MENU_CLASS);\n  }\n});\n\nexports.HeaderFilterView = HeaderFilterView;\n\nvar allowHeaderFiltering = function (column) {\n  return (0, _type.isDefined)(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering;\n};\n\nexports.allowHeaderFiltering = allowHeaderFiltering;\nvar headerFilterMixin = {\n  _applyColumnState: function (options) {\n    var $headerFilterIndicator;\n    var rootElement = options.rootElement;\n    var column = options.column;\n\n    if (\"headerFilter\" === options.name) {\n      rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\n\n      if (allowHeaderFiltering(column)) {\n        $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\n\n        if (!this.option(\"useLegacyKeyboardNavigation\")) {\n          $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0);\n        }\n      }\n\n      return $headerFilterIndicator;\n    }\n\n    return this.callBase(options);\n  },\n  _isHeaderFilterEmpty: function (column) {\n    return !column.filterValues || !column.filterValues.length;\n  },\n  _getIndicatorClassName: function (name) {\n    if (\"headerFilter\" === name) {\n      return HEADER_FILTER_CLASS;\n    }\n\n    return this.callBase(name);\n  },\n  _renderIndicator: function (options) {\n    var $container = options.container;\n    var $indicator = options.indicator;\n\n    if (\"headerFilter\" === options.name) {\n      var rtlEnabled = this.option(\"rtlEnabled\");\n\n      if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\n        $container.prepend($indicator);\n        return;\n      }\n    }\n\n    this.callBase(options);\n  },\n  optionChanged: function (args) {\n    if (\"headerFilter\" === args.name) {\n      var requireReady = \"columnHeadersView\" === this.name;\n\n      this._invalidate(requireReady, requireReady);\n\n      args.handled = true;\n    } else {\n      this.callBase(args);\n    }\n  }\n};\nexports.headerFilterMixin = headerFilterMixin;","map":{"version":3,"sources":["C:/Users/CapiniaC/Desktop/Collection/Work/project/security/node_modules/devextreme/ui/grid_core/ui.grid_core.header_filter_core.js"],"names":["exports","updateHeaderFilterItemSelectionState","headerFilterMixin","allowHeaderFiltering","HeaderFilterView","_renderer","_interopRequireDefault","require","_uiGrid_core","_uiGrid_core2","_type","_iterator","_extend","_popup","_tree_view","_list","obj","__esModule","HEADER_FILTER_CLASS","HEADER_FILTER_MENU_CLASS","DEFAULT_SEARCH_EXPRESSION","resetChildrenItemSelection","items","i","length","selected","updateSelectAllState","e","filterValues","component","option","selectAllCheckBox","default","element","find","data","isSearchEnabled","that","options","headerFilter","isDefined","allowSearch","item","filterValuesMatch","isExcludeFilter","j","View","inherit","getPopupContainer","_popupContainer","getListContainer","_listContainer","applyHeaderFilter","list","searchValue","isSelectAll","isFilterBuilder","$element","eq","hasClass","fillSelectedItemKeys","isExclude","each","_","node","_getNode","hasChildren","_hasChildren","hasChildrenWithSelection","some","push","value","type","filterType","Array","isArray","apply","hideHeaderFilterMenu","showHeaderFilterMenu","$columnElement","_initializePopupContainer","popupContainer","updatePopup","show","headerFilterMenu","hide","alignment","_cleanPopupContent","my","at","of","collision","_getSearchExpr","lookup","useDefaultSearchExpr","headerFilterDataSource","dataSource","isFunction","displayExpr","group","selector","remoteFiltering","dataField","$content","empty","headerFilterOptions","width","height","dxPopupOptions","visible","shading","showTitle","showCloseButton","closeOnTargetScroll","dragEnabled","closeOnOutsideClick","focusStateEnabled","toolbarItems","toolbar","location","widget","text","texts","ok","onClick","cancel","resizeEnabled","onShowing","parent","addClass","_initializeListContainer","onShown","focus","onHidden","onInitialized","_getDefaultOptions","animation","_createComponent","widgetOptions","searchEnabled","searchTimeout","searchMode","onContentReady","renderCompleted","fire","itemTemplate","encodeHtml","html","onOptionChanged","fullName","appendTo","extend","showCheckBoxesMode","keyExpr","searchExpr","pageLoadMode","showSelectionControls","selectionMode","onSelectionChanged","selectedItems","_selectedItemsUpdating","index","getIndexByKey","oldSelected","filterValueIndex","splice","_renderCore","column","allowFiltering","_applyColumnState","$headerFilterIndicator","rootElement","name","remove","callBase","toggleClass","_isHeaderFilterEmpty","attr","_getIndicatorClassName","_renderIndicator","$container","container","$indicator","indicator","rtlEnabled","children","columnAlignment","prepend","optionChanged","args","requireReady","_invalidate","handled"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.updateHeaderFilterItemSelectionState = updateHeaderFilterItemSelectionState;\r\nexports.headerFilterMixin = exports.allowHeaderFiltering = exports.HeaderFilterView = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _uiGrid_core = _interopRequireDefault(require(\"./ui.grid_core.modules\"));\r\nvar _uiGrid_core2 = _interopRequireDefault(require(\"./ui.grid_core.utils\"));\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _popup = _interopRequireDefault(require(\"../popup\"));\r\nvar _tree_view = _interopRequireDefault(require(\"../tree_view\"));\r\nvar _list = _interopRequireDefault(require(\"../list\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\r\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\r\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\r\n\r\nfunction resetChildrenItemSelection(items) {\r\n    items = items || [];\r\n    for (var i = 0; i < items.length; i++) {\r\n        items[i].selected = false;\r\n        resetChildrenItemSelection(items[i].items)\r\n    }\r\n}\r\n\r\nfunction updateSelectAllState(e, filterValues) {\r\n    if (e.component.option(\"searchValue\")) {\r\n        return\r\n    }\r\n    var selectAllCheckBox = (0, _renderer.default)(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\r\n    if (selectAllCheckBox && filterValues && filterValues.length) {\r\n        selectAllCheckBox.option(\"value\", void 0)\r\n    }\r\n}\r\n\r\nfunction isSearchEnabled(that, options) {\r\n    var headerFilter = options.headerFilter;\r\n    if (headerFilter && (0, _type.isDefined)(headerFilter.allowSearch)) {\r\n        return headerFilter.allowSearch\r\n    }\r\n    return that.option(\"headerFilter.allowSearch\")\r\n}\r\n\r\nfunction updateHeaderFilterItemSelectionState(item, filterValuesMatch, isExcludeFilter) {\r\n    if (filterValuesMatch ^ isExcludeFilter) {\r\n        item.selected = true;\r\n        if (isExcludeFilter && item.items) {\r\n            for (var j = 0; j < item.items.length; j++) {\r\n                if (!item.items[j].selected) {\r\n                    item.selected = void 0;\r\n                    break\r\n                }\r\n            }\r\n        }\r\n    } else {\r\n        if (isExcludeFilter || item.selected) {\r\n            item.selected = false;\r\n            resetChildrenItemSelection(item.items)\r\n        }\r\n    }\r\n}\r\nvar HeaderFilterView = _uiGrid_core.default.View.inherit({\r\n    getPopupContainer: function() {\r\n        return this._popupContainer\r\n    },\r\n    getListContainer: function() {\r\n        return this._listContainer\r\n    },\r\n    applyHeaderFilter: function(options) {\r\n        var that = this;\r\n        var list = that.getListContainer();\r\n        var searchValue = list.option(\"searchValue\");\r\n        var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\r\n        var filterValues = [];\r\n        var fillSelectedItemKeys = function fillSelectedItemKeys(filterValues, items, isExclude) {\r\n            (0, _iterator.each)(items, function(_, item) {\r\n                if (void 0 !== item.selected && !!item.selected ^ isExclude) {\r\n                    var node = list._getNode(item);\r\n                    var hasChildren = list._hasChildren(node);\r\n                    var hasChildrenWithSelection = hasChildren && item.items && item.items.some(function(item) {\r\n                        return item.selected\r\n                    });\r\n                    if (!searchValue || !hasChildrenWithSelection) {\r\n                        filterValues.push(item.value);\r\n                        return\r\n                    }\r\n                }\r\n                if (item.items && item.items.length) {\r\n                    fillSelectedItemKeys(filterValues, item.items, isExclude)\r\n                }\r\n            })\r\n        };\r\n        if (!isSelectAll) {\r\n            if (\"tree\" === options.type) {\r\n                if (options.filterType) {\r\n                    options.filterType = \"include\"\r\n                }\r\n                fillSelectedItemKeys(filterValues, list.option(\"items\"), false);\r\n                options.filterValues = filterValues\r\n            }\r\n        } else {\r\n            if (\"tree\" === options.type) {\r\n                options.filterType = \"exclude\"\r\n            }\r\n            if (Array.isArray(options.filterValues)) {\r\n                options.filterValues = []\r\n            }\r\n        }\r\n        if (options.filterValues && !options.filterValues.length) {\r\n            options.filterValues = null\r\n        }\r\n        options.apply();\r\n        that.hideHeaderFilterMenu()\r\n    },\r\n    showHeaderFilterMenu: function($columnElement, options) {\r\n        var that = this;\r\n        if (options) {\r\n            that._initializePopupContainer(options);\r\n            var popupContainer = that.getPopupContainer();\r\n            that.hideHeaderFilterMenu();\r\n            that.updatePopup($columnElement, options);\r\n            popupContainer.show()\r\n        }\r\n    },\r\n    hideHeaderFilterMenu: function() {\r\n        var headerFilterMenu = this.getPopupContainer();\r\n        headerFilterMenu && headerFilterMenu.hide()\r\n    },\r\n    updatePopup: function($element, options) {\r\n        var that = this;\r\n        var alignment = \"right\" === options.alignment ? \"left\" : \"right\";\r\n        if (that._popupContainer) {\r\n            that._cleanPopupContent();\r\n            that._popupContainer.option(\"position\", {\r\n                my: alignment + \" top\",\r\n                at: alignment + \" bottom\",\r\n                of: $element,\r\n                collision: \"flip fit\"\r\n            })\r\n        }\r\n    },\r\n    _getSearchExpr: function(options) {\r\n        var lookup = options.lookup;\r\n        var useDefaultSearchExpr = options.useDefaultSearchExpr;\r\n        var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\r\n        if (useDefaultSearchExpr || (0, _type.isDefined)(headerFilterDataSource) && !(0, _type.isFunction)(headerFilterDataSource)) {\r\n            return DEFAULT_SEARCH_EXPRESSION\r\n        }\r\n        if (lookup) {\r\n            return lookup.displayExpr || \"this\"\r\n        }\r\n        if (options.dataSource) {\r\n            var group = options.dataSource.group;\r\n            if (Array.isArray(group) && group.length > 0) {\r\n                return group[0].selector\r\n            } else {\r\n                if ((0, _type.isFunction)(group) && !options.remoteFiltering) {\r\n                    return group\r\n                }\r\n            }\r\n        }\r\n        return options.dataField || options.selector\r\n    },\r\n    _cleanPopupContent: function() {\r\n        this._popupContainer && this._popupContainer.$content().empty()\r\n    },\r\n    _initializePopupContainer: function(options) {\r\n        var that = this;\r\n        var $element = that.element();\r\n        var headerFilterOptions = that.option(\"headerFilter\");\r\n        var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\r\n        var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\r\n        var dxPopupOptions = {\r\n            width: width,\r\n            height: height,\r\n            visible: false,\r\n            shading: false,\r\n            showTitle: false,\r\n            showCloseButton: false,\r\n            closeOnTargetScroll: false,\r\n            dragEnabled: false,\r\n            closeOnOutsideClick: true,\r\n            focusStateEnabled: false,\r\n            toolbarItems: [{\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.ok,\r\n                    onClick: function() {\r\n                        that.applyHeaderFilter(options)\r\n                    }\r\n                }\r\n            }, {\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.cancel,\r\n                    onClick: function() {\r\n                        that.hideHeaderFilterMenu()\r\n                    }\r\n                }\r\n            }],\r\n            resizeEnabled: true,\r\n            onShowing: function(e) {\r\n                e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\r\n                that._initializeListContainer(options);\r\n                options.onShowing && options.onShowing(e)\r\n            },\r\n            onShown: function() {\r\n                that.getListContainer().focus()\r\n            },\r\n            onHidden: options.onHidden,\r\n            onInitialized: function(e) {\r\n                var component = e.component;\r\n                component.option(\"animation\", component._getDefaultOptions().animation)\r\n            }\r\n        };\r\n        if (!(0, _type.isDefined)(that._popupContainer)) {\r\n            that._popupContainer = that._createComponent($element, _popup.default, dxPopupOptions)\r\n        } else {\r\n            that._popupContainer.option(dxPopupOptions)\r\n        }\r\n    },\r\n    _initializeListContainer: function(options) {\r\n        var that = this;\r\n        var $content = that._popupContainer.$content();\r\n        var widgetOptions = {\r\n            searchEnabled: isSearchEnabled(that, options),\r\n            searchTimeout: that.option(\"headerFilter.searchTimeout\"),\r\n            searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\r\n            dataSource: options.dataSource,\r\n            onContentReady: function() {\r\n                that.renderCompleted.fire()\r\n            },\r\n            itemTemplate: function(data, _, element) {\r\n                var $element = (0, _renderer.default)(element);\r\n                if (options.encodeHtml) {\r\n                    return $element.text(data.text)\r\n                }\r\n                return $element.html(data.text)\r\n            }\r\n        };\r\n\r\n        function onOptionChanged(e) {\r\n            if (\"searchValue\" === e.fullName && !options.isFilterBuilder && false !== that.option(\"headerFilter.hideSelectAllOnSearch\")) {\r\n                if (\"tree\" === options.type) {\r\n                    e.component.option(\"showCheckBoxesMode\", e.value ? \"normal\" : \"selectAll\")\r\n                } else {\r\n                    e.component.option(\"selectionMode\", e.value ? \"multiple\" : \"all\")\r\n                }\r\n            }\r\n        }\r\n        if (\"tree\" === options.type) {\r\n            that._listContainer = that._createComponent((0, _renderer.default)(\"<div>\").appendTo($content), _tree_view.default, (0, _extend.extend)(widgetOptions, {\r\n                showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\r\n                onOptionChanged: onOptionChanged,\r\n                keyExpr: \"id\"\r\n            }))\r\n        } else {\r\n            that._listContainer = that._createComponent((0, _renderer.default)(\"<div>\").appendTo($content), _list.default, (0, _extend.extend)(widgetOptions, {\r\n                searchExpr: that._getSearchExpr(options),\r\n                pageLoadMode: \"scrollBottom\",\r\n                showSelectionControls: true,\r\n                selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\r\n                onOptionChanged: onOptionChanged,\r\n                onSelectionChanged: function(e) {\r\n                    var items = e.component.option(\"items\");\r\n                    var selectedItems = e.component.option(\"selectedItems\");\r\n                    if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\r\n                        var filterValues = options.filterValues || [];\r\n                        var isExclude = \"exclude\" === options.filterType;\r\n                        if (0 === selectedItems.length && items.length && (filterValues.length <= 1 || isExclude && filterValues.length === items.length - 1)) {\r\n                            options.filterType = \"include\";\r\n                            options.filterValues = []\r\n                        } else {\r\n                            if (selectedItems.length === items.length) {\r\n                                options.filterType = \"exclude\";\r\n                                options.filterValues = []\r\n                            }\r\n                        }\r\n                    }(0, _iterator.each)(items, function(index, item) {\r\n                        var selected = _uiGrid_core2.default.getIndexByKey(item, selectedItems, null) >= 0;\r\n                        var oldSelected = !!item.selected;\r\n                        if (oldSelected !== selected) {\r\n                            item.selected = selected;\r\n                            options.filterValues = options.filterValues || [];\r\n                            var filterValueIndex = _uiGrid_core2.default.getIndexByKey(item.value, options.filterValues, null);\r\n                            if (filterValueIndex >= 0) {\r\n                                options.filterValues.splice(filterValueIndex, 1)\r\n                            }\r\n                            if (selected ^ \"exclude\" === options.filterType) {\r\n                                options.filterValues.push(item.value)\r\n                            }\r\n                        }\r\n                    });\r\n                    updateSelectAllState(e, options.filterValues)\r\n                },\r\n                onContentReady: function(e) {\r\n                    var component = e.component;\r\n                    var items = component.option(\"items\");\r\n                    var selectedItems = [];\r\n                    (0, _iterator.each)(items, function() {\r\n                        if (this.selected) {\r\n                            selectedItems.push(this)\r\n                        }\r\n                    });\r\n                    component._selectedItemsUpdating = true;\r\n                    component.option(\"selectedItems\", selectedItems);\r\n                    component._selectedItemsUpdating = false;\r\n                    updateSelectAllState(e, options.filterValues)\r\n                }\r\n            }))\r\n        }\r\n    },\r\n    _renderCore: function() {\r\n        this.element().addClass(HEADER_FILTER_MENU_CLASS)\r\n    }\r\n});\r\nexports.HeaderFilterView = HeaderFilterView;\r\nvar allowHeaderFiltering = function(column) {\r\n    return (0, _type.isDefined)(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering\r\n};\r\nexports.allowHeaderFiltering = allowHeaderFiltering;\r\nvar headerFilterMixin = {\r\n    _applyColumnState: function(options) {\r\n        var $headerFilterIndicator;\r\n        var rootElement = options.rootElement;\r\n        var column = options.column;\r\n        if (\"headerFilter\" === options.name) {\r\n            rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\r\n            if (allowHeaderFiltering(column)) {\r\n                $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\r\n                if (!this.option(\"useLegacyKeyboardNavigation\")) {\r\n                    $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0)\r\n                }\r\n            }\r\n            return $headerFilterIndicator\r\n        }\r\n        return this.callBase(options)\r\n    },\r\n    _isHeaderFilterEmpty: function(column) {\r\n        return !column.filterValues || !column.filterValues.length\r\n    },\r\n    _getIndicatorClassName: function(name) {\r\n        if (\"headerFilter\" === name) {\r\n            return HEADER_FILTER_CLASS\r\n        }\r\n        return this.callBase(name)\r\n    },\r\n    _renderIndicator: function(options) {\r\n        var $container = options.container;\r\n        var $indicator = options.indicator;\r\n        if (\"headerFilter\" === options.name) {\r\n            var rtlEnabled = this.option(\"rtlEnabled\");\r\n            if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\r\n                $container.prepend($indicator);\r\n                return\r\n            }\r\n        }\r\n        this.callBase(options)\r\n    },\r\n    optionChanged: function(args) {\r\n        if (\"headerFilter\" === args.name) {\r\n            var requireReady = \"columnHeadersView\" === this.name;\r\n            this._invalidate(requireReady, requireReady);\r\n            args.handled = true\r\n        } else {\r\n            this.callBase(args)\r\n        }\r\n    }\r\n};\r\nexports.headerFilterMixin = headerFilterMixin;\r\n"]},"metadata":{},"sourceType":"script"}