{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.focus.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _uiGrid_core = _interopRequireDefault(require(\"./ui.grid_core.modules\"));\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiGrid_core2 = _interopRequireDefault(require(\"./ui.grid_core.utils\"));\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar ROW_FOCUSED_CLASS = \"dx-row-focused\";\nvar FOCUSED_ROW_SELECTOR = \".dx-row.\" + ROW_FOCUSED_CLASS;\nvar TABLE_POSTFIX_CLASS = \"table\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\n\nvar FocusController = _uiGrid_core.default.ViewController.inherit(function () {\n  return {\n    init: function () {\n      this._dataController = this.getController(\"data\");\n      this._keyboardController = this.getController(\"keyboardNavigation\");\n      this.component._optionsByReference.focusedRowKey = true;\n    },\n    optionChanged: function (args) {\n      if (\"focusedRowIndex\" === args.name) {\n        var focusedRowKey = this.option(\"focusedRowKey\");\n\n        this._focusRowByIndex(args.value);\n\n        this._triggerFocusedRowChangedIfNeed(focusedRowKey, args.value);\n\n        args.handled = true;\n      } else {\n        if (\"focusedRowKey\" === args.name) {\n          var focusedRowIndex = this.option(\"focusedRowIndex\");\n\n          this._focusRowByKey(args.value);\n\n          this._triggerFocusedRowChangedIfNeed(args.value, focusedRowIndex);\n\n          args.handled = true;\n        } else {\n          if (\"focusedColumnIndex\" === args.name) {\n            args.handled = true;\n          } else {\n            if (\"focusedRowEnabled\" === args.name) {\n              args.handled = true;\n            } else {\n              if (\"autoNavigateToFocusedRow\" === args.name) {\n                args.handled = true;\n              } else {\n                this.callBase(args);\n              }\n            }\n          }\n        }\n      }\n    },\n    _triggerFocusedRowChangedIfNeed: function (focusedRowKey, focusedRowIndex) {\n      var focusedRowIndexByKey = this.getFocusedRowIndexByKey(focusedRowKey);\n\n      if (focusedRowIndex === focusedRowIndexByKey) {\n        var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\n\n        if (rowIndex >= 0) {\n          var $rowElement = (0, _renderer.default)(this.getView(\"rowsView\").getRowElement(rowIndex));\n\n          this.getController(\"keyboardNavigation\")._fireFocusedRowChanged($rowElement, focusedRowIndex);\n        }\n      }\n    },\n    isAutoNavigateToFocusedRow: function () {\n      return \"infinite\" !== this.option(\"scrolling.mode\") && this.option(\"autoNavigateToFocusedRow\");\n    },\n    _focusRowByIndex: function (index) {\n      if (!this.option(\"focusedRowEnabled\")) {\n        return;\n      }\n\n      index = void 0 !== index ? index : this.option(\"focusedRowIndex\");\n\n      if (index < 0) {\n        if (this.isAutoNavigateToFocusedRow()) {\n          this._resetFocusedRow();\n        }\n      } else {\n        this._focusRowByIndexCore(index);\n      }\n    },\n    _focusRowByIndexCore: function (index) {\n      var _this = this;\n\n      var dataController = this.getController(\"data\");\n      var pageSize = dataController.pageSize();\n\n      var setKeyByIndex = function () {\n        if (_this._isValidFocusedRowIndex(index)) {\n          var visibleIndex = index - dataController.getRowIndexOffset(true);\n\n          var lastItemIndex = dataController._getLastItemIndex();\n\n          var rowIndex = Math.min(visibleIndex, lastItemIndex);\n          var focusedRowKey = dataController.getKeyByRowIndex(rowIndex, true);\n\n          if ((0, _type.isDefined)(focusedRowKey) && !_this.isRowFocused(focusedRowKey)) {\n            _this.option(\"focusedRowKey\", focusedRowKey);\n          }\n        }\n      };\n\n      if (pageSize >= 0) {\n        if (!this._isLocalRowIndex(index)) {\n          var pageIndex = Math.floor(index / dataController.pageSize());\n          (0, _deferred.when)(dataController.pageIndex(pageIndex), dataController.waitReady()).done(function () {\n            setKeyByIndex();\n          });\n        } else {\n          setKeyByIndex();\n        }\n      }\n    },\n    _isLocalRowIndex: function (index) {\n      var dataController = this.getController(\"data\");\n\n      var isVirtualScrolling = this.getController(\"keyboardNavigation\")._isVirtualScrolling();\n\n      if (isVirtualScrolling) {\n        var pageIndex = Math.floor(index / dataController.pageSize());\n        var virtualItems = dataController.virtualItemsCount();\n        var virtualItemsBegin = virtualItems ? virtualItems.begin : -1;\n        var visibleRowsCount = dataController.getVisibleRows().length + dataController.getRowIndexOffset();\n        var visiblePagesCount = Math.ceil(visibleRowsCount / dataController.pageSize());\n        return virtualItemsBegin <= index && visiblePagesCount > pageIndex;\n      }\n\n      return true;\n    },\n    _setFocusedRowKeyByIndex: function (index) {\n      var dataController = this.getController(\"data\");\n\n      if (this._isValidFocusedRowIndex(index)) {\n        var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\n        var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\n\n        if ((0, _type.isDefined)(focusedRowKey) && !this.isRowFocused(focusedRowKey)) {\n          this.option(\"focusedRowKey\", focusedRowKey);\n        }\n      }\n    },\n    _focusRowByKey: function (key) {\n      if (!(0, _type.isDefined)(key)) {\n        this._resetFocusedRow();\n      } else {\n        this._navigateToRow(key, true);\n      }\n    },\n    _resetFocusedRow: function () {\n      var focusedRowKey = this.option(\"focusedRowKey\");\n      var isFocusedRowKeyDefined = (0, _type.isDefined)(focusedRowKey);\n\n      if (!isFocusedRowKeyDefined && this.option(\"focusedRowIndex\") < 0) {\n        return;\n      }\n\n      var keyboardController = this.getController(\"keyboardNavigation\");\n\n      if (isFocusedRowKeyDefined) {\n        this.option(\"focusedRowKey\", void 0);\n      }\n\n      keyboardController.setFocusedRowIndex(-1);\n      this.option(\"focusedRowIndex\", -1);\n      this.getController(\"data\").updateItems({\n        changeType: \"updateFocusedRow\",\n        focusedRowKey: void 0\n      });\n\n      keyboardController._fireFocusedRowChanged(void 0, -1);\n    },\n    _isValidFocusedRowIndex: function (rowIndex) {\n      var dataController = this.getController(\"data\");\n      var row = dataController.getVisibleRows()[rowIndex];\n      return !row || \"data\" === row.rowType || \"group\" === row.rowType;\n    },\n    publicMethods: function () {\n      return [\"navigateToRow\", \"isRowFocused\"];\n    },\n    navigateToRow: function (key) {\n      if (!this.isAutoNavigateToFocusedRow()) {\n        this.option(\"focusedRowIndex\", -1);\n      }\n\n      this._navigateToRow(key);\n    },\n    _navigateToRow: function (key, needFocusRow) {\n      var that = this;\n      var dataController = that.getController(\"data\");\n      var isAutoNavigate = that.isAutoNavigateToFocusedRow();\n      var d = new _deferred.Deferred();\n\n      if (void 0 === key || !dataController.dataSource()) {\n        return d.reject().promise();\n      }\n\n      var rowIndexByKey = that.getFocusedRowIndexByKey(key);\n\n      if (!isAutoNavigate && needFocusRow || rowIndexByKey >= 0) {\n        that._navigateTo(key, d, needFocusRow);\n      } else {\n        dataController.getPageIndexByKey(key).done(function (pageIndex) {\n          if (pageIndex < 0) {\n            d.resolve(-1);\n            return;\n          }\n\n          if (pageIndex === dataController.pageIndex()) {\n            dataController.reload().done(function () {\n              if (that.isRowFocused(key)) {\n                d.resolve(that.getFocusedRowIndexByKey(key));\n              } else {\n                that._navigateTo(key, d, needFocusRow);\n              }\n            }).fail(d.reject);\n          } else {\n            dataController.pageIndex(pageIndex).done(function () {\n              that._navigateTo(key, d, needFocusRow);\n            }).fail(d.reject);\n          }\n        }).fail(d.reject);\n      }\n\n      return d.promise();\n    },\n    _navigateTo: function (key, deferred, needFocusRow) {\n      var visibleRowIndex = this.getController(\"data\").getRowIndexByKey(key);\n      var isVirtualRowRenderingMode = \"virtual\" === this.option(\"scrolling.rowRenderingMode\");\n      var isAutoNavigate = this.isAutoNavigateToFocusedRow();\n\n      if (isAutoNavigate && isVirtualRowRenderingMode && visibleRowIndex < 0) {\n        this._navigateToVirtualRow(key, deferred, needFocusRow);\n      } else {\n        this._navigateToVisibleRow(key, deferred, needFocusRow);\n      }\n    },\n    _navigateToVisibleRow: function (key, deferred, needFocusRow) {\n      if (needFocusRow) {\n        this._triggerUpdateFocusedRow(key, deferred);\n      } else {\n        this.getView(\"rowsView\").scrollToRowElement(key);\n      }\n    },\n    _navigateToVirtualRow: function (key, deferred, needFocusRow) {\n      var that = this;\n      var dataController = this.getController(\"data\");\n      var rowsScrollController = dataController._rowsScrollController;\n\n      var rowIndex = _uiGrid_core2.default.getIndexByKey(key, dataController.items(true));\n\n      var scrollable = that.getView(\"rowsView\").getScrollable();\n\n      if (rowsScrollController && scrollable && rowIndex >= 0) {\n        var focusedRowIndex = rowIndex + dataController.getRowIndexOffset() - dataController.getRowIndexDelta();\n        var offset = rowsScrollController.getItemOffset(focusedRowIndex);\n\n        if (needFocusRow) {\n          var triggerUpdateFocusedRow = function triggerUpdateFocusedRow() {\n            that.component.off(\"contentReady\", triggerUpdateFocusedRow);\n\n            that._triggerUpdateFocusedRow(key, deferred);\n          };\n\n          that.component.on(\"contentReady\", triggerUpdateFocusedRow);\n        }\n\n        scrollable.scrollTo({\n          y: offset\n        });\n      }\n    },\n    _triggerUpdateFocusedRow: function (key, deferred) {\n      var dataController = this.getController(\"data\");\n      var focusedRowIndex = this.getFocusedRowIndexByKey(key);\n\n      if (this._isValidFocusedRowIndex(focusedRowIndex)) {\n        if (this.option(\"focusedRowEnabled\")) {\n          dataController.updateItems({\n            changeType: \"updateFocusedRow\",\n            focusedRowKey: key\n          });\n        } else {\n          this.getView(\"rowsView\").scrollToRowElement(key);\n        }\n\n        this.getController(\"keyboardNavigation\").setFocusedRowIndex(focusedRowIndex);\n        deferred && deferred.resolve(focusedRowIndex);\n      } else {\n        deferred && deferred.resolve(-1);\n      }\n    },\n    getFocusedRowIndexByKey: function (key) {\n      var dataController = this.getController(\"data\");\n      var loadedRowIndex = dataController.getRowIndexByKey(key, true);\n      return loadedRowIndex >= 0 ? loadedRowIndex + dataController.getRowIndexOffset(true) : -1;\n    },\n    _focusRowByKeyOrIndex: function () {\n      var _this2 = this;\n\n      var focusedRowKey = this.option(\"focusedRowKey\");\n      var currentFocusedRowIndex = this.option(\"focusedRowIndex\");\n      var keyboardController = this.getController(\"keyboardNavigation\");\n      var dataController = this.getController(\"data\");\n\n      if ((0, _type.isDefined)(focusedRowKey)) {\n        var visibleRowIndex = dataController.getRowIndexByKey(focusedRowKey);\n\n        if (visibleRowIndex >= 0) {\n          if (keyboardController._isVirtualScrolling()) {\n            currentFocusedRowIndex = visibleRowIndex + dataController.getRowIndexOffset();\n          }\n\n          keyboardController.setFocusedRowIndex(currentFocusedRowIndex);\n\n          this._triggerUpdateFocusedRow(focusedRowKey);\n        } else {\n          this._navigateToRow(focusedRowKey, true).done(function (focusedRowIndex) {\n            if (currentFocusedRowIndex >= 0 && focusedRowIndex < 0) {\n              _this2._focusRowByIndex();\n            }\n          });\n        }\n      } else {\n        if (currentFocusedRowIndex >= 0) {\n          this.getController(\"focus\")._focusRowByIndex(currentFocusedRowIndex);\n        }\n      }\n    },\n    isRowFocused: function (key) {\n      var focusedRowKey = this.option(\"focusedRowKey\");\n\n      if ((0, _type.isDefined)(focusedRowKey)) {\n        return (0, _common.equalByValue)(key, this.option(\"focusedRowKey\"));\n      }\n    },\n    updateFocusedRow: function (change) {\n      var that = this;\n\n      var focusedRowIndex = that._dataController.getRowIndexByKey(change.focusedRowKey);\n\n      var rowsView = that.getView(\"rowsView\");\n      var $tableElement;\n      (0, _iterator.each)(rowsView.getTableElements(), function (index, element) {\n        var _change$items;\n\n        var isMainTable = 0 === index;\n        $tableElement = (0, _renderer.default)(element);\n\n        that._clearPreviousFocusedRow($tableElement, focusedRowIndex);\n\n        that._prepareFocusedRow({\n          changedItem: null === change || void 0 === change ? void 0 : null === (_change$items = change.items) || void 0 === _change$items ? void 0 : _change$items[focusedRowIndex],\n          $tableElement: $tableElement,\n          focusedRowIndex: focusedRowIndex,\n          isMainTable: isMainTable\n        });\n      });\n    },\n    _clearPreviousFocusedRow: function ($tableElement, focusedRowIndex) {\n      var _this3 = this;\n\n      var isNotMasterDetailFocusedRow = function (_, focusedRow) {\n        var $focusedRowTable = (0, _renderer.default)(focusedRow).closest(\".\".concat(_this3.addWidgetPrefix(TABLE_POSTFIX_CLASS)));\n        return $tableElement.is($focusedRowTable);\n      };\n\n      var $prevRowFocusedElement = $tableElement.find(FOCUSED_ROW_SELECTOR).filter(isNotMasterDetailFocusedRow);\n      $prevRowFocusedElement.removeClass(ROW_FOCUSED_CLASS).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabindex\");\n      $prevRowFocusedElement.children(\"td\").removeAttr(\"tabindex\");\n\n      if (0 !== focusedRowIndex) {\n        var $firstRow = (0, _renderer.default)(this.getView(\"rowsView\").getRowElement(0));\n        $firstRow.removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\");\n      }\n    },\n    _prepareFocusedRow: function (options) {\n      var $row;\n      var changedItem = options.changedItem;\n\n      if (changedItem && (\"data\" === changedItem.rowType || \"group\" === changedItem.rowType)) {\n        var focusedRowIndex = options.focusedRowIndex;\n        var $tableElement = options.$tableElement;\n        var isMainTable = options.isMainTable;\n        var tabIndex = this.option(\"tabindex\") || 0;\n        var rowsView = this.getView(\"rowsView\");\n        $row = (0, _renderer.default)(rowsView._getRowElements($tableElement).eq(focusedRowIndex));\n        $row.addClass(ROW_FOCUSED_CLASS).attr(\"tabindex\", tabIndex);\n\n        if (isMainTable) {\n          rowsView.scrollToElementVertically($row);\n        }\n      }\n\n      return $row;\n    }\n  };\n}());\n\nvar _default = {\n  defaultOptions: function () {\n    return {\n      focusedRowEnabled: false,\n      autoNavigateToFocusedRow: true,\n      focusedRowKey: void 0,\n      focusedRowIndex: -1,\n      focusedColumnIndex: -1\n    };\n  },\n  controllers: {\n    focus: FocusController\n  },\n  extenders: {\n    controllers: {\n      keyboardNavigation: {\n        init: function () {\n          var rowIndex = this.option(\"focusedRowIndex\");\n          var columnIndex = this.option(\"focusedColumnIndex\");\n          this.createAction(\"onFocusedRowChanging\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedRowChanged\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedCellChanging\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.createAction(\"onFocusedCellChanged\", {\n            excludeValidators: [\"disabled\", \"readOnly\"]\n          });\n          this.callBase();\n          this.setRowFocusType();\n          this._focusedCellPosition = {};\n\n          if ((0, _type.isDefined)(rowIndex)) {\n            this._focusedCellPosition.rowIndex = this.option(\"focusedRowIndex\");\n          }\n\n          if ((0, _type.isDefined)(columnIndex)) {\n            this._focusedCellPosition.columnIndex = this.option(\"focusedColumnIndex\");\n          }\n        },\n        setFocusedRowIndex: function (rowIndex) {\n          var dataController = this.getController(\"data\");\n          this.callBase(rowIndex);\n          var visibleRowIndex = rowIndex - dataController.getRowIndexOffset();\n          var visibleRow = dataController.getVisibleRows()[visibleRowIndex];\n\n          if (!visibleRow || !visibleRow.isNewRow) {\n            this.option(\"focusedRowIndex\", rowIndex);\n          }\n        },\n        setFocusedColumnIndex: function (columnIndex) {\n          this.callBase(columnIndex);\n          this.option(\"focusedColumnIndex\", columnIndex);\n        },\n        _escapeKeyHandler: function (eventArgs, isEditing) {\n          if (isEditing || !this.option(\"focusedRowEnabled\")) {\n            this.callBase(eventArgs, isEditing);\n            return;\n          }\n\n          if (this.isCellFocusType()) {\n            this.setRowFocusType();\n\n            this._focus(this._getCellElementFromTarget(eventArgs.originalEvent.target), true);\n          }\n        },\n        _updateFocusedCellPosition: function ($cell, direction) {\n          var prevRowIndex = this.option(\"focusedRowIndex\");\n          var prevColumnIndex = this.option(\"focusedColumnIndex\");\n          var position = this.callBase($cell, direction);\n\n          if (position && position.columnIndex >= 0) {\n            this._fireFocusedCellChanged($cell, prevColumnIndex, prevRowIndex);\n          }\n        }\n      },\n      editorFactory: {\n        renderFocusOverlay: function ($element, hideBorder) {\n          var keyboardController = this.getController(\"keyboardNavigation\");\n          var focusedRowEnabled = this.option(\"focusedRowEnabled\");\n          var editingController = this.getController(\"editing\");\n\n          var isRowElement = \"row\" === keyboardController._getElementType($element);\n\n          var $cell;\n\n          if (!focusedRowEnabled || !keyboardController.isRowFocusType() || editingController.isEditing()) {\n            this.callBase($element, hideBorder);\n          } else {\n            if (focusedRowEnabled) {\n              if (isRowElement && !$element.hasClass(ROW_FOCUSED_CLASS)) {\n                $cell = keyboardController.getFirstValidCellInRow($element);\n                keyboardController.focus($cell);\n              }\n            }\n          }\n        }\n      },\n      columns: {\n        getSortDataSourceParameters: function (_, sortByKey) {\n          var _this4 = this;\n\n          var result = this.callBase.apply(this, arguments);\n          var dataController = this.getController(\"data\");\n          var dataSource = dataController._dataSource;\n          var store = dataController.store();\n          var key = store && store.key();\n          var remoteOperations = dataSource && dataSource.remoteOperations() || {};\n          var isLocalOperations = Object.keys(remoteOperations).every(function (operationName) {\n            return !remoteOperations[operationName];\n          });\n\n          if (key && (this.option(\"focusedRowEnabled\") && false !== this.getController(\"focus\").isAutoNavigateToFocusedRow() || sortByKey)) {\n            key = Array.isArray(key) ? key : [key];\n            var notSortedKeys = key.filter(function (key) {\n              return !_this4.columnOption(key, \"sortOrder\");\n            });\n\n            if (notSortedKeys.length) {\n              result = result || [];\n\n              if (isLocalOperations) {\n                result.push({\n                  selector: dataSource.getDataIndexGetter(),\n                  desc: false\n                });\n              } else {\n                notSortedKeys.forEach(function (notSortedKey) {\n                  return result.push({\n                    selector: notSortedKey,\n                    desc: false\n                  });\n                });\n              }\n            }\n          }\n\n          return result;\n        }\n      },\n      data: {\n        _applyChange: function (change) {\n          if (change && \"updateFocusedRow\" === change.changeType) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _fireChanged: function (e) {\n          this.callBase(e);\n\n          if (this.option(\"focusedRowEnabled\") && this._dataSource) {\n            var isPartialUpdate = \"update\" === e.changeType && e.repaintChangesOnly;\n            var isPartialUpdateWithDeleting = isPartialUpdate && e.changeTypes && e.changeTypes.indexOf(\"remove\") >= 0;\n\n            if (\"refresh\" === e.changeType && e.items.length || isPartialUpdateWithDeleting) {\n              this._updatePageIndexes();\n\n              this.processUpdateFocusedRow(e);\n            } else {\n              if (\"append\" === e.changeType || \"prepend\" === e.changeType) {\n                this._updatePageIndexes();\n              }\n            }\n          }\n        },\n        _updatePageIndexes: function () {\n          var prevRenderingPageIndex = this._lastRenderingPageIndex || 0;\n          var renderingPageIndex = this._rowsScrollController ? this._rowsScrollController.pageIndex() : 0;\n          this._lastRenderingPageIndex = renderingPageIndex;\n          this._isPagingByRendering = renderingPageIndex !== prevRenderingPageIndex;\n        },\n        isPagingByRendering: function () {\n          return this._isPagingByRendering;\n        },\n        processUpdateFocusedRow: function (e) {\n          var operationTypes = e.operationTypes || {};\n          var focusController = this.getController(\"focus\");\n          var reload = operationTypes.reload,\n              fullReload = operationTypes.fullReload;\n          var keyboardController = this.getController(\"keyboardNavigation\");\n\n          var isVirtualScrolling = keyboardController._isVirtualScrolling();\n\n          var focusedRowKey = this.option(\"focusedRowKey\");\n          var isAutoNavigate = focusController.isAutoNavigateToFocusedRow();\n\n          if (reload && !fullReload && (0, _type.isDefined)(focusedRowKey)) {\n            focusController._navigateToRow(focusedRowKey, true).done(function (focusedRowIndex) {\n              if (focusedRowIndex < 0) {\n                focusController._focusRowByIndex();\n              }\n            });\n          } else {\n            if (operationTypes.paging && !isVirtualScrolling) {\n              if (isAutoNavigate) {\n                var rowIndexByKey = this.getRowIndexByKey(focusedRowKey);\n                var isValidRowIndexByKey = rowIndexByKey >= 0;\n                var focusedRowIndex = this.option(\"focusedRowIndex\");\n                var needFocusRowByIndex = focusedRowIndex >= 0 && (focusedRowIndex === rowIndexByKey || !isValidRowIndexByKey);\n\n                if (needFocusRowByIndex) {\n                  focusController._focusRowByIndex();\n                }\n              } else {\n                if (this.getRowIndexByKey(focusedRowKey) < 0) {\n                  this.option(\"focusedRowIndex\", -1);\n                }\n              }\n            } else {\n              if (operationTypes.fullReload) {\n                focusController._focusRowByKeyOrIndex();\n              }\n            }\n          }\n        },\n        getPageIndexByKey: function (key) {\n          var that = this;\n          var d = new _deferred.Deferred();\n          that.getGlobalRowIndexByKey(key).done(function (globalIndex) {\n            d.resolve(globalIndex >= 0 ? Math.floor(globalIndex / that.pageSize()) : -1);\n          }).fail(d.reject);\n          return d.promise();\n        },\n        getGlobalRowIndexByKey: function (key) {\n          if (this._dataSource.group()) {\n            return this._calculateGlobalRowIndexByGroupedData(key);\n          }\n\n          return this._calculateGlobalRowIndexByFlatData(key);\n        },\n        _calculateGlobalRowIndexByFlatData: function (key, groupFilter, useGroup) {\n          var that = this;\n          var deferred = new _deferred.Deferred();\n          var dataSource = that._dataSource;\n\n          var filter = that._generateFilterByKey(key);\n\n          dataSource.load({\n            filter: that._concatWithCombinedFilter(filter),\n            skip: 0,\n            take: 1\n          }).done(function (data) {\n            if (data.length > 0) {\n              filter = that._generateOperationFilterByKey(key, data[0], useGroup);\n              dataSource.load({\n                filter: that._concatWithCombinedFilter(filter, groupFilter),\n                skip: 0,\n                take: 1,\n                requireTotalCount: true\n              }).done(function (_, extra) {\n                deferred.resolve(extra.totalCount);\n              });\n            } else {\n              deferred.resolve(-1);\n            }\n          });\n          return deferred.promise();\n        },\n        _concatWithCombinedFilter: function (filter, groupFilter) {\n          var combinedFilter = this.getCombinedFilter();\n          return _uiGrid_core2.default.combineFilters([filter, combinedFilter, groupFilter]);\n        },\n        _generateBooleanFilter: function (selector, value, sortInfo) {\n          var result;\n\n          if (false === value) {\n            result = [selector, \"=\", sortInfo.desc ? true : null];\n          } else {\n            if (true === value ? !sortInfo.desc : sortInfo.desc) {\n              result = [selector, \"<>\", value];\n            }\n          }\n\n          return result;\n        },\n        _generateOperationFilterByKey: function (key, rowData, useGroup) {\n          var that = this;\n          var dataSource = that._dataSource;\n\n          var filter = that._generateFilterByKey(key, \"<\");\n\n          var sort = that._columnsController.getSortDataSourceParameters(!dataSource.remoteOperations().filtering, true);\n\n          if (useGroup) {\n            var group = that._columnsController.getGroupDataSourceParameters(!dataSource.remoteOperations().filtering);\n\n            if (group) {\n              sort = sort ? group.concat(sort) : group;\n            }\n          }\n\n          if (sort) {\n            sort.slice().reverse().forEach(function (sortInfo) {\n              var selector = sortInfo.selector;\n              var getter;\n\n              if (\"function\" === typeof selector) {\n                getter = selector;\n              } else {\n                getter = that._columnsController.columnOption(selector, \"selector\");\n              }\n\n              var value = getter ? getter(rowData) : rowData[selector];\n              filter = [[selector, \"=\", value], \"and\", filter];\n\n              if (null === value || (0, _type.isBoolean)(value)) {\n                var booleanFilter = that._generateBooleanFilter(selector, value, sortInfo);\n\n                if (booleanFilter) {\n                  filter = [booleanFilter, \"or\", filter];\n                }\n              } else {\n                var filterOperation = sortInfo.desc ? \">\" : \"<\";\n                var sortFilter = [selector, filterOperation, value];\n\n                if (!sortInfo.desc) {\n                  sortFilter = [sortFilter, \"or\", [selector, \"=\", null]];\n                }\n\n                filter = [sortFilter, \"or\", filter];\n              }\n            });\n          }\n\n          return filter;\n        },\n        _generateFilterByKey: function (key, operation) {\n          var dataSourceKey = this._dataSource.key();\n\n          var filter = [];\n\n          if (!operation) {\n            operation = \"=\";\n          }\n\n          if (Array.isArray(dataSourceKey)) {\n            for (var i = 0; i < dataSourceKey.length; ++i) {\n              var keyPart = key[dataSourceKey[i]];\n\n              if (keyPart) {\n                if (filter.length > 0) {\n                  filter.push(\"and\");\n                }\n\n                filter.push([dataSourceKey[i], operation, keyPart]);\n              }\n            }\n          } else {\n            filter = [dataSourceKey, operation, key];\n          }\n\n          return filter;\n        },\n        _getLastItemIndex: function () {\n          return this.items(true).length - 1;\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        _createRow: function (row) {\n          var $row = this.callBase(row);\n\n          if (this.option(\"focusedRowEnabled\") && row) {\n            if (this.getController(\"focus\").isRowFocused(row.key)) {\n              $row.addClass(ROW_FOCUSED_CLASS);\n            }\n          }\n\n          return $row;\n        },\n        _checkRowKeys: function (options) {\n          this.callBase.apply(this, arguments);\n\n          if (this.option(\"focusedRowEnabled\") && this.option(\"dataSource\")) {\n            var store = this._dataController.store();\n\n            if (store && !store.key()) {\n              this._dataController.fireError(\"E1042\", \"Row focusing\");\n            }\n          }\n        },\n        _update: function (change) {\n          if (\"updateFocusedRow\" === change.changeType) {\n            if (this.option(\"focusedRowEnabled\")) {\n              this.getController(\"focus\").updateFocusedRow(change);\n            }\n          } else {\n            this.callBase(change);\n          }\n        },\n        updateFocusElementTabIndex: function ($cellElements, preventScroll) {\n          if (this.option(\"focusedRowEnabled\")) {\n            this._setFocusedRowElementTabIndex(preventScroll);\n          } else {\n            this.callBase($cellElements);\n          }\n        },\n        _setFocusedRowElementTabIndex: function (preventScroll) {\n          var _this5 = this;\n\n          var focusedRowKey = this.option(\"focusedRowKey\");\n          var tabIndex = this.option(\"tabIndex\") || 0;\n          var dataController = this._dataController;\n          var columnsController = this._columnsController;\n          var rowIndex = dataController.getRowIndexByKey(focusedRowKey);\n          var columnIndex = this.option(\"focusedColumnIndex\");\n\n          var $row = this._findRowElementForTabIndex();\n\n          if (!(0, _type.isDefined)(this._scrollToFocusOnResize)) {\n            this._scrollToFocusOnResize = function () {\n              _this5.scrollToElementVertically(_this5._findRowElementForTabIndex());\n\n              _this5.resizeCompleted.remove(_this5._scrollToFocusOnResize);\n            };\n          }\n\n          $row.attr(\"tabIndex\", tabIndex);\n\n          if (rowIndex >= 0 && !preventScroll) {\n            if (columnIndex < 0) {\n              columnIndex = 0;\n            }\n\n            rowIndex += dataController.getRowIndexOffset();\n            columnIndex += columnsController.getColumnIndexOffset();\n            this.getController(\"keyboardNavigation\").setFocusedCellPosition(rowIndex, columnIndex);\n\n            if (this.getController(\"focus\").isAutoNavigateToFocusedRow()) {\n              var dataSource = dataController.dataSource();\n              var operationTypes = dataSource && dataSource.operationTypes();\n\n              if (operationTypes && !operationTypes.paging && !dataController.isPagingByRendering()) {\n                this.resizeCompleted.remove(this._scrollToFocusOnResize);\n                this.resizeCompleted.add(this._scrollToFocusOnResize);\n              }\n            }\n          }\n        },\n        _findRowElementForTabIndex: function () {\n          var focusedRowKey = this.option(\"focusedRowKey\");\n\n          var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\n\n          return (0, _renderer.default)(this.getRowElement(rowIndex >= 0 ? rowIndex : 0));\n        },\n        scrollToRowElement: function (key) {\n          var rowIndex = this.getController(\"data\").getRowIndexByKey(key);\n          var $row = (0, _renderer.default)(this.getRow(rowIndex));\n          this.scrollToElementVertically($row);\n        },\n        scrollToElementVertically: function ($row) {\n          var scrollable = this.getScrollable();\n\n          if (scrollable) {\n            var position = scrollable.getScrollElementPosition($row, \"vertical\");\n            scrollable.scrollTo({\n              top: position\n            });\n          }\n        }\n      }\n    }\n  }\n};\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Users/CapiniaC/Desktop/Collection/Work/project/security/node_modules/devextreme/ui/grid_core/ui.grid_core.focus.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_uiGrid_core","_iterator","_uiGrid_core2","_common","_type","_deferred","obj","__esModule","ROW_FOCUSED_CLASS","FOCUSED_ROW_SELECTOR","TABLE_POSTFIX_CLASS","CELL_FOCUS_DISABLED_CLASS","FocusController","ViewController","inherit","init","_dataController","getController","_keyboardController","component","_optionsByReference","focusedRowKey","optionChanged","args","name","option","_focusRowByIndex","value","_triggerFocusedRowChangedIfNeed","handled","focusedRowIndex","_focusRowByKey","callBase","focusedRowIndexByKey","getFocusedRowIndexByKey","rowIndex","getRowIndexByKey","$rowElement","getView","getRowElement","_fireFocusedRowChanged","isAutoNavigateToFocusedRow","index","_resetFocusedRow","_focusRowByIndexCore","_this","dataController","pageSize","setKeyByIndex","_isValidFocusedRowIndex","visibleIndex","getRowIndexOffset","lastItemIndex","_getLastItemIndex","Math","min","getKeyByRowIndex","isDefined","isRowFocused","_isLocalRowIndex","pageIndex","floor","when","waitReady","done","isVirtualScrolling","_isVirtualScrolling","virtualItems","virtualItemsCount","virtualItemsBegin","begin","visibleRowsCount","getVisibleRows","length","visiblePagesCount","ceil","_setFocusedRowKeyByIndex","items","key","_navigateToRow","isFocusedRowKeyDefined","keyboardController","setFocusedRowIndex","updateItems","changeType","row","rowType","publicMethods","navigateToRow","needFocusRow","that","isAutoNavigate","d","Deferred","dataSource","reject","promise","rowIndexByKey","_navigateTo","getPageIndexByKey","resolve","reload","fail","deferred","visibleRowIndex","isVirtualRowRenderingMode","_navigateToVirtualRow","_navigateToVisibleRow","_triggerUpdateFocusedRow","scrollToRowElement","rowsScrollController","_rowsScrollController","getIndexByKey","scrollable","getScrollable","getRowIndexDelta","offset","getItemOffset","triggerUpdateFocusedRow","off","on","scrollTo","y","loadedRowIndex","_focusRowByKeyOrIndex","_this2","currentFocusedRowIndex","equalByValue","updateFocusedRow","change","rowsView","$tableElement","each","getTableElements","element","_change$items","isMainTable","_clearPreviousFocusedRow","_prepareFocusedRow","changedItem","_this3","isNotMasterDetailFocusedRow","_","focusedRow","$focusedRowTable","closest","concat","addWidgetPrefix","is","$prevRowFocusedElement","find","filter","removeClass","removeAttr","children","$firstRow","options","$row","tabIndex","_getRowElements","eq","addClass","attr","scrollToElementVertically","_default","defaultOptions","focusedRowEnabled","autoNavigateToFocusedRow","focusedColumnIndex","controllers","focus","extenders","keyboardNavigation","columnIndex","createAction","excludeValidators","setRowFocusType","_focusedCellPosition","visibleRow","isNewRow","setFocusedColumnIndex","_escapeKeyHandler","eventArgs","isEditing","isCellFocusType","_focus","_getCellElementFromTarget","originalEvent","target","_updateFocusedCellPosition","$cell","direction","prevRowIndex","prevColumnIndex","position","_fireFocusedCellChanged","editorFactory","renderFocusOverlay","$element","hideBorder","editingController","isRowElement","_getElementType","isRowFocusType","hasClass","getFirstValidCellInRow","columns","getSortDataSourceParameters","sortByKey","_this4","result","apply","arguments","_dataSource","store","remoteOperations","isLocalOperations","Object","keys","every","operationName","Array","isArray","notSortedKeys","columnOption","push","selector","getDataIndexGetter","desc","forEach","notSortedKey","data","_applyChange","_fireChanged","e","isPartialUpdate","repaintChangesOnly","isPartialUpdateWithDeleting","changeTypes","indexOf","_updatePageIndexes","processUpdateFocusedRow","prevRenderingPageIndex","_lastRenderingPageIndex","renderingPageIndex","_isPagingByRendering","isPagingByRendering","operationTypes","focusController","fullReload","paging","isValidRowIndexByKey","needFocusRowByIndex","getGlobalRowIndexByKey","globalIndex","group","_calculateGlobalRowIndexByGroupedData","_calculateGlobalRowIndexByFlatData","groupFilter","useGroup","_generateFilterByKey","load","_concatWithCombinedFilter","skip","take","_generateOperationFilterByKey","requireTotalCount","extra","totalCount","combinedFilter","getCombinedFilter","combineFilters","_generateBooleanFilter","sortInfo","rowData","sort","_columnsController","filtering","getGroupDataSourceParameters","slice","reverse","getter","isBoolean","booleanFilter","filterOperation","sortFilter","operation","dataSourceKey","i","keyPart","views","_createRow","_checkRowKeys","fireError","_update","updateFocusElementTabIndex","$cellElements","preventScroll","_setFocusedRowElementTabIndex","_this5","columnsController","_findRowElementForTabIndex","_scrollToFocusOnResize","resizeCompleted","remove","getColumnIndexOffset","setFocusedCellPosition","add","getRow","getScrollElementPosition","top","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.focus.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _uiGrid_core = _interopRequireDefault(require(\"./ui.grid_core.modules\"));\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _uiGrid_core2 = _interopRequireDefault(require(\"./ui.grid_core.utils\"));\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar ROW_FOCUSED_CLASS = \"dx-row-focused\";\r\nvar FOCUSED_ROW_SELECTOR = \".dx-row.\" + ROW_FOCUSED_CLASS;\r\nvar TABLE_POSTFIX_CLASS = \"table\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nvar FocusController = _uiGrid_core.default.ViewController.inherit(function() {\r\n    return {\r\n        init: function() {\r\n            this._dataController = this.getController(\"data\");\r\n            this._keyboardController = this.getController(\"keyboardNavigation\");\r\n            this.component._optionsByReference.focusedRowKey = true\r\n        },\r\n        optionChanged: function(args) {\r\n            if (\"focusedRowIndex\" === args.name) {\r\n                var focusedRowKey = this.option(\"focusedRowKey\");\r\n                this._focusRowByIndex(args.value);\r\n                this._triggerFocusedRowChangedIfNeed(focusedRowKey, args.value);\r\n                args.handled = true\r\n            } else {\r\n                if (\"focusedRowKey\" === args.name) {\r\n                    var focusedRowIndex = this.option(\"focusedRowIndex\");\r\n                    this._focusRowByKey(args.value);\r\n                    this._triggerFocusedRowChangedIfNeed(args.value, focusedRowIndex);\r\n                    args.handled = true\r\n                } else {\r\n                    if (\"focusedColumnIndex\" === args.name) {\r\n                        args.handled = true\r\n                    } else {\r\n                        if (\"focusedRowEnabled\" === args.name) {\r\n                            args.handled = true\r\n                        } else {\r\n                            if (\"autoNavigateToFocusedRow\" === args.name) {\r\n                                args.handled = true\r\n                            } else {\r\n                                this.callBase(args)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _triggerFocusedRowChangedIfNeed: function(focusedRowKey, focusedRowIndex) {\r\n            var focusedRowIndexByKey = this.getFocusedRowIndexByKey(focusedRowKey);\r\n            if (focusedRowIndex === focusedRowIndexByKey) {\r\n                var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\r\n                if (rowIndex >= 0) {\r\n                    var $rowElement = (0, _renderer.default)(this.getView(\"rowsView\").getRowElement(rowIndex));\r\n                    this.getController(\"keyboardNavigation\")._fireFocusedRowChanged($rowElement, focusedRowIndex)\r\n                }\r\n            }\r\n        },\r\n        isAutoNavigateToFocusedRow: function() {\r\n            return \"infinite\" !== this.option(\"scrolling.mode\") && this.option(\"autoNavigateToFocusedRow\")\r\n        },\r\n        _focusRowByIndex: function(index) {\r\n            if (!this.option(\"focusedRowEnabled\")) {\r\n                return\r\n            }\r\n            index = void 0 !== index ? index : this.option(\"focusedRowIndex\");\r\n            if (index < 0) {\r\n                if (this.isAutoNavigateToFocusedRow()) {\r\n                    this._resetFocusedRow()\r\n                }\r\n            } else {\r\n                this._focusRowByIndexCore(index)\r\n            }\r\n        },\r\n        _focusRowByIndexCore: function(index) {\r\n            var _this = this;\r\n            var dataController = this.getController(\"data\");\r\n            var pageSize = dataController.pageSize();\r\n            var setKeyByIndex = function() {\r\n                if (_this._isValidFocusedRowIndex(index)) {\r\n                    var visibleIndex = index - dataController.getRowIndexOffset(true);\r\n                    var lastItemIndex = dataController._getLastItemIndex();\r\n                    var rowIndex = Math.min(visibleIndex, lastItemIndex);\r\n                    var focusedRowKey = dataController.getKeyByRowIndex(rowIndex, true);\r\n                    if ((0, _type.isDefined)(focusedRowKey) && !_this.isRowFocused(focusedRowKey)) {\r\n                        _this.option(\"focusedRowKey\", focusedRowKey)\r\n                    }\r\n                }\r\n            };\r\n            if (pageSize >= 0) {\r\n                if (!this._isLocalRowIndex(index)) {\r\n                    var pageIndex = Math.floor(index / dataController.pageSize());\r\n                    (0, _deferred.when)(dataController.pageIndex(pageIndex), dataController.waitReady()).done(function() {\r\n                        setKeyByIndex()\r\n                    })\r\n                } else {\r\n                    setKeyByIndex()\r\n                }\r\n            }\r\n        },\r\n        _isLocalRowIndex: function(index) {\r\n            var dataController = this.getController(\"data\");\r\n            var isVirtualScrolling = this.getController(\"keyboardNavigation\")._isVirtualScrolling();\r\n            if (isVirtualScrolling) {\r\n                var pageIndex = Math.floor(index / dataController.pageSize());\r\n                var virtualItems = dataController.virtualItemsCount();\r\n                var virtualItemsBegin = virtualItems ? virtualItems.begin : -1;\r\n                var visibleRowsCount = dataController.getVisibleRows().length + dataController.getRowIndexOffset();\r\n                var visiblePagesCount = Math.ceil(visibleRowsCount / dataController.pageSize());\r\n                return virtualItemsBegin <= index && visiblePagesCount > pageIndex\r\n            }\r\n            return true\r\n        },\r\n        _setFocusedRowKeyByIndex: function(index) {\r\n            var dataController = this.getController(\"data\");\r\n            if (this._isValidFocusedRowIndex(index)) {\r\n                var rowIndex = Math.min(index - dataController.getRowIndexOffset(), dataController.items().length - 1);\r\n                var focusedRowKey = dataController.getKeyByRowIndex(rowIndex);\r\n                if ((0, _type.isDefined)(focusedRowKey) && !this.isRowFocused(focusedRowKey)) {\r\n                    this.option(\"focusedRowKey\", focusedRowKey)\r\n                }\r\n            }\r\n        },\r\n        _focusRowByKey: function(key) {\r\n            if (!(0, _type.isDefined)(key)) {\r\n                this._resetFocusedRow()\r\n            } else {\r\n                this._navigateToRow(key, true)\r\n            }\r\n        },\r\n        _resetFocusedRow: function() {\r\n            var focusedRowKey = this.option(\"focusedRowKey\");\r\n            var isFocusedRowKeyDefined = (0, _type.isDefined)(focusedRowKey);\r\n            if (!isFocusedRowKeyDefined && this.option(\"focusedRowIndex\") < 0) {\r\n                return\r\n            }\r\n            var keyboardController = this.getController(\"keyboardNavigation\");\r\n            if (isFocusedRowKeyDefined) {\r\n                this.option(\"focusedRowKey\", void 0)\r\n            }\r\n            keyboardController.setFocusedRowIndex(-1);\r\n            this.option(\"focusedRowIndex\", -1);\r\n            this.getController(\"data\").updateItems({\r\n                changeType: \"updateFocusedRow\",\r\n                focusedRowKey: void 0\r\n            });\r\n            keyboardController._fireFocusedRowChanged(void 0, -1)\r\n        },\r\n        _isValidFocusedRowIndex: function(rowIndex) {\r\n            var dataController = this.getController(\"data\");\r\n            var row = dataController.getVisibleRows()[rowIndex];\r\n            return !row || \"data\" === row.rowType || \"group\" === row.rowType\r\n        },\r\n        publicMethods: function() {\r\n            return [\"navigateToRow\", \"isRowFocused\"]\r\n        },\r\n        navigateToRow: function(key) {\r\n            if (!this.isAutoNavigateToFocusedRow()) {\r\n                this.option(\"focusedRowIndex\", -1)\r\n            }\r\n            this._navigateToRow(key)\r\n        },\r\n        _navigateToRow: function(key, needFocusRow) {\r\n            var that = this;\r\n            var dataController = that.getController(\"data\");\r\n            var isAutoNavigate = that.isAutoNavigateToFocusedRow();\r\n            var d = new _deferred.Deferred;\r\n            if (void 0 === key || !dataController.dataSource()) {\r\n                return d.reject().promise()\r\n            }\r\n            var rowIndexByKey = that.getFocusedRowIndexByKey(key);\r\n            if (!isAutoNavigate && needFocusRow || rowIndexByKey >= 0) {\r\n                that._navigateTo(key, d, needFocusRow)\r\n            } else {\r\n                dataController.getPageIndexByKey(key).done(function(pageIndex) {\r\n                    if (pageIndex < 0) {\r\n                        d.resolve(-1);\r\n                        return\r\n                    }\r\n                    if (pageIndex === dataController.pageIndex()) {\r\n                        dataController.reload().done(function() {\r\n                            if (that.isRowFocused(key)) {\r\n                                d.resolve(that.getFocusedRowIndexByKey(key))\r\n                            } else {\r\n                                that._navigateTo(key, d, needFocusRow)\r\n                            }\r\n                        }).fail(d.reject)\r\n                    } else {\r\n                        dataController.pageIndex(pageIndex).done(function() {\r\n                            that._navigateTo(key, d, needFocusRow)\r\n                        }).fail(d.reject)\r\n                    }\r\n                }).fail(d.reject)\r\n            }\r\n            return d.promise()\r\n        },\r\n        _navigateTo: function(key, deferred, needFocusRow) {\r\n            var visibleRowIndex = this.getController(\"data\").getRowIndexByKey(key);\r\n            var isVirtualRowRenderingMode = \"virtual\" === this.option(\"scrolling.rowRenderingMode\");\r\n            var isAutoNavigate = this.isAutoNavigateToFocusedRow();\r\n            if (isAutoNavigate && isVirtualRowRenderingMode && visibleRowIndex < 0) {\r\n                this._navigateToVirtualRow(key, deferred, needFocusRow)\r\n            } else {\r\n                this._navigateToVisibleRow(key, deferred, needFocusRow)\r\n            }\r\n        },\r\n        _navigateToVisibleRow: function(key, deferred, needFocusRow) {\r\n            if (needFocusRow) {\r\n                this._triggerUpdateFocusedRow(key, deferred)\r\n            } else {\r\n                this.getView(\"rowsView\").scrollToRowElement(key)\r\n            }\r\n        },\r\n        _navigateToVirtualRow: function(key, deferred, needFocusRow) {\r\n            var that = this;\r\n            var dataController = this.getController(\"data\");\r\n            var rowsScrollController = dataController._rowsScrollController;\r\n            var rowIndex = _uiGrid_core2.default.getIndexByKey(key, dataController.items(true));\r\n            var scrollable = that.getView(\"rowsView\").getScrollable();\r\n            if (rowsScrollController && scrollable && rowIndex >= 0) {\r\n                var focusedRowIndex = rowIndex + dataController.getRowIndexOffset() - dataController.getRowIndexDelta();\r\n                var offset = rowsScrollController.getItemOffset(focusedRowIndex);\r\n                if (needFocusRow) {\r\n                    var triggerUpdateFocusedRow = function triggerUpdateFocusedRow() {\r\n                        that.component.off(\"contentReady\", triggerUpdateFocusedRow);\r\n                        that._triggerUpdateFocusedRow(key, deferred)\r\n                    };\r\n                    that.component.on(\"contentReady\", triggerUpdateFocusedRow)\r\n                }\r\n                scrollable.scrollTo({\r\n                    y: offset\r\n                })\r\n            }\r\n        },\r\n        _triggerUpdateFocusedRow: function(key, deferred) {\r\n            var dataController = this.getController(\"data\");\r\n            var focusedRowIndex = this.getFocusedRowIndexByKey(key);\r\n            if (this._isValidFocusedRowIndex(focusedRowIndex)) {\r\n                if (this.option(\"focusedRowEnabled\")) {\r\n                    dataController.updateItems({\r\n                        changeType: \"updateFocusedRow\",\r\n                        focusedRowKey: key\r\n                    })\r\n                } else {\r\n                    this.getView(\"rowsView\").scrollToRowElement(key)\r\n                }\r\n                this.getController(\"keyboardNavigation\").setFocusedRowIndex(focusedRowIndex);\r\n                deferred && deferred.resolve(focusedRowIndex)\r\n            } else {\r\n                deferred && deferred.resolve(-1)\r\n            }\r\n        },\r\n        getFocusedRowIndexByKey: function(key) {\r\n            var dataController = this.getController(\"data\");\r\n            var loadedRowIndex = dataController.getRowIndexByKey(key, true);\r\n            return loadedRowIndex >= 0 ? loadedRowIndex + dataController.getRowIndexOffset(true) : -1\r\n        },\r\n        _focusRowByKeyOrIndex: function() {\r\n            var _this2 = this;\r\n            var focusedRowKey = this.option(\"focusedRowKey\");\r\n            var currentFocusedRowIndex = this.option(\"focusedRowIndex\");\r\n            var keyboardController = this.getController(\"keyboardNavigation\");\r\n            var dataController = this.getController(\"data\");\r\n            if ((0, _type.isDefined)(focusedRowKey)) {\r\n                var visibleRowIndex = dataController.getRowIndexByKey(focusedRowKey);\r\n                if (visibleRowIndex >= 0) {\r\n                    if (keyboardController._isVirtualScrolling()) {\r\n                        currentFocusedRowIndex = visibleRowIndex + dataController.getRowIndexOffset()\r\n                    }\r\n                    keyboardController.setFocusedRowIndex(currentFocusedRowIndex);\r\n                    this._triggerUpdateFocusedRow(focusedRowKey)\r\n                } else {\r\n                    this._navigateToRow(focusedRowKey, true).done(function(focusedRowIndex) {\r\n                        if (currentFocusedRowIndex >= 0 && focusedRowIndex < 0) {\r\n                            _this2._focusRowByIndex()\r\n                        }\r\n                    })\r\n                }\r\n            } else {\r\n                if (currentFocusedRowIndex >= 0) {\r\n                    this.getController(\"focus\")._focusRowByIndex(currentFocusedRowIndex)\r\n                }\r\n            }\r\n        },\r\n        isRowFocused: function(key) {\r\n            var focusedRowKey = this.option(\"focusedRowKey\");\r\n            if ((0, _type.isDefined)(focusedRowKey)) {\r\n                return (0, _common.equalByValue)(key, this.option(\"focusedRowKey\"))\r\n            }\r\n        },\r\n        updateFocusedRow: function(change) {\r\n            var that = this;\r\n            var focusedRowIndex = that._dataController.getRowIndexByKey(change.focusedRowKey);\r\n            var rowsView = that.getView(\"rowsView\");\r\n            var $tableElement;\r\n            (0, _iterator.each)(rowsView.getTableElements(), function(index, element) {\r\n                var _change$items;\r\n                var isMainTable = 0 === index;\r\n                $tableElement = (0, _renderer.default)(element);\r\n                that._clearPreviousFocusedRow($tableElement, focusedRowIndex);\r\n                that._prepareFocusedRow({\r\n                    changedItem: null === change || void 0 === change ? void 0 : null === (_change$items = change.items) || void 0 === _change$items ? void 0 : _change$items[focusedRowIndex],\r\n                    $tableElement: $tableElement,\r\n                    focusedRowIndex: focusedRowIndex,\r\n                    isMainTable: isMainTable\r\n                })\r\n            })\r\n        },\r\n        _clearPreviousFocusedRow: function($tableElement, focusedRowIndex) {\r\n            var _this3 = this;\r\n            var isNotMasterDetailFocusedRow = function(_, focusedRow) {\r\n                var $focusedRowTable = (0, _renderer.default)(focusedRow).closest(\".\".concat(_this3.addWidgetPrefix(TABLE_POSTFIX_CLASS)));\r\n                return $tableElement.is($focusedRowTable)\r\n            };\r\n            var $prevRowFocusedElement = $tableElement.find(FOCUSED_ROW_SELECTOR).filter(isNotMasterDetailFocusedRow);\r\n            $prevRowFocusedElement.removeClass(ROW_FOCUSED_CLASS).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabindex\");\r\n            $prevRowFocusedElement.children(\"td\").removeAttr(\"tabindex\");\r\n            if (0 !== focusedRowIndex) {\r\n                var $firstRow = (0, _renderer.default)(this.getView(\"rowsView\").getRowElement(0));\r\n                $firstRow.removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\")\r\n            }\r\n        },\r\n        _prepareFocusedRow: function(options) {\r\n            var $row;\r\n            var changedItem = options.changedItem;\r\n            if (changedItem && (\"data\" === changedItem.rowType || \"group\" === changedItem.rowType)) {\r\n                var focusedRowIndex = options.focusedRowIndex;\r\n                var $tableElement = options.$tableElement;\r\n                var isMainTable = options.isMainTable;\r\n                var tabIndex = this.option(\"tabindex\") || 0;\r\n                var rowsView = this.getView(\"rowsView\");\r\n                $row = (0, _renderer.default)(rowsView._getRowElements($tableElement).eq(focusedRowIndex));\r\n                $row.addClass(ROW_FOCUSED_CLASS).attr(\"tabindex\", tabIndex);\r\n                if (isMainTable) {\r\n                    rowsView.scrollToElementVertically($row)\r\n                }\r\n            }\r\n            return $row\r\n        }\r\n    }\r\n}());\r\nvar _default = {\r\n    defaultOptions: function() {\r\n        return {\r\n            focusedRowEnabled: false,\r\n            autoNavigateToFocusedRow: true,\r\n            focusedRowKey: void 0,\r\n            focusedRowIndex: -1,\r\n            focusedColumnIndex: -1\r\n        }\r\n    },\r\n    controllers: {\r\n        focus: FocusController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            keyboardNavigation: {\r\n                init: function() {\r\n                    var rowIndex = this.option(\"focusedRowIndex\");\r\n                    var columnIndex = this.option(\"focusedColumnIndex\");\r\n                    this.createAction(\"onFocusedRowChanging\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedRowChanged\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedCellChanging\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.createAction(\"onFocusedCellChanged\", {\r\n                        excludeValidators: [\"disabled\", \"readOnly\"]\r\n                    });\r\n                    this.callBase();\r\n                    this.setRowFocusType();\r\n                    this._focusedCellPosition = {};\r\n                    if ((0, _type.isDefined)(rowIndex)) {\r\n                        this._focusedCellPosition.rowIndex = this.option(\"focusedRowIndex\")\r\n                    }\r\n                    if ((0, _type.isDefined)(columnIndex)) {\r\n                        this._focusedCellPosition.columnIndex = this.option(\"focusedColumnIndex\")\r\n                    }\r\n                },\r\n                setFocusedRowIndex: function(rowIndex) {\r\n                    var dataController = this.getController(\"data\");\r\n                    this.callBase(rowIndex);\r\n                    var visibleRowIndex = rowIndex - dataController.getRowIndexOffset();\r\n                    var visibleRow = dataController.getVisibleRows()[visibleRowIndex];\r\n                    if (!visibleRow || !visibleRow.isNewRow) {\r\n                        this.option(\"focusedRowIndex\", rowIndex)\r\n                    }\r\n                },\r\n                setFocusedColumnIndex: function(columnIndex) {\r\n                    this.callBase(columnIndex);\r\n                    this.option(\"focusedColumnIndex\", columnIndex)\r\n                },\r\n                _escapeKeyHandler: function(eventArgs, isEditing) {\r\n                    if (isEditing || !this.option(\"focusedRowEnabled\")) {\r\n                        this.callBase(eventArgs, isEditing);\r\n                        return\r\n                    }\r\n                    if (this.isCellFocusType()) {\r\n                        this.setRowFocusType();\r\n                        this._focus(this._getCellElementFromTarget(eventArgs.originalEvent.target), true)\r\n                    }\r\n                },\r\n                _updateFocusedCellPosition: function($cell, direction) {\r\n                    var prevRowIndex = this.option(\"focusedRowIndex\");\r\n                    var prevColumnIndex = this.option(\"focusedColumnIndex\");\r\n                    var position = this.callBase($cell, direction);\r\n                    if (position && position.columnIndex >= 0) {\r\n                        this._fireFocusedCellChanged($cell, prevColumnIndex, prevRowIndex)\r\n                    }\r\n                }\r\n            },\r\n            editorFactory: {\r\n                renderFocusOverlay: function($element, hideBorder) {\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var focusedRowEnabled = this.option(\"focusedRowEnabled\");\r\n                    var editingController = this.getController(\"editing\");\r\n                    var isRowElement = \"row\" === keyboardController._getElementType($element);\r\n                    var $cell;\r\n                    if (!focusedRowEnabled || !keyboardController.isRowFocusType() || editingController.isEditing()) {\r\n                        this.callBase($element, hideBorder)\r\n                    } else {\r\n                        if (focusedRowEnabled) {\r\n                            if (isRowElement && !$element.hasClass(ROW_FOCUSED_CLASS)) {\r\n                                $cell = keyboardController.getFirstValidCellInRow($element);\r\n                                keyboardController.focus($cell)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            columns: {\r\n                getSortDataSourceParameters: function(_, sortByKey) {\r\n                    var _this4 = this;\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    var dataController = this.getController(\"data\");\r\n                    var dataSource = dataController._dataSource;\r\n                    var store = dataController.store();\r\n                    var key = store && store.key();\r\n                    var remoteOperations = dataSource && dataSource.remoteOperations() || {};\r\n                    var isLocalOperations = Object.keys(remoteOperations).every(function(operationName) {\r\n                        return !remoteOperations[operationName]\r\n                    });\r\n                    if (key && (this.option(\"focusedRowEnabled\") && false !== this.getController(\"focus\").isAutoNavigateToFocusedRow() || sortByKey)) {\r\n                        key = Array.isArray(key) ? key : [key];\r\n                        var notSortedKeys = key.filter(function(key) {\r\n                            return !_this4.columnOption(key, \"sortOrder\")\r\n                        });\r\n                        if (notSortedKeys.length) {\r\n                            result = result || [];\r\n                            if (isLocalOperations) {\r\n                                result.push({\r\n                                    selector: dataSource.getDataIndexGetter(),\r\n                                    desc: false\r\n                                })\r\n                            } else {\r\n                                notSortedKeys.forEach(function(notSortedKey) {\r\n                                    return result.push({\r\n                                        selector: notSortedKey,\r\n                                        desc: false\r\n                                    })\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n                    return result\r\n                }\r\n            },\r\n            data: {\r\n                _applyChange: function(change) {\r\n                    if (change && \"updateFocusedRow\" === change.changeType) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _fireChanged: function(e) {\r\n                    this.callBase(e);\r\n                    if (this.option(\"focusedRowEnabled\") && this._dataSource) {\r\n                        var isPartialUpdate = \"update\" === e.changeType && e.repaintChangesOnly;\r\n                        var isPartialUpdateWithDeleting = isPartialUpdate && e.changeTypes && e.changeTypes.indexOf(\"remove\") >= 0;\r\n                        if (\"refresh\" === e.changeType && e.items.length || isPartialUpdateWithDeleting) {\r\n                            this._updatePageIndexes();\r\n                            this.processUpdateFocusedRow(e)\r\n                        } else {\r\n                            if (\"append\" === e.changeType || \"prepend\" === e.changeType) {\r\n                                this._updatePageIndexes()\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                _updatePageIndexes: function() {\r\n                    var prevRenderingPageIndex = this._lastRenderingPageIndex || 0;\r\n                    var renderingPageIndex = this._rowsScrollController ? this._rowsScrollController.pageIndex() : 0;\r\n                    this._lastRenderingPageIndex = renderingPageIndex;\r\n                    this._isPagingByRendering = renderingPageIndex !== prevRenderingPageIndex\r\n                },\r\n                isPagingByRendering: function() {\r\n                    return this._isPagingByRendering\r\n                },\r\n                processUpdateFocusedRow: function(e) {\r\n                    var operationTypes = e.operationTypes || {};\r\n                    var focusController = this.getController(\"focus\");\r\n                    var reload = operationTypes.reload,\r\n                        fullReload = operationTypes.fullReload;\r\n                    var keyboardController = this.getController(\"keyboardNavigation\");\r\n                    var isVirtualScrolling = keyboardController._isVirtualScrolling();\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var isAutoNavigate = focusController.isAutoNavigateToFocusedRow();\r\n                    if (reload && !fullReload && (0, _type.isDefined)(focusedRowKey)) {\r\n                        focusController._navigateToRow(focusedRowKey, true).done(function(focusedRowIndex) {\r\n                            if (focusedRowIndex < 0) {\r\n                                focusController._focusRowByIndex()\r\n                            }\r\n                        })\r\n                    } else {\r\n                        if (operationTypes.paging && !isVirtualScrolling) {\r\n                            if (isAutoNavigate) {\r\n                                var rowIndexByKey = this.getRowIndexByKey(focusedRowKey);\r\n                                var isValidRowIndexByKey = rowIndexByKey >= 0;\r\n                                var focusedRowIndex = this.option(\"focusedRowIndex\");\r\n                                var needFocusRowByIndex = focusedRowIndex >= 0 && (focusedRowIndex === rowIndexByKey || !isValidRowIndexByKey);\r\n                                if (needFocusRowByIndex) {\r\n                                    focusController._focusRowByIndex()\r\n                                }\r\n                            } else {\r\n                                if (this.getRowIndexByKey(focusedRowKey) < 0) {\r\n                                    this.option(\"focusedRowIndex\", -1)\r\n                                }\r\n                            }\r\n                        } else {\r\n                            if (operationTypes.fullReload) {\r\n                                focusController._focusRowByKeyOrIndex()\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                getPageIndexByKey: function(key) {\r\n                    var that = this;\r\n                    var d = new _deferred.Deferred;\r\n                    that.getGlobalRowIndexByKey(key).done(function(globalIndex) {\r\n                        d.resolve(globalIndex >= 0 ? Math.floor(globalIndex / that.pageSize()) : -1)\r\n                    }).fail(d.reject);\r\n                    return d.promise()\r\n                },\r\n                getGlobalRowIndexByKey: function(key) {\r\n                    if (this._dataSource.group()) {\r\n                        return this._calculateGlobalRowIndexByGroupedData(key)\r\n                    }\r\n                    return this._calculateGlobalRowIndexByFlatData(key)\r\n                },\r\n                _calculateGlobalRowIndexByFlatData: function(key, groupFilter, useGroup) {\r\n                    var that = this;\r\n                    var deferred = new _deferred.Deferred;\r\n                    var dataSource = that._dataSource;\r\n                    var filter = that._generateFilterByKey(key);\r\n                    dataSource.load({\r\n                        filter: that._concatWithCombinedFilter(filter),\r\n                        skip: 0,\r\n                        take: 1\r\n                    }).done(function(data) {\r\n                        if (data.length > 0) {\r\n                            filter = that._generateOperationFilterByKey(key, data[0], useGroup);\r\n                            dataSource.load({\r\n                                filter: that._concatWithCombinedFilter(filter, groupFilter),\r\n                                skip: 0,\r\n                                take: 1,\r\n                                requireTotalCount: true\r\n                            }).done(function(_, extra) {\r\n                                deferred.resolve(extra.totalCount)\r\n                            })\r\n                        } else {\r\n                            deferred.resolve(-1)\r\n                        }\r\n                    });\r\n                    return deferred.promise()\r\n                },\r\n                _concatWithCombinedFilter: function(filter, groupFilter) {\r\n                    var combinedFilter = this.getCombinedFilter();\r\n                    return _uiGrid_core2.default.combineFilters([filter, combinedFilter, groupFilter])\r\n                },\r\n                _generateBooleanFilter: function(selector, value, sortInfo) {\r\n                    var result;\r\n                    if (false === value) {\r\n                        result = [selector, \"=\", sortInfo.desc ? true : null]\r\n                    } else {\r\n                        if (true === value ? !sortInfo.desc : sortInfo.desc) {\r\n                            result = [selector, \"<>\", value]\r\n                        }\r\n                    }\r\n                    return result\r\n                },\r\n                _generateOperationFilterByKey: function(key, rowData, useGroup) {\r\n                    var that = this;\r\n                    var dataSource = that._dataSource;\r\n                    var filter = that._generateFilterByKey(key, \"<\");\r\n                    var sort = that._columnsController.getSortDataSourceParameters(!dataSource.remoteOperations().filtering, true);\r\n                    if (useGroup) {\r\n                        var group = that._columnsController.getGroupDataSourceParameters(!dataSource.remoteOperations().filtering);\r\n                        if (group) {\r\n                            sort = sort ? group.concat(sort) : group\r\n                        }\r\n                    }\r\n                    if (sort) {\r\n                        sort.slice().reverse().forEach(function(sortInfo) {\r\n                            var selector = sortInfo.selector;\r\n                            var getter;\r\n                            if (\"function\" === typeof selector) {\r\n                                getter = selector\r\n                            } else {\r\n                                getter = that._columnsController.columnOption(selector, \"selector\")\r\n                            }\r\n                            var value = getter ? getter(rowData) : rowData[selector];\r\n                            filter = [\r\n                                [selector, \"=\", value], \"and\", filter\r\n                            ];\r\n                            if (null === value || (0, _type.isBoolean)(value)) {\r\n                                var booleanFilter = that._generateBooleanFilter(selector, value, sortInfo);\r\n                                if (booleanFilter) {\r\n                                    filter = [booleanFilter, \"or\", filter]\r\n                                }\r\n                            } else {\r\n                                var filterOperation = sortInfo.desc ? \">\" : \"<\";\r\n                                var sortFilter = [selector, filterOperation, value];\r\n                                if (!sortInfo.desc) {\r\n                                    sortFilter = [sortFilter, \"or\", [selector, \"=\", null]]\r\n                                }\r\n                                filter = [sortFilter, \"or\", filter]\r\n                            }\r\n                        })\r\n                    }\r\n                    return filter\r\n                },\r\n                _generateFilterByKey: function(key, operation) {\r\n                    var dataSourceKey = this._dataSource.key();\r\n                    var filter = [];\r\n                    if (!operation) {\r\n                        operation = \"=\"\r\n                    }\r\n                    if (Array.isArray(dataSourceKey)) {\r\n                        for (var i = 0; i < dataSourceKey.length; ++i) {\r\n                            var keyPart = key[dataSourceKey[i]];\r\n                            if (keyPart) {\r\n                                if (filter.length > 0) {\r\n                                    filter.push(\"and\")\r\n                                }\r\n                                filter.push([dataSourceKey[i], operation, keyPart])\r\n                            }\r\n                        }\r\n                    } else {\r\n                        filter = [dataSourceKey, operation, key]\r\n                    }\r\n                    return filter\r\n                },\r\n                _getLastItemIndex: function() {\r\n                    return this.items(true).length - 1\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase(row);\r\n                    if (this.option(\"focusedRowEnabled\") && row) {\r\n                        if (this.getController(\"focus\").isRowFocused(row.key)) {\r\n                            $row.addClass(ROW_FOCUSED_CLASS)\r\n                        }\r\n                    }\r\n                    return $row\r\n                },\r\n                _checkRowKeys: function(options) {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (this.option(\"focusedRowEnabled\") && this.option(\"dataSource\")) {\r\n                        var store = this._dataController.store();\r\n                        if (store && !store.key()) {\r\n                            this._dataController.fireError(\"E1042\", \"Row focusing\")\r\n                        }\r\n                    }\r\n                },\r\n                _update: function(change) {\r\n                    if (\"updateFocusedRow\" === change.changeType) {\r\n                        if (this.option(\"focusedRowEnabled\")) {\r\n                            this.getController(\"focus\").updateFocusedRow(change)\r\n                        }\r\n                    } else {\r\n                        this.callBase(change)\r\n                    }\r\n                },\r\n                updateFocusElementTabIndex: function($cellElements, preventScroll) {\r\n                    if (this.option(\"focusedRowEnabled\")) {\r\n                        this._setFocusedRowElementTabIndex(preventScroll)\r\n                    } else {\r\n                        this.callBase($cellElements)\r\n                    }\r\n                },\r\n                _setFocusedRowElementTabIndex: function(preventScroll) {\r\n                    var _this5 = this;\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var tabIndex = this.option(\"tabIndex\") || 0;\r\n                    var dataController = this._dataController;\r\n                    var columnsController = this._columnsController;\r\n                    var rowIndex = dataController.getRowIndexByKey(focusedRowKey);\r\n                    var columnIndex = this.option(\"focusedColumnIndex\");\r\n                    var $row = this._findRowElementForTabIndex();\r\n                    if (!(0, _type.isDefined)(this._scrollToFocusOnResize)) {\r\n                        this._scrollToFocusOnResize = function() {\r\n                            _this5.scrollToElementVertically(_this5._findRowElementForTabIndex());\r\n                            _this5.resizeCompleted.remove(_this5._scrollToFocusOnResize)\r\n                        }\r\n                    }\r\n                    $row.attr(\"tabIndex\", tabIndex);\r\n                    if (rowIndex >= 0 && !preventScroll) {\r\n                        if (columnIndex < 0) {\r\n                            columnIndex = 0\r\n                        }\r\n                        rowIndex += dataController.getRowIndexOffset();\r\n                        columnIndex += columnsController.getColumnIndexOffset();\r\n                        this.getController(\"keyboardNavigation\").setFocusedCellPosition(rowIndex, columnIndex);\r\n                        if (this.getController(\"focus\").isAutoNavigateToFocusedRow()) {\r\n                            var dataSource = dataController.dataSource();\r\n                            var operationTypes = dataSource && dataSource.operationTypes();\r\n                            if (operationTypes && !operationTypes.paging && !dataController.isPagingByRendering()) {\r\n                                this.resizeCompleted.remove(this._scrollToFocusOnResize);\r\n                                this.resizeCompleted.add(this._scrollToFocusOnResize)\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                _findRowElementForTabIndex: function() {\r\n                    var focusedRowKey = this.option(\"focusedRowKey\");\r\n                    var rowIndex = this._dataController.getRowIndexByKey(focusedRowKey);\r\n                    return (0, _renderer.default)(this.getRowElement(rowIndex >= 0 ? rowIndex : 0))\r\n                },\r\n                scrollToRowElement: function(key) {\r\n                    var rowIndex = this.getController(\"data\").getRowIndexByKey(key);\r\n                    var $row = (0, _renderer.default)(this.getRow(rowIndex));\r\n                    this.scrollToElementVertically($row)\r\n                },\r\n                scrollToElementVertically: function($row) {\r\n                    var scrollable = this.getScrollable();\r\n                    if (scrollable) {\r\n                        var position = scrollable.getScrollElementPosition($row, \"vertical\");\r\n                        scrollable.scrollTo({\r\n                            top: position\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}