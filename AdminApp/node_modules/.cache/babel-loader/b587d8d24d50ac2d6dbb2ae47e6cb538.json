{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.virtual_scrolling.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.virtual_scrolling_core\");\n\nvar _uiGrid_core2 = _interopRequireDefault(require(\"./ui.grid_core.utils\"));\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _translator = require(\"../../animation/translator\");\n\nvar _load_indicator = _interopRequireDefault(require(\"../load_indicator\"));\n\nvar _browser = _interopRequireDefault(require(\"../../core/utils/browser\"));\n\nvar _position = require(\"../../core/utils/position\");\n\nvar _type = require(\"../../core/utils/type\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar TABLE_CLASS = \"table\";\nvar BOTTOM_LOAD_PANEL_CLASS = \"bottom-load-panel\";\nvar TABLE_CONTENT_CLASS = \"table-content\";\nvar GROUP_SPACE_CLASS = \"group-space\";\nvar CONTENT_CLASS = \"content\";\nvar ROW_CLASS = \"dx-row\";\nvar FREESPACE_CLASS = \"dx-freespace-row\";\nvar COLUMN_LINES_CLASS = \"dx-column-lines\";\nvar VIRTUAL_ROW_CLASS = \"dx-virtual-row\";\nvar SCROLLING_MODE_INFINITE = \"infinite\";\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\nvar SCROLLING_MODE_STANDARD = \"standard\";\nvar PIXELS_LIMIT = 25e4;\nvar LOAD_TIMEOUT = 300;\n\nvar isVirtualMode = function (that) {\n  return that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL;\n};\n\nvar isAppendMode = function (that) {\n  return that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE;\n};\n\nvar isVirtualRowRendering = function (that) {\n  var rowRenderingMode = that.option(\"scrolling.rowRenderingMode\");\n\n  if (rowRenderingMode === SCROLLING_MODE_VIRTUAL) {\n    return true;\n  } else {\n    if (rowRenderingMode === SCROLLING_MODE_STANDARD) {\n      return false;\n    }\n  }\n};\n\nvar _correctCount = function (items, count, fromEnd, isItemCountableFunc) {\n  for (var i = 0; i < count + 1; i++) {\n    var item = items[fromEnd ? items.length - 1 - i : i];\n\n    if (item && !isItemCountableFunc(item, i === count, fromEnd)) {\n      count++;\n    }\n  }\n\n  return count;\n};\n\nvar isItemCountableByDataSource = function (item, dataSource) {\n  return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && dataSource.isGroupItemCountable(item.data);\n};\n\nvar VirtualScrollingDataSourceAdapterExtender = function () {\n  var _updateLoading = function (that) {\n    var beginPageIndex = that._virtualScrollController.beginPageIndex(-1);\n\n    if (isVirtualMode(that)) {\n      if (beginPageIndex < 0 || that.viewportSize() >= 0 && that.getViewportItemIndex() >= 0 && (beginPageIndex * that.pageSize() > that.getViewportItemIndex() || beginPageIndex * that.pageSize() + that.itemsCount() < that.getViewportItemIndex() + that.viewportSize()) && that._dataSource.isLoading()) {\n        if (!that._isLoading) {\n          that._isLoading = true;\n          that.loadingChanged.fire(true);\n        }\n      } else {\n        if (that._isLoading) {\n          that._isLoading = false;\n          that.loadingChanged.fire(false);\n        }\n      }\n    }\n  };\n\n  var result = {\n    init: function (dataSource) {\n      var that = this;\n      that.callBase.apply(that, arguments);\n      that._items = [];\n      that._isLoaded = true;\n      that._virtualScrollController = new _uiGrid_core.VirtualScrollController(that.component, {\n        pageSize: function () {\n          return that.pageSize();\n        },\n        totalItemsCount: function () {\n          return that.totalItemsCount();\n        },\n        hasKnownLastPage: function () {\n          return that.hasKnownLastPage();\n        },\n        pageIndex: function (index) {\n          return dataSource.pageIndex(index);\n        },\n        isLoading: function () {\n          return dataSource.isLoading() && !that.isCustomLoading();\n        },\n        pageCount: function () {\n          return that.pageCount();\n        },\n        load: function () {\n          return dataSource.load();\n        },\n        updateLoading: function () {\n          _updateLoading(that);\n        },\n        itemsCount: function () {\n          return that.itemsCount(true);\n        },\n        items: function () {\n          return dataSource.items();\n        },\n        viewportItems: function (items) {\n          if (items) {\n            that._items = items;\n          }\n\n          return that._items;\n        },\n        onChanged: function (e) {\n          that.changed.fire(e);\n        },\n        changingDuration: function (e) {\n          if (that.isLoading()) {\n            return LOAD_TIMEOUT;\n          }\n\n          return that._renderTime || 0;\n        }\n      });\n    },\n    _handleLoadingChanged: function (isLoading) {\n      if (!isVirtualMode(this) || this._isLoadingAll) {\n        this._isLoading = isLoading;\n        this.callBase.apply(this, arguments);\n      }\n\n      if (isLoading) {\n        this._startLoadTime = new Date();\n      } else {\n        this._startLoadTime = void 0;\n      }\n    },\n    _handleLoadError: function () {\n      var that = this;\n      that._isLoading = false;\n      that.loadingChanged.fire(false);\n      that.callBase.apply(that, arguments);\n    },\n    _handleDataChanged: function (e) {\n      var callBase = this.callBase.bind(this);\n\n      this._virtualScrollController.handleDataChanged(callBase, e);\n    },\n    _customizeRemoteOperations: function (options, operationTypes) {\n      var that = this;\n\n      if (!that.option(\"legacyRendering\") && isVirtualMode(that) && !operationTypes.reload && operationTypes.skip && that._renderTime < that.option(\"scrolling.renderingThreshold\")) {\n        options.delay = void 0;\n      }\n\n      that.callBase.apply(that, arguments);\n    },\n    items: function () {\n      return this._items;\n    },\n    itemsCount: function (isBase) {\n      if (isBase) {\n        return this.callBase();\n      }\n\n      return this._virtualScrollController.itemsCount();\n    },\n    load: function (loadOptions) {\n      if (loadOptions) {\n        return this.callBase(loadOptions);\n      }\n\n      return this._virtualScrollController.load();\n    },\n    isLoading: function () {\n      return this._isLoading;\n    },\n    isLoaded: function () {\n      return this._dataSource.isLoaded() && this._isLoaded;\n    },\n    resetPagesCache: function (isLiveUpdate) {\n      if (!isLiveUpdate) {\n        this._virtualScrollController.reset(true);\n      }\n\n      this.callBase.apply(this, arguments);\n    },\n    _changeRowExpandCore: function () {\n      var result = this.callBase.apply(this, arguments);\n      this.resetPagesCache();\n\n      _updateLoading(this);\n\n      return result;\n    },\n    reload: function () {\n      this._dataSource.pageIndex(this.pageIndex());\n\n      var virtualScrollController = this._virtualScrollController;\n\n      if (virtualScrollController) {\n        var d = new _deferred.Deferred();\n        this.callBase.apply(this, arguments).done(function (r) {\n          var delayDeferred = virtualScrollController._delayDeferred;\n\n          if (delayDeferred) {\n            delayDeferred.done(d.resolve).fail(d.reject);\n          } else {\n            d.resolve(r);\n          }\n        }).fail(d.reject);\n        return d;\n      } else {\n        return this.callBase.apply(this, arguments);\n      }\n    },\n    refresh: function (options, operationTypes) {\n      var that = this;\n      var storeLoadOptions = options.storeLoadOptions;\n      var dataSource = that._dataSource;\n\n      if (operationTypes.reload) {\n        that._virtualScrollController.reset();\n\n        dataSource.items().length = 0;\n        that._isLoaded = false;\n\n        _updateLoading(that);\n\n        that._isLoaded = true;\n\n        if (isAppendMode(that)) {\n          that.pageIndex(0);\n          dataSource.pageIndex(0);\n          storeLoadOptions.pageIndex = 0;\n          options.pageIndex = 0;\n          storeLoadOptions.skip = 0;\n        } else {\n          dataSource.pageIndex(that.pageIndex());\n\n          if (dataSource.paginate()) {\n            options.pageIndex = that.pageIndex();\n            storeLoadOptions.skip = that.pageIndex() * that.pageSize();\n          }\n        }\n      } else {\n        if (isAppendMode(that) && storeLoadOptions.skip && that._skipCorrection < 0) {\n          storeLoadOptions.skip += that._skipCorrection;\n        }\n      }\n\n      return that.callBase.apply(that, arguments);\n    },\n    dispose: function () {\n      this._virtualScrollController.dispose();\n\n      this.callBase.apply(this, arguments);\n    }\n  };\n  [\"virtualItemsCount\", \"getContentOffset\", \"getVirtualContentSize\", \"setContentSize\", \"setViewportPosition\", \"getViewportItemIndex\", \"setViewportItemIndex\", \"getItemIndexByPosition\", \"viewportSize\", \"viewportItemSize\", \"getItemSize\", \"getItemSizes\", \"pageIndex\", \"beginPageIndex\", \"endPageIndex\", \"loadIfNeed\"].forEach(function (name) {\n    result[name] = function () {\n      var virtualScrollController = this._virtualScrollController;\n      return virtualScrollController[name].apply(virtualScrollController, arguments);\n    };\n  });\n  return result;\n}();\n\nvar VirtualScrollingRowsViewExtender = function () {\n  var removeEmptyRows = function ($emptyRows, className) {\n    var getRowParent = function (row) {\n      return (0, _renderer.default)(row).parent(\".\" + className).get(0);\n    };\n\n    var tBodies = $emptyRows.toArray().map(getRowParent).filter(function (row) {\n      return row;\n    });\n\n    if (tBodies.length) {\n      $emptyRows = (0, _renderer.default)(tBodies);\n    }\n\n    var rowCount = className === FREESPACE_CLASS ? $emptyRows.length - 1 : $emptyRows.length;\n\n    for (var i = 0; i < rowCount; i++) {\n      $emptyRows.eq(i).remove();\n    }\n  };\n\n  return {\n    init: function () {\n      var _dataController$state,\n          _this = this;\n\n      var dataController = this.getController(\"data\");\n      this.callBase();\n      dataController.pageChanged.add(function () {\n        _this.scrollToPage(dataController.pageIndex());\n      });\n      dataController.dataSourceChanged.add(function () {\n        !_this._scrollTop && _this._scrollToCurrentPageOnResize();\n      });\n      null === (_dataController$state = dataController.stateLoaded) || void 0 === _dataController$state ? void 0 : _dataController$state.add(function () {\n        _this._scrollToCurrentPageOnResize();\n      });\n\n      this._scrollToCurrentPageOnResize();\n    },\n    _scrollToCurrentPageOnResize: function () {\n      var _this2 = this;\n\n      var dataController = this.getController(\"data\");\n\n      if (!this.option(\"legacyRendering\") && dataController.pageIndex() > 0) {\n        var resizeHandler = function resizeHandler() {\n          _this2.resizeCompleted.remove(resizeHandler);\n\n          _this2.scrollToPage(dataController.pageIndex());\n        };\n\n        this.resizeCompleted.add(resizeHandler);\n      }\n    },\n    scrollToPage: function (pageIndex) {\n      var that = this;\n      var dataController = that._dataController;\n      var pageSize = dataController ? dataController.pageSize() : 0;\n      var scrollPosition;\n\n      if (isVirtualMode(that) || isAppendMode(that)) {\n        var itemSize = dataController.getItemSize();\n        var itemSizes = dataController.getItemSizes();\n        var itemIndex = pageIndex * pageSize;\n        scrollPosition = itemIndex * itemSize;\n\n        for (var index in itemSizes) {\n          if (index < itemIndex) {\n            scrollPosition += itemSizes[index] - itemSize;\n          }\n        }\n      } else {\n        scrollPosition = 0;\n      }\n\n      that.scrollTo({\n        y: scrollPosition,\n        x: that._scrollLeft\n      });\n    },\n    renderDelayedTemplates: function (e) {\n      this._updateContentPosition(true);\n\n      this.callBase.apply(this, arguments);\n    },\n    _renderCore: function (e) {\n      var that = this;\n      var startRenderTime = new Date();\n      that.callBase.apply(that, arguments);\n      var dataSource = that._dataController._dataSource;\n\n      if (dataSource && e) {\n        var itemCount = e.items ? e.items.length : 20;\n        var viewportSize = that._dataController.viewportSize() || 20;\n\n        if (isVirtualRowRendering(that)) {\n          dataSource._renderTime = (new Date() - startRenderTime) * viewportSize / itemCount;\n        } else {\n          dataSource._renderTime = new Date() - startRenderTime;\n        }\n      }\n    },\n    _getRowElements: function (tableElement) {\n      var $rows = this.callBase(tableElement);\n      return $rows && $rows.not(\".\" + VIRTUAL_ROW_CLASS);\n    },\n    _renderContent: function (contentElement, tableElement) {\n      var that = this;\n\n      var virtualItemsCount = that._dataController.virtualItemsCount();\n\n      if (virtualItemsCount && that.option(\"legacyRendering\")) {\n        if ((0, _window.hasWindow)()) {\n          tableElement.addClass(that.addWidgetPrefix(TABLE_CONTENT_CLASS));\n        }\n\n        if (!contentElement.children().length) {\n          contentElement.append(tableElement);\n        } else {\n          contentElement.children().first().replaceWith(tableElement);\n        }\n\n        if (1 === contentElement.children(\"table\").length) {\n          contentElement.append(that._createTable());\n          that._contentHeight = 0;\n        }\n\n        return contentElement;\n      }\n\n      return that.callBase.apply(that, arguments);\n    },\n    _removeRowsElements: function (contentTable, removeCount, changeType) {\n      var rowElements = this._getRowElements(contentTable).toArray();\n\n      if (\"append\" === changeType) {\n        rowElements = rowElements.slice(0, removeCount);\n      } else {\n        rowElements = rowElements.slice(-removeCount);\n      }\n\n      var errorHandlingController = this.getController(\"errorHandling\");\n      rowElements.map(function (rowElement) {\n        var $rowElement = (0, _renderer.default)(rowElement);\n        errorHandlingController && errorHandlingController.removeErrorRow($rowElement.next());\n        $rowElement.remove();\n      });\n    },\n    _restoreErrorRow: function (contentTable) {\n      var editingController = this.getController(\"editing\");\n      editingController && editingController.hasChanges() && this._getRowElements(contentTable).each(function (_, item) {\n        var rowOptions = (0, _renderer.default)(item).data(\"options\");\n\n        if (rowOptions) {\n          var change = editingController.getChangeByKey(rowOptions.key);\n          change && editingController._showErrorRow(change);\n        }\n      });\n    },\n    _updateContent: function (tableElement, change) {\n      var that = this;\n      var $freeSpaceRowElements;\n\n      var contentElement = that._findContentElement();\n\n      var changeType = change && change.changeType;\n\n      if (\"append\" === changeType || \"prepend\" === changeType) {\n        var contentTable = contentElement.children().first();\n\n        var $tBodies = that._getBodies(tableElement);\n\n        if (!that.option(\"legacyRendering\") && 1 === $tBodies.length) {\n          that._getBodies(contentTable)[\"append\" === changeType ? \"append\" : \"prepend\"]($tBodies.children());\n        } else {\n          $tBodies[\"append\" === changeType ? \"appendTo\" : \"prependTo\"](contentTable);\n        }\n\n        tableElement.remove();\n        $freeSpaceRowElements = that._getFreeSpaceRowElements(contentTable);\n        removeEmptyRows($freeSpaceRowElements, FREESPACE_CLASS);\n\n        if (change.removeCount) {\n          that._removeRowsElements(contentTable, change.removeCount, changeType);\n        }\n\n        that._restoreErrorRow(contentTable);\n      } else {\n        that.callBase.apply(that, arguments);\n      }\n\n      that._updateBottomLoading();\n    },\n    _addVirtualRow: function ($table, isFixed, location, position) {\n      if (!position) {\n        return;\n      }\n\n      var $virtualRow = this._createEmptyRow(VIRTUAL_ROW_CLASS, isFixed, position);\n\n      $virtualRow = this._wrapRowIfNeed($table, $virtualRow);\n\n      this._appendEmptyRow($table, $virtualRow, location);\n    },\n    _getRowHeights: function () {\n      var rowHeights = this._getRowElements(this._tableElement).toArray().map(function (row) {\n        return (0, _position.getBoundingRect)(row).height;\n      });\n\n      return rowHeights;\n    },\n    _correctRowHeights: function (rowHeights) {\n      var dataController = this._dataController;\n      var dataSource = dataController._dataSource;\n      var correctedRowHeights = [];\n      var visibleRows = dataController.getVisibleRows();\n      var itemSize = 0;\n      var firstCountableItem = true;\n\n      for (var i = 0; i < rowHeights.length; i++) {\n        var currentItem = visibleRows[i];\n\n        if (!(0, _type.isDefined)(currentItem)) {\n          continue;\n        }\n\n        if (isItemCountableByDataSource(currentItem, dataSource)) {\n          if (firstCountableItem) {\n            firstCountableItem = false;\n          } else {\n            correctedRowHeights.push(itemSize);\n            itemSize = 0;\n          }\n        }\n\n        itemSize += rowHeights[i];\n      }\n\n      itemSize > 0 && correctedRowHeights.push(itemSize);\n      return correctedRowHeights;\n    },\n    _updateContentPosition: function (isRender) {\n      var that = this;\n      var dataController = that._dataController;\n      var rowHeight = that._rowHeight || 20;\n      dataController.viewportItemSize(rowHeight);\n\n      if (!that.option(\"legacyRendering\") && (isVirtualMode(that) || isVirtualRowRendering(that))) {\n        if (!isRender) {\n          var rowHeights = that._getRowHeights();\n\n          var correctedRowHeights = that._correctRowHeights(rowHeights);\n\n          dataController.setContentSize(correctedRowHeights);\n        }\n\n        var top = dataController.getContentOffset(\"begin\");\n        var bottom = dataController.getContentOffset(\"end\");\n        var $tables = that.getTableElements();\n        var $virtualRows = $tables.children(\"tbody\").children(\".\" + VIRTUAL_ROW_CLASS);\n        removeEmptyRows($virtualRows, VIRTUAL_ROW_CLASS);\n        $tables.each(function (index) {\n          var isFixed = index > 0;\n          that._isFixedTableRendering = isFixed;\n\n          that._addVirtualRow((0, _renderer.default)(this), isFixed, \"top\", top);\n\n          that._addVirtualRow((0, _renderer.default)(this), isFixed, \"bottom\", bottom);\n\n          that._isFixedTableRendering = false;\n        });\n      } else {\n        (0, _common.deferUpdate)(function () {\n          that._updateContentPositionCore();\n        });\n      }\n    },\n    _updateContentPositionCore: function () {\n      var that = this;\n      var contentHeight;\n      var $tables;\n      var $contentTable;\n      var rowHeight = that._rowHeight || 20;\n\n      var virtualItemsCount = that._dataController.virtualItemsCount();\n\n      if (virtualItemsCount) {\n        var contentElement = that._findContentElement();\n\n        $tables = contentElement.children();\n        $contentTable = $tables.eq(0);\n        var virtualTable = $tables.eq(1);\n        that._contentTableHeight = $contentTable[0].offsetHeight;\n\n        that._dataController.viewportItemSize(rowHeight);\n\n        that._dataController.setContentSize(that._contentTableHeight);\n\n        contentHeight = that._dataController.getVirtualContentSize();\n\n        var top = that._dataController.getContentOffset();\n\n        (0, _common.deferRender)(function () {\n          (0, _translator.move)($contentTable, {\n            left: 0,\n            top: top\n          });\n          var isRenderVirtualTableContentRequired = that._contentHeight !== contentHeight || 0 === contentHeight || !that._isTableLinesDisplaysCorrect(virtualTable) || !that._isColumnElementsEqual($contentTable.find(\"col\"), virtualTable.find(\"col\"));\n\n          if (isRenderVirtualTableContentRequired) {\n            that._contentHeight = contentHeight;\n\n            that._renderVirtualTableContent(virtualTable, contentHeight);\n          }\n        });\n      }\n    },\n    _isTableLinesDisplaysCorrect: function (table) {\n      var hasColumnLines = table.find(\".\" + COLUMN_LINES_CLASS).length > 0;\n      return hasColumnLines === this.option(\"showColumnLines\");\n    },\n    _isColumnElementsEqual: function ($columns, $virtualColumns) {\n      var result = $columns.length === $virtualColumns.length;\n\n      if (result) {\n        (0, _iterator.each)($columns, function (index, element) {\n          if (element.style.width !== $virtualColumns[index].style.width) {\n            result = false;\n            return result;\n          }\n        });\n      }\n\n      return result;\n    },\n    _renderVirtualTableContent: function (container, height) {\n      var that = this;\n\n      var columns = that._columnsController.getVisibleColumns();\n\n      var html = that._createColGroup(columns).prop(\"outerHTML\");\n\n      var freeSpaceCellsHtml = \"\";\n      var columnLinesClass = that.option(\"showColumnLines\") ? COLUMN_LINES_CLASS : \"\";\n\n      var createFreeSpaceRowHtml = function (height) {\n        return \"<tr style='height:\" + height + \"px;' class='\" + FREESPACE_CLASS + \" \" + ROW_CLASS + \" \" + columnLinesClass + \"' >\" + freeSpaceCellsHtml + \"</tr>\";\n      };\n\n      for (var i = 0; i < columns.length; i++) {\n        var classes = that._getCellClasses(columns[i]);\n\n        var classString = classes.length ? \" class='\" + classes.join(\" \") + \"'\" : \"\";\n        freeSpaceCellsHtml += \"<td\" + classString + \"/>\";\n      }\n\n      while (height > PIXELS_LIMIT) {\n        html += createFreeSpaceRowHtml(PIXELS_LIMIT);\n        height -= PIXELS_LIMIT;\n      }\n\n      html += createFreeSpaceRowHtml(height);\n      container.addClass(that.addWidgetPrefix(TABLE_CLASS));\n      container.html(html);\n    },\n    _getCellClasses: function (column) {\n      var classes = [];\n      var cssClass = column.cssClass;\n      var isExpandColumn = \"expand\" === column.command;\n      cssClass && classes.push(cssClass);\n      isExpandColumn && classes.push(this.addWidgetPrefix(GROUP_SPACE_CLASS));\n      return classes;\n    },\n    _findBottomLoadPanel: function ($contentElement) {\n      var $element = $contentElement || this.element();\n      var $bottomLoadPanel = $element && $element.find(\".\" + this.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS));\n\n      if ($bottomLoadPanel && $bottomLoadPanel.length) {\n        return $bottomLoadPanel;\n      }\n    },\n    _updateBottomLoading: function () {\n      var that = this;\n      var scrollingMode = that.option(\"scrolling.mode\");\n      var virtualMode = scrollingMode === SCROLLING_MODE_VIRTUAL;\n      var appendMode = scrollingMode === SCROLLING_MODE_INFINITE;\n      var showBottomLoading = !that._dataController.hasKnownLastPage() && that._dataController.isLoaded() && (virtualMode || appendMode);\n\n      var $contentElement = that._findContentElement();\n\n      var bottomLoadPanelElement = that._findBottomLoadPanel($contentElement);\n\n      if (showBottomLoading) {\n        if (!bottomLoadPanelElement) {\n          (0, _renderer.default)(\"<div>\").addClass(that.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS)).append(that._createComponent((0, _renderer.default)(\"<div>\"), _load_indicator.default).$element()).appendTo($contentElement);\n        }\n      } else {\n        if (bottomLoadPanelElement) {\n          bottomLoadPanelElement.remove();\n        }\n      }\n    },\n    _handleScroll: function (e) {\n      var that = this;\n\n      if (that._hasHeight && that._rowHeight) {\n        that._dataController.setViewportPosition(e.scrollOffset.top);\n      }\n\n      that.callBase.apply(that, arguments);\n    },\n    _needUpdateRowHeight: function (itemsCount) {\n      var that = this;\n      return that.callBase.apply(that, arguments) || itemsCount > 0 && that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && that.option(\"scrolling.rowRenderingMode\") !== SCROLLING_MODE_VIRTUAL;\n    },\n    _updateRowHeight: function () {\n      var that = this;\n      that.callBase.apply(that, arguments);\n\n      if (that._rowHeight) {\n        that._updateContentPosition();\n\n        var viewportHeight = that._hasHeight ? that.element().outerHeight() : (0, _renderer.default)((0, _window.getWindow)()).outerHeight();\n\n        that._dataController.viewportSize(Math.ceil(viewportHeight / that._rowHeight));\n      }\n    },\n    updateFreeSpaceRowHeight: function () {\n      var result = this.callBase.apply(this, arguments);\n\n      if (result) {\n        this._updateContentPosition();\n      }\n\n      return result;\n    },\n    setLoading: function (isLoading, messageText) {\n      var that = this;\n      var callBase = that.callBase;\n      var dataController = that._dataController;\n      var hasBottomLoadPanel = dataController.pageIndex() > 0 && dataController.isLoaded() && !!that._findBottomLoadPanel();\n\n      if (hasBottomLoadPanel) {\n        isLoading = false;\n      }\n\n      callBase.call(that, isLoading, messageText);\n    },\n    _resizeCore: function () {\n      var that = this;\n      var $element = that.element();\n      that.callBase();\n\n      if (that.component.$element() && !that._windowScroll && $element.closest((0, _window.getWindow)().document).length) {\n        that._windowScroll = (0, _uiGrid_core.subscribeToExternalScrollers)($element, function (scrollPos) {\n          if (!that._hasHeight && that._rowHeight) {\n            that._dataController.setViewportPosition(scrollPos);\n          }\n        }, that.component.$element());\n        that.on(\"disposing\", function () {\n          that._windowScroll.dispose();\n        });\n      }\n\n      that.loadIfNeed();\n    },\n    loadIfNeed: function () {\n      var dataController = this._dataController;\n\n      if (dataController && dataController.loadIfNeed) {\n        dataController.loadIfNeed();\n      }\n    },\n    setColumnWidths: function (widths) {\n      var scrollable = this.getScrollable();\n      var $content;\n      this.callBase.apply(this, arguments);\n\n      if (\"virtual\" === this.option(\"scrolling.mode\")) {\n        $content = scrollable ? scrollable.$content() : this.element();\n        this.callBase(widths, $content.children(\".\" + this.addWidgetPrefix(CONTENT_CLASS)).children(\":not(.\" + this.addWidgetPrefix(TABLE_CONTENT_CLASS) + \")\"));\n      }\n    },\n    dispose: function () {\n      clearTimeout(this._scrollTimeoutID);\n      this.callBase();\n    }\n  };\n}();\n\nvar _default = {\n  defaultOptions: function () {\n    return {\n      scrolling: {\n        timeout: 300,\n        updateTimeout: 300,\n        minTimeout: 0,\n        renderingThreshold: 100,\n        removeInvisiblePages: true,\n        rowPageSize: 5,\n        mode: \"standard\",\n        preloadEnabled: false,\n        rowRenderingMode: \"standard\",\n        loadTwoPagesOnStart: false\n      }\n    };\n  },\n  extenders: {\n    dataSourceAdapter: VirtualScrollingDataSourceAdapterExtender,\n    controllers: {\n      data: function () {\n        var members = {\n          _refreshDataSource: function () {\n            var baseResult = this.callBase.apply(this, arguments) || new _deferred.Deferred().resolve().promise();\n            baseResult.done(this.initVirtualRows.bind(this));\n            return baseResult;\n          },\n          getRowPageSize: function () {\n            var rowPageSize = this.option(\"scrolling.rowPageSize\");\n            var pageSize = this.pageSize();\n            return pageSize && pageSize < rowPageSize ? pageSize : rowPageSize;\n          },\n          reload: function () {\n            var that = this;\n            var rowsScrollController = that._rowsScrollController || that._dataSource;\n            var itemIndex = rowsScrollController && rowsScrollController.getItemIndexByPosition();\n            var result = this.callBase.apply(this, arguments);\n            return result && result.done(function () {\n              if (isVirtualMode(that) || isVirtualRowRendering(that)) {\n                var rowIndexOffset = that.getRowIndexOffset();\n                var rowIndex = Math.floor(itemIndex) - rowIndexOffset;\n                var component = that.component;\n                var scrollable = component.getScrollable && component.getScrollable();\n                var isSortingOperation = that.dataSource().operationTypes().sorting;\n\n                if (scrollable && !that.option(\"legacyRendering\") && !isSortingOperation) {\n                  var rowElement = component.getRowElement(rowIndex);\n                  var $rowElement = rowElement && rowElement[0] && (0, _renderer.default)(rowElement[0]);\n                  var top = $rowElement && $rowElement.position().top;\n                  var allowedTopOffset = _browser.default.mozilla || _browser.default.msie ? 1 : 0;\n\n                  if (top > allowedTopOffset) {\n                    top = Math.round(top + $rowElement.outerHeight() * (itemIndex % 1));\n                    scrollable.scrollTo({\n                      y: top\n                    });\n                  }\n                }\n              }\n            });\n          },\n          initVirtualRows: function () {\n            var that = this;\n            var virtualRowsRendering = isVirtualRowRendering(that);\n\n            if (\"virtual\" !== that.option(\"scrolling.mode\") && true !== virtualRowsRendering || false === virtualRowsRendering || that.option(\"legacyRendering\") || !that.option(\"scrolling.rowPageSize\")) {\n              that._visibleItems = null;\n              that._rowsScrollController = null;\n              return;\n            }\n\n            var pageIndex = !isVirtualMode(this) && that.pageIndex() >= that.pageCount() ? that.pageCount() - 1 : that.pageIndex();\n            that._rowPageIndex = Math.ceil(pageIndex * that.pageSize() / that.getRowPageSize());\n            that._visibleItems = [];\n\n            var isItemCountable = function (item) {\n              return isItemCountableByDataSource(item, that._dataSource);\n            };\n\n            that._rowsScrollController = new _uiGrid_core.VirtualScrollController(that.component, {\n              pageSize: function () {\n                return that.getRowPageSize();\n              },\n              totalItemsCount: function () {\n                return isVirtualMode(that) ? that.totalItemsCount() : that._items.filter(isItemCountable).length;\n              },\n              hasKnownLastPage: function () {\n                return true;\n              },\n              pageIndex: function (index) {\n                if (void 0 !== index) {\n                  that._rowPageIndex = index;\n                }\n\n                return that._rowPageIndex;\n              },\n              isLoading: function () {\n                return that.isLoading();\n              },\n              pageCount: function pageCount() {\n                var pageCount = Math.ceil(this.totalItemsCount() / this.pageSize());\n                return pageCount ? pageCount : 1;\n              },\n              load: function () {\n                if (that._rowsScrollController.pageIndex() >= this.pageCount()) {\n                  that._rowPageIndex = this.pageCount() - 1;\n\n                  that._rowsScrollController.pageIndex(that._rowPageIndex);\n                }\n\n                if (!that._rowsScrollController._dataSource.items().length && this.totalItemsCount()) {\n                  return;\n                }\n\n                that._rowsScrollController.handleDataChanged(function (change) {\n                  change = change || {};\n                  change.changeType = change.changeType || \"refresh\";\n                  change.items = change.items || that._visibleItems;\n\n                  that._visibleItems.forEach(function (item, index) {\n                    item.rowIndex = index;\n                  });\n\n                  that._fireChanged(change);\n                });\n              },\n              updateLoading: function () {},\n              itemsCount: function () {\n                return that._rowsScrollController._dataSource.items().filter(isItemCountable).length;\n              },\n              correctCount: function (items, count, fromEnd) {\n                return _correctCount(items, count, fromEnd, function (item, isNextAfterLast, fromEnd) {\n                  if (item.isNewRow) {\n                    return isNextAfterLast && !fromEnd;\n                  }\n\n                  if (isNextAfterLast && fromEnd) {\n                    return !item.isNewRow;\n                  }\n\n                  return isItemCountable(item);\n                });\n              },\n              items: function (countableOnly) {\n                var dataSource = that.dataSource();\n                var virtualItemsCount = dataSource && dataSource.virtualItemsCount();\n                var begin = virtualItemsCount ? virtualItemsCount.begin : 0;\n                var rowPageSize = that.getRowPageSize();\n                var skip = that._rowPageIndex * rowPageSize - begin;\n                var take = rowPageSize;\n                var result = that._items;\n\n                if (skip < 0) {\n                  return [];\n                }\n\n                if (skip) {\n                  skip = this.correctCount(result, skip);\n                  result = result.slice(skip);\n                }\n\n                if (take) {\n                  take = this.correctCount(result, take);\n                  result = result.slice(0, take);\n                }\n\n                return countableOnly ? result.filter(isItemCountable) : result;\n              },\n              viewportItems: function (items) {\n                if (items) {\n                  that._visibleItems = items;\n                }\n\n                return that._visibleItems;\n              },\n              onChanged: function () {},\n              changingDuration: function (e) {\n                var dataSource = that.dataSource();\n\n                if (dataSource.isLoading()) {\n                  return LOAD_TIMEOUT;\n                }\n\n                return (null === dataSource || void 0 === dataSource ? void 0 : dataSource._renderTime) || 0;\n              }\n            }, true);\n\n            that._rowsScrollController.positionChanged.add(function () {\n              var _that$_dataSource;\n\n              null === (_that$_dataSource = that._dataSource) || void 0 === _that$_dataSource ? void 0 : _that$_dataSource.setViewportItemIndex(that._rowsScrollController.getViewportItemIndex());\n            });\n\n            if (that.isLoaded()) {\n              that._rowsScrollController.load();\n            }\n          },\n          _updateItemsCore: function (change) {\n            var _this3 = this;\n\n            var delta = this.getRowIndexDelta();\n            this.callBase.apply(this, arguments);\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              var visibleItems = this._visibleItems;\n              var isRefresh = \"refresh\" === change.changeType || change.isLiveUpdate;\n\n              if (\"append\" === change.changeType && change.items && !change.items.length) {\n                return;\n              }\n\n              if (isRefresh || \"append\" === change.changeType || \"prepend\" === change.changeType) {\n                change.cancel = true;\n                isRefresh && rowsScrollController.reset(true);\n                rowsScrollController.load();\n              } else {\n                if (\"update\" === change.changeType) {\n                  change.rowIndices.forEach(function (rowIndex, index) {\n                    var changeType = change.changeTypes[index];\n                    var newItem = change.items[index];\n\n                    if (\"update\" === changeType) {\n                      visibleItems[rowIndex] = newItem;\n                    } else {\n                      if (\"insert\" === changeType) {\n                        visibleItems.splice(rowIndex, 0, newItem);\n                      } else {\n                        if (\"remove\" === changeType) {\n                          visibleItems.splice(rowIndex, 1);\n                        }\n                      }\n                    }\n                  });\n                } else {\n                  visibleItems.forEach(function (item, index) {\n                    visibleItems[index] = _this3._items[index + delta] || visibleItems[index];\n                  });\n                  change.items = visibleItems;\n                }\n\n                visibleItems.forEach(function (item, index) {\n                  item.rowIndex = index;\n                });\n              }\n            }\n          },\n          _applyChange: function (change) {\n            var that = this;\n            var items = change.items;\n            var changeType = change.changeType;\n            var removeCount = change.removeCount;\n\n            if (removeCount) {\n              var fromEnd = \"prepend\" === changeType;\n              removeCount = _correctCount(that._items, removeCount, fromEnd, function (item, isNextAfterLast) {\n                return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && (that._dataSource.isGroupItemCountable(item.data) || isNextAfterLast);\n              });\n              change.removeCount = removeCount;\n            }\n\n            switch (changeType) {\n              case \"prepend\":\n                that._items.unshift.apply(that._items, items);\n\n                if (removeCount) {\n                  that._items.splice(-removeCount);\n                }\n\n                break;\n\n              case \"append\":\n                that._items.push.apply(that._items, items);\n\n                if (removeCount) {\n                  that._items.splice(0, removeCount);\n                }\n\n                break;\n\n              default:\n                that.callBase(change);\n            }\n          },\n          items: function (allItems) {\n            return allItems ? this._items : this._visibleItems || this._items;\n          },\n          getRowIndexDelta: function () {\n            var visibleItems = this._visibleItems;\n            var delta = 0;\n\n            if (visibleItems && visibleItems[0]) {\n              delta = this._items.indexOf(visibleItems[0]);\n            }\n\n            return delta < 0 ? 0 : delta;\n          },\n          getRowIndexOffset: function (byLoadedRows) {\n            var offset = 0;\n            var dataSource = this.dataSource();\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController && !byLoadedRows) {\n              offset = rowsScrollController.beginPageIndex() * rowsScrollController._dataSource.pageSize();\n            } else {\n              if (\"virtual\" === this.option(\"scrolling.mode\") && dataSource) {\n                offset = dataSource.beginPageIndex() * dataSource.pageSize();\n              }\n            }\n\n            return offset;\n          },\n          viewportSize: function () {\n            var rowsScrollController = this._rowsScrollController;\n            rowsScrollController && rowsScrollController.viewportSize.apply(rowsScrollController, arguments);\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.viewportSize.apply(dataSource, arguments);\n          },\n          viewportItemSize: function () {\n            var rowsScrollController = this._rowsScrollController;\n            rowsScrollController && rowsScrollController.viewportItemSize.apply(rowsScrollController, arguments);\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.viewportItemSize.apply(dataSource, arguments);\n          },\n          setViewportPosition: function () {\n            var rowsScrollController = this._rowsScrollController;\n            var dataSource = this._dataSource;\n\n            if (rowsScrollController) {\n              rowsScrollController.setViewportPosition.apply(rowsScrollController, arguments);\n            } else {\n              null === dataSource || void 0 === dataSource ? void 0 : dataSource.setViewportPosition.apply(dataSource, arguments);\n            }\n          },\n          setContentSize: function (sizes) {\n            var rowsScrollController = this._rowsScrollController;\n            rowsScrollController && rowsScrollController.setContentSize(sizes);\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.setContentSize(sizes);\n          },\n          loadIfNeed: function () {\n            var rowsScrollController = this._rowsScrollController;\n            rowsScrollController && rowsScrollController.loadIfNeed();\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.loadIfNeed();\n          },\n          getItemSize: function () {\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              return rowsScrollController.getItemSize.apply(rowsScrollController, arguments);\n            }\n\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.getItemSize.apply(dataSource, arguments);\n          },\n          getItemSizes: function () {\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              return rowsScrollController.getItemSizes.apply(rowsScrollController, arguments);\n            }\n\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.getItemSizes.apply(dataSource, arguments);\n          },\n          getContentOffset: function () {\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              return rowsScrollController.getContentOffset.apply(rowsScrollController, arguments);\n            }\n\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.getContentOffset.apply(dataSource, arguments);\n          },\n          refresh: function (options) {\n            var dataSource = this._dataSource;\n\n            if (dataSource && options && options.load && isAppendMode(this)) {\n              dataSource.resetCurrentTotalCount();\n            }\n\n            return this.callBase.apply(this, arguments);\n          },\n          dispose: function () {\n            var rowsScrollController = this._rowsScrollController;\n            rowsScrollController && rowsScrollController.dispose();\n            this.callBase.apply(this, arguments);\n          }\n        };\n\n        _uiGrid_core2.default.proxyMethod(members, \"virtualItemsCount\");\n\n        _uiGrid_core2.default.proxyMethod(members, \"getVirtualContentSize\");\n\n        _uiGrid_core2.default.proxyMethod(members, \"setViewportItemIndex\");\n\n        return members;\n      }(),\n      resizing: {\n        resize: function () {\n          var that = this;\n          var callBase = that.callBase;\n          var result;\n\n          if (!that.option(\"legacyRendering\") && (isVirtualMode(that) || isVirtualRowRendering(that))) {\n            clearTimeout(that._resizeTimeout);\n            var diff = new Date() - that._lastTime;\n            var updateTimeout = that.option(\"scrolling.updateTimeout\");\n\n            if (that._lastTime && diff < updateTimeout) {\n              result = new _deferred.Deferred();\n              that._resizeTimeout = setTimeout(function () {\n                callBase.apply(that).done(result.resolve).fail(result.reject);\n                that._lastTime = new Date();\n              }, updateTimeout);\n              that._lastTime = new Date();\n            } else {\n              result = callBase.apply(that);\n\n              if (that._dataController.isLoaded()) {\n                that._lastTime = new Date();\n              }\n            }\n          } else {\n            result = callBase.apply(that);\n          }\n\n          return result;\n        },\n        dispose: function () {\n          this.callBase.apply(this, arguments);\n          clearTimeout(this._resizeTimeout);\n        }\n      }\n    },\n    views: {\n      rowsView: VirtualScrollingRowsViewExtender\n    }\n  }\n};\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Users/CapiniaC/Desktop/Collection/Work/project/security/node_modules/devextreme/ui/grid_core/ui.grid_core.virtual_scrolling.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_window","_common","_uiGrid_core","_uiGrid_core2","_iterator","_deferred","_translator","_load_indicator","_browser","_position","_type","obj","__esModule","TABLE_CLASS","BOTTOM_LOAD_PANEL_CLASS","TABLE_CONTENT_CLASS","GROUP_SPACE_CLASS","CONTENT_CLASS","ROW_CLASS","FREESPACE_CLASS","COLUMN_LINES_CLASS","VIRTUAL_ROW_CLASS","SCROLLING_MODE_INFINITE","SCROLLING_MODE_VIRTUAL","SCROLLING_MODE_STANDARD","PIXELS_LIMIT","LOAD_TIMEOUT","isVirtualMode","that","option","isAppendMode","isVirtualRowRendering","rowRenderingMode","_correctCount","items","count","fromEnd","isItemCountableFunc","i","item","length","isItemCountableByDataSource","dataSource","rowType","isNewRow","isGroupItemCountable","data","VirtualScrollingDataSourceAdapterExtender","_updateLoading","beginPageIndex","_virtualScrollController","viewportSize","getViewportItemIndex","pageSize","itemsCount","_dataSource","isLoading","_isLoading","loadingChanged","fire","result","init","callBase","apply","arguments","_items","_isLoaded","VirtualScrollController","component","totalItemsCount","hasKnownLastPage","pageIndex","index","isCustomLoading","pageCount","load","updateLoading","viewportItems","onChanged","e","changed","changingDuration","_renderTime","_handleLoadingChanged","_isLoadingAll","_startLoadTime","Date","_handleLoadError","_handleDataChanged","bind","handleDataChanged","_customizeRemoteOperations","options","operationTypes","reload","skip","delay","isBase","loadOptions","isLoaded","resetPagesCache","isLiveUpdate","reset","_changeRowExpandCore","virtualScrollController","d","Deferred","done","r","delayDeferred","_delayDeferred","resolve","fail","reject","refresh","storeLoadOptions","paginate","_skipCorrection","dispose","forEach","name","VirtualScrollingRowsViewExtender","removeEmptyRows","$emptyRows","className","getRowParent","row","parent","get","tBodies","toArray","map","filter","rowCount","eq","remove","_dataController$state","_this","dataController","getController","pageChanged","add","scrollToPage","dataSourceChanged","_scrollTop","_scrollToCurrentPageOnResize","stateLoaded","_this2","resizeHandler","resizeCompleted","_dataController","scrollPosition","itemSize","getItemSize","itemSizes","getItemSizes","itemIndex","scrollTo","y","x","_scrollLeft","renderDelayedTemplates","_updateContentPosition","_renderCore","startRenderTime","itemCount","_getRowElements","tableElement","$rows","not","_renderContent","contentElement","virtualItemsCount","hasWindow","addClass","addWidgetPrefix","children","append","first","replaceWith","_createTable","_contentHeight","_removeRowsElements","contentTable","removeCount","changeType","rowElements","slice","errorHandlingController","rowElement","$rowElement","removeErrorRow","next","_restoreErrorRow","editingController","hasChanges","each","_","rowOptions","change","getChangeByKey","key","_showErrorRow","_updateContent","$freeSpaceRowElements","_findContentElement","$tBodies","_getBodies","_getFreeSpaceRowElements","_updateBottomLoading","_addVirtualRow","$table","isFixed","location","position","$virtualRow","_createEmptyRow","_wrapRowIfNeed","_appendEmptyRow","_getRowHeights","rowHeights","_tableElement","getBoundingRect","height","_correctRowHeights","correctedRowHeights","visibleRows","getVisibleRows","firstCountableItem","currentItem","isDefined","push","isRender","rowHeight","_rowHeight","viewportItemSize","setContentSize","top","getContentOffset","bottom","$tables","getTableElements","$virtualRows","_isFixedTableRendering","deferUpdate","_updateContentPositionCore","contentHeight","$contentTable","virtualTable","_contentTableHeight","offsetHeight","getVirtualContentSize","deferRender","move","left","isRenderVirtualTableContentRequired","_isTableLinesDisplaysCorrect","_isColumnElementsEqual","find","_renderVirtualTableContent","table","hasColumnLines","$columns","$virtualColumns","element","style","width","container","columns","_columnsController","getVisibleColumns","html","_createColGroup","prop","freeSpaceCellsHtml","columnLinesClass","createFreeSpaceRowHtml","classes","_getCellClasses","classString","join","column","cssClass","isExpandColumn","command","_findBottomLoadPanel","$contentElement","$element","$bottomLoadPanel","scrollingMode","virtualMode","appendMode","showBottomLoading","bottomLoadPanelElement","_createComponent","appendTo","_handleScroll","_hasHeight","setViewportPosition","scrollOffset","_needUpdateRowHeight","_updateRowHeight","viewportHeight","outerHeight","getWindow","Math","ceil","updateFreeSpaceRowHeight","setLoading","messageText","hasBottomLoadPanel","call","_resizeCore","_windowScroll","closest","document","subscribeToExternalScrollers","scrollPos","on","loadIfNeed","setColumnWidths","widths","scrollable","getScrollable","$content","clearTimeout","_scrollTimeoutID","_default","defaultOptions","scrolling","timeout","updateTimeout","minTimeout","renderingThreshold","removeInvisiblePages","rowPageSize","mode","preloadEnabled","loadTwoPagesOnStart","extenders","dataSourceAdapter","controllers","members","_refreshDataSource","baseResult","promise","initVirtualRows","getRowPageSize","rowsScrollController","_rowsScrollController","getItemIndexByPosition","rowIndexOffset","getRowIndexOffset","rowIndex","floor","isSortingOperation","sorting","getRowElement","allowedTopOffset","mozilla","msie","round","virtualRowsRendering","_visibleItems","_rowPageIndex","isItemCountable","_fireChanged","correctCount","isNextAfterLast","countableOnly","begin","take","positionChanged","_that$_dataSource","setViewportItemIndex","_updateItemsCore","_this3","delta","getRowIndexDelta","visibleItems","isRefresh","cancel","rowIndices","changeTypes","newItem","splice","_applyChange","unshift","allItems","indexOf","byLoadedRows","offset","sizes","resetCurrentTotalCount","proxyMethod","resizing","resize","_resizeTimeout","diff","_lastTime","setTimeout","views","rowsView","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.virtual_scrolling.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _uiGrid_core = require(\"./ui.grid_core.virtual_scrolling_core\");\r\nvar _uiGrid_core2 = _interopRequireDefault(require(\"./ui.grid_core.utils\"));\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _translator = require(\"../../animation/translator\");\r\nvar _load_indicator = _interopRequireDefault(require(\"../load_indicator\"));\r\nvar _browser = _interopRequireDefault(require(\"../../core/utils/browser\"));\r\nvar _position = require(\"../../core/utils/position\");\r\nvar _type = require(\"../../core/utils/type\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar TABLE_CLASS = \"table\";\r\nvar BOTTOM_LOAD_PANEL_CLASS = \"bottom-load-panel\";\r\nvar TABLE_CONTENT_CLASS = \"table-content\";\r\nvar GROUP_SPACE_CLASS = \"group-space\";\r\nvar CONTENT_CLASS = \"content\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar FREESPACE_CLASS = \"dx-freespace-row\";\r\nvar COLUMN_LINES_CLASS = \"dx-column-lines\";\r\nvar VIRTUAL_ROW_CLASS = \"dx-virtual-row\";\r\nvar SCROLLING_MODE_INFINITE = \"infinite\";\r\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\r\nvar SCROLLING_MODE_STANDARD = \"standard\";\r\nvar PIXELS_LIMIT = 25e4;\r\nvar LOAD_TIMEOUT = 300;\r\nvar isVirtualMode = function(that) {\r\n    return that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL\r\n};\r\nvar isAppendMode = function(that) {\r\n    return that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE\r\n};\r\nvar isVirtualRowRendering = function(that) {\r\n    var rowRenderingMode = that.option(\"scrolling.rowRenderingMode\");\r\n    if (rowRenderingMode === SCROLLING_MODE_VIRTUAL) {\r\n        return true\r\n    } else {\r\n        if (rowRenderingMode === SCROLLING_MODE_STANDARD) {\r\n            return false\r\n        }\r\n    }\r\n};\r\nvar _correctCount = function(items, count, fromEnd, isItemCountableFunc) {\r\n    for (var i = 0; i < count + 1; i++) {\r\n        var item = items[fromEnd ? items.length - 1 - i : i];\r\n        if (item && !isItemCountableFunc(item, i === count, fromEnd)) {\r\n            count++\r\n        }\r\n    }\r\n    return count\r\n};\r\nvar isItemCountableByDataSource = function(item, dataSource) {\r\n    return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && dataSource.isGroupItemCountable(item.data)\r\n};\r\nvar VirtualScrollingDataSourceAdapterExtender = function() {\r\n    var _updateLoading = function(that) {\r\n        var beginPageIndex = that._virtualScrollController.beginPageIndex(-1);\r\n        if (isVirtualMode(that)) {\r\n            if (beginPageIndex < 0 || that.viewportSize() >= 0 && that.getViewportItemIndex() >= 0 && (beginPageIndex * that.pageSize() > that.getViewportItemIndex() || beginPageIndex * that.pageSize() + that.itemsCount() < that.getViewportItemIndex() + that.viewportSize()) && that._dataSource.isLoading()) {\r\n                if (!that._isLoading) {\r\n                    that._isLoading = true;\r\n                    that.loadingChanged.fire(true)\r\n                }\r\n            } else {\r\n                if (that._isLoading) {\r\n                    that._isLoading = false;\r\n                    that.loadingChanged.fire(false)\r\n                }\r\n            }\r\n        }\r\n    };\r\n    var result = {\r\n        init: function(dataSource) {\r\n            var that = this;\r\n            that.callBase.apply(that, arguments);\r\n            that._items = [];\r\n            that._isLoaded = true;\r\n            that._virtualScrollController = new _uiGrid_core.VirtualScrollController(that.component, {\r\n                pageSize: function() {\r\n                    return that.pageSize()\r\n                },\r\n                totalItemsCount: function() {\r\n                    return that.totalItemsCount()\r\n                },\r\n                hasKnownLastPage: function() {\r\n                    return that.hasKnownLastPage()\r\n                },\r\n                pageIndex: function(index) {\r\n                    return dataSource.pageIndex(index)\r\n                },\r\n                isLoading: function() {\r\n                    return dataSource.isLoading() && !that.isCustomLoading()\r\n                },\r\n                pageCount: function() {\r\n                    return that.pageCount()\r\n                },\r\n                load: function() {\r\n                    return dataSource.load()\r\n                },\r\n                updateLoading: function() {\r\n                    _updateLoading(that)\r\n                },\r\n                itemsCount: function() {\r\n                    return that.itemsCount(true)\r\n                },\r\n                items: function() {\r\n                    return dataSource.items()\r\n                },\r\n                viewportItems: function(items) {\r\n                    if (items) {\r\n                        that._items = items\r\n                    }\r\n                    return that._items\r\n                },\r\n                onChanged: function(e) {\r\n                    that.changed.fire(e)\r\n                },\r\n                changingDuration: function(e) {\r\n                    if (that.isLoading()) {\r\n                        return LOAD_TIMEOUT\r\n                    }\r\n                    return that._renderTime || 0\r\n                }\r\n            })\r\n        },\r\n        _handleLoadingChanged: function(isLoading) {\r\n            if (!isVirtualMode(this) || this._isLoadingAll) {\r\n                this._isLoading = isLoading;\r\n                this.callBase.apply(this, arguments)\r\n            }\r\n            if (isLoading) {\r\n                this._startLoadTime = new Date\r\n            } else {\r\n                this._startLoadTime = void 0\r\n            }\r\n        },\r\n        _handleLoadError: function() {\r\n            var that = this;\r\n            that._isLoading = false;\r\n            that.loadingChanged.fire(false);\r\n            that.callBase.apply(that, arguments)\r\n        },\r\n        _handleDataChanged: function(e) {\r\n            var callBase = this.callBase.bind(this);\r\n            this._virtualScrollController.handleDataChanged(callBase, e)\r\n        },\r\n        _customizeRemoteOperations: function(options, operationTypes) {\r\n            var that = this;\r\n            if (!that.option(\"legacyRendering\") && isVirtualMode(that) && !operationTypes.reload && operationTypes.skip && that._renderTime < that.option(\"scrolling.renderingThreshold\")) {\r\n                options.delay = void 0\r\n            }\r\n            that.callBase.apply(that, arguments)\r\n        },\r\n        items: function() {\r\n            return this._items\r\n        },\r\n        itemsCount: function(isBase) {\r\n            if (isBase) {\r\n                return this.callBase()\r\n            }\r\n            return this._virtualScrollController.itemsCount()\r\n        },\r\n        load: function(loadOptions) {\r\n            if (loadOptions) {\r\n                return this.callBase(loadOptions)\r\n            }\r\n            return this._virtualScrollController.load()\r\n        },\r\n        isLoading: function() {\r\n            return this._isLoading\r\n        },\r\n        isLoaded: function() {\r\n            return this._dataSource.isLoaded() && this._isLoaded\r\n        },\r\n        resetPagesCache: function(isLiveUpdate) {\r\n            if (!isLiveUpdate) {\r\n                this._virtualScrollController.reset(true)\r\n            }\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        _changeRowExpandCore: function() {\r\n            var result = this.callBase.apply(this, arguments);\r\n            this.resetPagesCache();\r\n            _updateLoading(this);\r\n            return result\r\n        },\r\n        reload: function() {\r\n            this._dataSource.pageIndex(this.pageIndex());\r\n            var virtualScrollController = this._virtualScrollController;\r\n            if (virtualScrollController) {\r\n                var d = new _deferred.Deferred;\r\n                this.callBase.apply(this, arguments).done(function(r) {\r\n                    var delayDeferred = virtualScrollController._delayDeferred;\r\n                    if (delayDeferred) {\r\n                        delayDeferred.done(d.resolve).fail(d.reject)\r\n                    } else {\r\n                        d.resolve(r)\r\n                    }\r\n                }).fail(d.reject);\r\n                return d\r\n            } else {\r\n                return this.callBase.apply(this, arguments)\r\n            }\r\n        },\r\n        refresh: function(options, operationTypes) {\r\n            var that = this;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var dataSource = that._dataSource;\r\n            if (operationTypes.reload) {\r\n                that._virtualScrollController.reset();\r\n                dataSource.items().length = 0;\r\n                that._isLoaded = false;\r\n                _updateLoading(that);\r\n                that._isLoaded = true;\r\n                if (isAppendMode(that)) {\r\n                    that.pageIndex(0);\r\n                    dataSource.pageIndex(0);\r\n                    storeLoadOptions.pageIndex = 0;\r\n                    options.pageIndex = 0;\r\n                    storeLoadOptions.skip = 0\r\n                } else {\r\n                    dataSource.pageIndex(that.pageIndex());\r\n                    if (dataSource.paginate()) {\r\n                        options.pageIndex = that.pageIndex();\r\n                        storeLoadOptions.skip = that.pageIndex() * that.pageSize()\r\n                    }\r\n                }\r\n            } else {\r\n                if (isAppendMode(that) && storeLoadOptions.skip && that._skipCorrection < 0) {\r\n                    storeLoadOptions.skip += that._skipCorrection\r\n                }\r\n            }\r\n            return that.callBase.apply(that, arguments)\r\n        },\r\n        dispose: function() {\r\n            this._virtualScrollController.dispose();\r\n            this.callBase.apply(this, arguments)\r\n        }\r\n    };\r\n    [\"virtualItemsCount\", \"getContentOffset\", \"getVirtualContentSize\", \"setContentSize\", \"setViewportPosition\", \"getViewportItemIndex\", \"setViewportItemIndex\", \"getItemIndexByPosition\", \"viewportSize\", \"viewportItemSize\", \"getItemSize\", \"getItemSizes\", \"pageIndex\", \"beginPageIndex\", \"endPageIndex\", \"loadIfNeed\"].forEach(function(name) {\r\n        result[name] = function() {\r\n            var virtualScrollController = this._virtualScrollController;\r\n            return virtualScrollController[name].apply(virtualScrollController, arguments)\r\n        }\r\n    });\r\n    return result\r\n}();\r\nvar VirtualScrollingRowsViewExtender = function() {\r\n    var removeEmptyRows = function($emptyRows, className) {\r\n        var getRowParent = function(row) {\r\n            return (0, _renderer.default)(row).parent(\".\" + className).get(0)\r\n        };\r\n        var tBodies = $emptyRows.toArray().map(getRowParent).filter(function(row) {\r\n            return row\r\n        });\r\n        if (tBodies.length) {\r\n            $emptyRows = (0, _renderer.default)(tBodies)\r\n        }\r\n        var rowCount = className === FREESPACE_CLASS ? $emptyRows.length - 1 : $emptyRows.length;\r\n        for (var i = 0; i < rowCount; i++) {\r\n            $emptyRows.eq(i).remove()\r\n        }\r\n    };\r\n    return {\r\n        init: function() {\r\n            var _dataController$state, _this = this;\r\n            var dataController = this.getController(\"data\");\r\n            this.callBase();\r\n            dataController.pageChanged.add(function() {\r\n                _this.scrollToPage(dataController.pageIndex())\r\n            });\r\n            dataController.dataSourceChanged.add(function() {\r\n                !_this._scrollTop && _this._scrollToCurrentPageOnResize()\r\n            });\r\n            null === (_dataController$state = dataController.stateLoaded) || void 0 === _dataController$state ? void 0 : _dataController$state.add(function() {\r\n                _this._scrollToCurrentPageOnResize()\r\n            });\r\n            this._scrollToCurrentPageOnResize()\r\n        },\r\n        _scrollToCurrentPageOnResize: function() {\r\n            var _this2 = this;\r\n            var dataController = this.getController(\"data\");\r\n            if (!this.option(\"legacyRendering\") && dataController.pageIndex() > 0) {\r\n                var resizeHandler = function resizeHandler() {\r\n                    _this2.resizeCompleted.remove(resizeHandler);\r\n                    _this2.scrollToPage(dataController.pageIndex())\r\n                };\r\n                this.resizeCompleted.add(resizeHandler)\r\n            }\r\n        },\r\n        scrollToPage: function(pageIndex) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var pageSize = dataController ? dataController.pageSize() : 0;\r\n            var scrollPosition;\r\n            if (isVirtualMode(that) || isAppendMode(that)) {\r\n                var itemSize = dataController.getItemSize();\r\n                var itemSizes = dataController.getItemSizes();\r\n                var itemIndex = pageIndex * pageSize;\r\n                scrollPosition = itemIndex * itemSize;\r\n                for (var index in itemSizes) {\r\n                    if (index < itemIndex) {\r\n                        scrollPosition += itemSizes[index] - itemSize\r\n                    }\r\n                }\r\n            } else {\r\n                scrollPosition = 0\r\n            }\r\n            that.scrollTo({\r\n                y: scrollPosition,\r\n                x: that._scrollLeft\r\n            })\r\n        },\r\n        renderDelayedTemplates: function(e) {\r\n            this._updateContentPosition(true);\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        _renderCore: function(e) {\r\n            var that = this;\r\n            var startRenderTime = new Date;\r\n            that.callBase.apply(that, arguments);\r\n            var dataSource = that._dataController._dataSource;\r\n            if (dataSource && e) {\r\n                var itemCount = e.items ? e.items.length : 20;\r\n                var viewportSize = that._dataController.viewportSize() || 20;\r\n                if (isVirtualRowRendering(that)) {\r\n                    dataSource._renderTime = (new Date - startRenderTime) * viewportSize / itemCount\r\n                } else {\r\n                    dataSource._renderTime = new Date - startRenderTime\r\n                }\r\n            }\r\n        },\r\n        _getRowElements: function(tableElement) {\r\n            var $rows = this.callBase(tableElement);\r\n            return $rows && $rows.not(\".\" + VIRTUAL_ROW_CLASS)\r\n        },\r\n        _renderContent: function(contentElement, tableElement) {\r\n            var that = this;\r\n            var virtualItemsCount = that._dataController.virtualItemsCount();\r\n            if (virtualItemsCount && that.option(\"legacyRendering\")) {\r\n                if ((0, _window.hasWindow)()) {\r\n                    tableElement.addClass(that.addWidgetPrefix(TABLE_CONTENT_CLASS))\r\n                }\r\n                if (!contentElement.children().length) {\r\n                    contentElement.append(tableElement)\r\n                } else {\r\n                    contentElement.children().first().replaceWith(tableElement)\r\n                }\r\n                if (1 === contentElement.children(\"table\").length) {\r\n                    contentElement.append(that._createTable());\r\n                    that._contentHeight = 0\r\n                }\r\n                return contentElement\r\n            }\r\n            return that.callBase.apply(that, arguments)\r\n        },\r\n        _removeRowsElements: function(contentTable, removeCount, changeType) {\r\n            var rowElements = this._getRowElements(contentTable).toArray();\r\n            if (\"append\" === changeType) {\r\n                rowElements = rowElements.slice(0, removeCount)\r\n            } else {\r\n                rowElements = rowElements.slice(-removeCount)\r\n            }\r\n            var errorHandlingController = this.getController(\"errorHandling\");\r\n            rowElements.map(function(rowElement) {\r\n                var $rowElement = (0, _renderer.default)(rowElement);\r\n                errorHandlingController && errorHandlingController.removeErrorRow($rowElement.next());\r\n                $rowElement.remove()\r\n            })\r\n        },\r\n        _restoreErrorRow: function(contentTable) {\r\n            var editingController = this.getController(\"editing\");\r\n            editingController && editingController.hasChanges() && this._getRowElements(contentTable).each(function(_, item) {\r\n                var rowOptions = (0, _renderer.default)(item).data(\"options\");\r\n                if (rowOptions) {\r\n                    var change = editingController.getChangeByKey(rowOptions.key);\r\n                    change && editingController._showErrorRow(change)\r\n                }\r\n            })\r\n        },\r\n        _updateContent: function(tableElement, change) {\r\n            var that = this;\r\n            var $freeSpaceRowElements;\r\n            var contentElement = that._findContentElement();\r\n            var changeType = change && change.changeType;\r\n            if (\"append\" === changeType || \"prepend\" === changeType) {\r\n                var contentTable = contentElement.children().first();\r\n                var $tBodies = that._getBodies(tableElement);\r\n                if (!that.option(\"legacyRendering\") && 1 === $tBodies.length) {\r\n                    that._getBodies(contentTable)[\"append\" === changeType ? \"append\" : \"prepend\"]($tBodies.children())\r\n                } else {\r\n                    $tBodies[\"append\" === changeType ? \"appendTo\" : \"prependTo\"](contentTable)\r\n                }\r\n                tableElement.remove();\r\n                $freeSpaceRowElements = that._getFreeSpaceRowElements(contentTable);\r\n                removeEmptyRows($freeSpaceRowElements, FREESPACE_CLASS);\r\n                if (change.removeCount) {\r\n                    that._removeRowsElements(contentTable, change.removeCount, changeType)\r\n                }\r\n                that._restoreErrorRow(contentTable)\r\n            } else {\r\n                that.callBase.apply(that, arguments)\r\n            }\r\n            that._updateBottomLoading()\r\n        },\r\n        _addVirtualRow: function($table, isFixed, location, position) {\r\n            if (!position) {\r\n                return\r\n            }\r\n            var $virtualRow = this._createEmptyRow(VIRTUAL_ROW_CLASS, isFixed, position);\r\n            $virtualRow = this._wrapRowIfNeed($table, $virtualRow);\r\n            this._appendEmptyRow($table, $virtualRow, location)\r\n        },\r\n        _getRowHeights: function() {\r\n            var rowHeights = this._getRowElements(this._tableElement).toArray().map(function(row) {\r\n                return (0, _position.getBoundingRect)(row).height\r\n            });\r\n            return rowHeights\r\n        },\r\n        _correctRowHeights: function(rowHeights) {\r\n            var dataController = this._dataController;\r\n            var dataSource = dataController._dataSource;\r\n            var correctedRowHeights = [];\r\n            var visibleRows = dataController.getVisibleRows();\r\n            var itemSize = 0;\r\n            var firstCountableItem = true;\r\n            for (var i = 0; i < rowHeights.length; i++) {\r\n                var currentItem = visibleRows[i];\r\n                if (!(0, _type.isDefined)(currentItem)) {\r\n                    continue\r\n                }\r\n                if (isItemCountableByDataSource(currentItem, dataSource)) {\r\n                    if (firstCountableItem) {\r\n                        firstCountableItem = false\r\n                    } else {\r\n                        correctedRowHeights.push(itemSize);\r\n                        itemSize = 0\r\n                    }\r\n                }\r\n                itemSize += rowHeights[i]\r\n            }\r\n            itemSize > 0 && correctedRowHeights.push(itemSize);\r\n            return correctedRowHeights\r\n        },\r\n        _updateContentPosition: function(isRender) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var rowHeight = that._rowHeight || 20;\r\n            dataController.viewportItemSize(rowHeight);\r\n            if (!that.option(\"legacyRendering\") && (isVirtualMode(that) || isVirtualRowRendering(that))) {\r\n                if (!isRender) {\r\n                    var rowHeights = that._getRowHeights();\r\n                    var correctedRowHeights = that._correctRowHeights(rowHeights);\r\n                    dataController.setContentSize(correctedRowHeights)\r\n                }\r\n                var top = dataController.getContentOffset(\"begin\");\r\n                var bottom = dataController.getContentOffset(\"end\");\r\n                var $tables = that.getTableElements();\r\n                var $virtualRows = $tables.children(\"tbody\").children(\".\" + VIRTUAL_ROW_CLASS);\r\n                removeEmptyRows($virtualRows, VIRTUAL_ROW_CLASS);\r\n                $tables.each(function(index) {\r\n                    var isFixed = index > 0;\r\n                    that._isFixedTableRendering = isFixed;\r\n                    that._addVirtualRow((0, _renderer.default)(this), isFixed, \"top\", top);\r\n                    that._addVirtualRow((0, _renderer.default)(this), isFixed, \"bottom\", bottom);\r\n                    that._isFixedTableRendering = false\r\n                })\r\n            } else {\r\n                (0, _common.deferUpdate)(function() {\r\n                    that._updateContentPositionCore()\r\n                })\r\n            }\r\n        },\r\n        _updateContentPositionCore: function() {\r\n            var that = this;\r\n            var contentHeight;\r\n            var $tables;\r\n            var $contentTable;\r\n            var rowHeight = that._rowHeight || 20;\r\n            var virtualItemsCount = that._dataController.virtualItemsCount();\r\n            if (virtualItemsCount) {\r\n                var contentElement = that._findContentElement();\r\n                $tables = contentElement.children();\r\n                $contentTable = $tables.eq(0);\r\n                var virtualTable = $tables.eq(1);\r\n                that._contentTableHeight = $contentTable[0].offsetHeight;\r\n                that._dataController.viewportItemSize(rowHeight);\r\n                that._dataController.setContentSize(that._contentTableHeight);\r\n                contentHeight = that._dataController.getVirtualContentSize();\r\n                var top = that._dataController.getContentOffset();\r\n                (0, _common.deferRender)(function() {\r\n                    (0, _translator.move)($contentTable, {\r\n                        left: 0,\r\n                        top: top\r\n                    });\r\n                    var isRenderVirtualTableContentRequired = that._contentHeight !== contentHeight || 0 === contentHeight || !that._isTableLinesDisplaysCorrect(virtualTable) || !that._isColumnElementsEqual($contentTable.find(\"col\"), virtualTable.find(\"col\"));\r\n                    if (isRenderVirtualTableContentRequired) {\r\n                        that._contentHeight = contentHeight;\r\n                        that._renderVirtualTableContent(virtualTable, contentHeight)\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        _isTableLinesDisplaysCorrect: function(table) {\r\n            var hasColumnLines = table.find(\".\" + COLUMN_LINES_CLASS).length > 0;\r\n            return hasColumnLines === this.option(\"showColumnLines\")\r\n        },\r\n        _isColumnElementsEqual: function($columns, $virtualColumns) {\r\n            var result = $columns.length === $virtualColumns.length;\r\n            if (result) {\r\n                (0, _iterator.each)($columns, function(index, element) {\r\n                    if (element.style.width !== $virtualColumns[index].style.width) {\r\n                        result = false;\r\n                        return result\r\n                    }\r\n                })\r\n            }\r\n            return result\r\n        },\r\n        _renderVirtualTableContent: function(container, height) {\r\n            var that = this;\r\n            var columns = that._columnsController.getVisibleColumns();\r\n            var html = that._createColGroup(columns).prop(\"outerHTML\");\r\n            var freeSpaceCellsHtml = \"\";\r\n            var columnLinesClass = that.option(\"showColumnLines\") ? COLUMN_LINES_CLASS : \"\";\r\n            var createFreeSpaceRowHtml = function(height) {\r\n                return \"<tr style='height:\" + height + \"px;' class='\" + FREESPACE_CLASS + \" \" + ROW_CLASS + \" \" + columnLinesClass + \"' >\" + freeSpaceCellsHtml + \"</tr>\"\r\n            };\r\n            for (var i = 0; i < columns.length; i++) {\r\n                var classes = that._getCellClasses(columns[i]);\r\n                var classString = classes.length ? \" class='\" + classes.join(\" \") + \"'\" : \"\";\r\n                freeSpaceCellsHtml += \"<td\" + classString + \"/>\"\r\n            }\r\n            while (height > PIXELS_LIMIT) {\r\n                html += createFreeSpaceRowHtml(PIXELS_LIMIT);\r\n                height -= PIXELS_LIMIT\r\n            }\r\n            html += createFreeSpaceRowHtml(height);\r\n            container.addClass(that.addWidgetPrefix(TABLE_CLASS));\r\n            container.html(html)\r\n        },\r\n        _getCellClasses: function(column) {\r\n            var classes = [];\r\n            var cssClass = column.cssClass;\r\n            var isExpandColumn = \"expand\" === column.command;\r\n            cssClass && classes.push(cssClass);\r\n            isExpandColumn && classes.push(this.addWidgetPrefix(GROUP_SPACE_CLASS));\r\n            return classes\r\n        },\r\n        _findBottomLoadPanel: function($contentElement) {\r\n            var $element = $contentElement || this.element();\r\n            var $bottomLoadPanel = $element && $element.find(\".\" + this.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS));\r\n            if ($bottomLoadPanel && $bottomLoadPanel.length) {\r\n                return $bottomLoadPanel\r\n            }\r\n        },\r\n        _updateBottomLoading: function() {\r\n            var that = this;\r\n            var scrollingMode = that.option(\"scrolling.mode\");\r\n            var virtualMode = scrollingMode === SCROLLING_MODE_VIRTUAL;\r\n            var appendMode = scrollingMode === SCROLLING_MODE_INFINITE;\r\n            var showBottomLoading = !that._dataController.hasKnownLastPage() && that._dataController.isLoaded() && (virtualMode || appendMode);\r\n            var $contentElement = that._findContentElement();\r\n            var bottomLoadPanelElement = that._findBottomLoadPanel($contentElement);\r\n            if (showBottomLoading) {\r\n                if (!bottomLoadPanelElement) {\r\n                    (0, _renderer.default)(\"<div>\").addClass(that.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS)).append(that._createComponent((0, _renderer.default)(\"<div>\"), _load_indicator.default).$element()).appendTo($contentElement)\r\n                }\r\n            } else {\r\n                if (bottomLoadPanelElement) {\r\n                    bottomLoadPanelElement.remove()\r\n                }\r\n            }\r\n        },\r\n        _handleScroll: function(e) {\r\n            var that = this;\r\n            if (that._hasHeight && that._rowHeight) {\r\n                that._dataController.setViewportPosition(e.scrollOffset.top)\r\n            }\r\n            that.callBase.apply(that, arguments)\r\n        },\r\n        _needUpdateRowHeight: function(itemsCount) {\r\n            var that = this;\r\n            return that.callBase.apply(that, arguments) || itemsCount > 0 && that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && that.option(\"scrolling.rowRenderingMode\") !== SCROLLING_MODE_VIRTUAL\r\n        },\r\n        _updateRowHeight: function() {\r\n            var that = this;\r\n            that.callBase.apply(that, arguments);\r\n            if (that._rowHeight) {\r\n                that._updateContentPosition();\r\n                var viewportHeight = that._hasHeight ? that.element().outerHeight() : (0, _renderer.default)((0, _window.getWindow)()).outerHeight();\r\n                that._dataController.viewportSize(Math.ceil(viewportHeight / that._rowHeight))\r\n            }\r\n        },\r\n        updateFreeSpaceRowHeight: function() {\r\n            var result = this.callBase.apply(this, arguments);\r\n            if (result) {\r\n                this._updateContentPosition()\r\n            }\r\n            return result\r\n        },\r\n        setLoading: function(isLoading, messageText) {\r\n            var that = this;\r\n            var callBase = that.callBase;\r\n            var dataController = that._dataController;\r\n            var hasBottomLoadPanel = dataController.pageIndex() > 0 && dataController.isLoaded() && !!that._findBottomLoadPanel();\r\n            if (hasBottomLoadPanel) {\r\n                isLoading = false\r\n            }\r\n            callBase.call(that, isLoading, messageText)\r\n        },\r\n        _resizeCore: function() {\r\n            var that = this;\r\n            var $element = that.element();\r\n            that.callBase();\r\n            if (that.component.$element() && !that._windowScroll && $element.closest((0, _window.getWindow)().document).length) {\r\n                that._windowScroll = (0, _uiGrid_core.subscribeToExternalScrollers)($element, function(scrollPos) {\r\n                    if (!that._hasHeight && that._rowHeight) {\r\n                        that._dataController.setViewportPosition(scrollPos)\r\n                    }\r\n                }, that.component.$element());\r\n                that.on(\"disposing\", function() {\r\n                    that._windowScroll.dispose()\r\n                })\r\n            }\r\n            that.loadIfNeed()\r\n        },\r\n        loadIfNeed: function() {\r\n            var dataController = this._dataController;\r\n            if (dataController && dataController.loadIfNeed) {\r\n                dataController.loadIfNeed()\r\n            }\r\n        },\r\n        setColumnWidths: function(widths) {\r\n            var scrollable = this.getScrollable();\r\n            var $content;\r\n            this.callBase.apply(this, arguments);\r\n            if (\"virtual\" === this.option(\"scrolling.mode\")) {\r\n                $content = scrollable ? scrollable.$content() : this.element();\r\n                this.callBase(widths, $content.children(\".\" + this.addWidgetPrefix(CONTENT_CLASS)).children(\":not(.\" + this.addWidgetPrefix(TABLE_CONTENT_CLASS) + \")\"))\r\n            }\r\n        },\r\n        dispose: function() {\r\n            clearTimeout(this._scrollTimeoutID);\r\n            this.callBase()\r\n        }\r\n    }\r\n}();\r\nvar _default = {\r\n    defaultOptions: function() {\r\n        return {\r\n            scrolling: {\r\n                timeout: 300,\r\n                updateTimeout: 300,\r\n                minTimeout: 0,\r\n                renderingThreshold: 100,\r\n                removeInvisiblePages: true,\r\n                rowPageSize: 5,\r\n                mode: \"standard\",\r\n                preloadEnabled: false,\r\n                rowRenderingMode: \"standard\",\r\n                loadTwoPagesOnStart: false\r\n            }\r\n        }\r\n    },\r\n    extenders: {\r\n        dataSourceAdapter: VirtualScrollingDataSourceAdapterExtender,\r\n        controllers: {\r\n            data: function() {\r\n                var members = {\r\n                    _refreshDataSource: function() {\r\n                        var baseResult = this.callBase.apply(this, arguments) || (new _deferred.Deferred).resolve().promise();\r\n                        baseResult.done(this.initVirtualRows.bind(this));\r\n                        return baseResult\r\n                    },\r\n                    getRowPageSize: function() {\r\n                        var rowPageSize = this.option(\"scrolling.rowPageSize\");\r\n                        var pageSize = this.pageSize();\r\n                        return pageSize && pageSize < rowPageSize ? pageSize : rowPageSize\r\n                    },\r\n                    reload: function() {\r\n                        var that = this;\r\n                        var rowsScrollController = that._rowsScrollController || that._dataSource;\r\n                        var itemIndex = rowsScrollController && rowsScrollController.getItemIndexByPosition();\r\n                        var result = this.callBase.apply(this, arguments);\r\n                        return result && result.done(function() {\r\n                            if (isVirtualMode(that) || isVirtualRowRendering(that)) {\r\n                                var rowIndexOffset = that.getRowIndexOffset();\r\n                                var rowIndex = Math.floor(itemIndex) - rowIndexOffset;\r\n                                var component = that.component;\r\n                                var scrollable = component.getScrollable && component.getScrollable();\r\n                                var isSortingOperation = that.dataSource().operationTypes().sorting;\r\n                                if (scrollable && !that.option(\"legacyRendering\") && !isSortingOperation) {\r\n                                    var rowElement = component.getRowElement(rowIndex);\r\n                                    var $rowElement = rowElement && rowElement[0] && (0, _renderer.default)(rowElement[0]);\r\n                                    var top = $rowElement && $rowElement.position().top;\r\n                                    var allowedTopOffset = _browser.default.mozilla || _browser.default.msie ? 1 : 0;\r\n                                    if (top > allowedTopOffset) {\r\n                                        top = Math.round(top + $rowElement.outerHeight() * (itemIndex % 1));\r\n                                        scrollable.scrollTo({\r\n                                            y: top\r\n                                        })\r\n                                    }\r\n                                }\r\n                            }\r\n                        })\r\n                    },\r\n                    initVirtualRows: function() {\r\n                        var that = this;\r\n                        var virtualRowsRendering = isVirtualRowRendering(that);\r\n                        if (\"virtual\" !== that.option(\"scrolling.mode\") && true !== virtualRowsRendering || false === virtualRowsRendering || that.option(\"legacyRendering\") || !that.option(\"scrolling.rowPageSize\")) {\r\n                            that._visibleItems = null;\r\n                            that._rowsScrollController = null;\r\n                            return\r\n                        }\r\n                        var pageIndex = !isVirtualMode(this) && that.pageIndex() >= that.pageCount() ? that.pageCount() - 1 : that.pageIndex();\r\n                        that._rowPageIndex = Math.ceil(pageIndex * that.pageSize() / that.getRowPageSize());\r\n                        that._visibleItems = [];\r\n                        var isItemCountable = function(item) {\r\n                            return isItemCountableByDataSource(item, that._dataSource)\r\n                        };\r\n                        that._rowsScrollController = new _uiGrid_core.VirtualScrollController(that.component, {\r\n                            pageSize: function() {\r\n                                return that.getRowPageSize()\r\n                            },\r\n                            totalItemsCount: function() {\r\n                                return isVirtualMode(that) ? that.totalItemsCount() : that._items.filter(isItemCountable).length\r\n                            },\r\n                            hasKnownLastPage: function() {\r\n                                return true\r\n                            },\r\n                            pageIndex: function(index) {\r\n                                if (void 0 !== index) {\r\n                                    that._rowPageIndex = index\r\n                                }\r\n                                return that._rowPageIndex\r\n                            },\r\n                            isLoading: function() {\r\n                                return that.isLoading()\r\n                            },\r\n                            pageCount: function pageCount() {\r\n                                var pageCount = Math.ceil(this.totalItemsCount() / this.pageSize());\r\n                                return pageCount ? pageCount : 1\r\n                            },\r\n                            load: function() {\r\n                                if (that._rowsScrollController.pageIndex() >= this.pageCount()) {\r\n                                    that._rowPageIndex = this.pageCount() - 1;\r\n                                    that._rowsScrollController.pageIndex(that._rowPageIndex)\r\n                                }\r\n                                if (!that._rowsScrollController._dataSource.items().length && this.totalItemsCount()) {\r\n                                    return\r\n                                }\r\n                                that._rowsScrollController.handleDataChanged(function(change) {\r\n                                    change = change || {};\r\n                                    change.changeType = change.changeType || \"refresh\";\r\n                                    change.items = change.items || that._visibleItems;\r\n                                    that._visibleItems.forEach(function(item, index) {\r\n                                        item.rowIndex = index\r\n                                    });\r\n                                    that._fireChanged(change)\r\n                                })\r\n                            },\r\n                            updateLoading: function() {},\r\n                            itemsCount: function() {\r\n                                return that._rowsScrollController._dataSource.items().filter(isItemCountable).length\r\n                            },\r\n                            correctCount: function(items, count, fromEnd) {\r\n                                return _correctCount(items, count, fromEnd, function(item, isNextAfterLast, fromEnd) {\r\n                                    if (item.isNewRow) {\r\n                                        return isNextAfterLast && !fromEnd\r\n                                    }\r\n                                    if (isNextAfterLast && fromEnd) {\r\n                                        return !item.isNewRow\r\n                                    }\r\n                                    return isItemCountable(item)\r\n                                })\r\n                            },\r\n                            items: function(countableOnly) {\r\n                                var dataSource = that.dataSource();\r\n                                var virtualItemsCount = dataSource && dataSource.virtualItemsCount();\r\n                                var begin = virtualItemsCount ? virtualItemsCount.begin : 0;\r\n                                var rowPageSize = that.getRowPageSize();\r\n                                var skip = that._rowPageIndex * rowPageSize - begin;\r\n                                var take = rowPageSize;\r\n                                var result = that._items;\r\n                                if (skip < 0) {\r\n                                    return []\r\n                                }\r\n                                if (skip) {\r\n                                    skip = this.correctCount(result, skip);\r\n                                    result = result.slice(skip)\r\n                                }\r\n                                if (take) {\r\n                                    take = this.correctCount(result, take);\r\n                                    result = result.slice(0, take)\r\n                                }\r\n                                return countableOnly ? result.filter(isItemCountable) : result\r\n                            },\r\n                            viewportItems: function(items) {\r\n                                if (items) {\r\n                                    that._visibleItems = items\r\n                                }\r\n                                return that._visibleItems\r\n                            },\r\n                            onChanged: function() {},\r\n                            changingDuration: function(e) {\r\n                                var dataSource = that.dataSource();\r\n                                if (dataSource.isLoading()) {\r\n                                    return LOAD_TIMEOUT\r\n                                }\r\n                                return (null === dataSource || void 0 === dataSource ? void 0 : dataSource._renderTime) || 0\r\n                            }\r\n                        }, true);\r\n                        that._rowsScrollController.positionChanged.add(function() {\r\n                            var _that$_dataSource;\r\n                            null === (_that$_dataSource = that._dataSource) || void 0 === _that$_dataSource ? void 0 : _that$_dataSource.setViewportItemIndex(that._rowsScrollController.getViewportItemIndex())\r\n                        });\r\n                        if (that.isLoaded()) {\r\n                            that._rowsScrollController.load()\r\n                        }\r\n                    },\r\n                    _updateItemsCore: function(change) {\r\n                        var _this3 = this;\r\n                        var delta = this.getRowIndexDelta();\r\n                        this.callBase.apply(this, arguments);\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            var visibleItems = this._visibleItems;\r\n                            var isRefresh = \"refresh\" === change.changeType || change.isLiveUpdate;\r\n                            if (\"append\" === change.changeType && change.items && !change.items.length) {\r\n                                return\r\n                            }\r\n                            if (isRefresh || \"append\" === change.changeType || \"prepend\" === change.changeType) {\r\n                                change.cancel = true;\r\n                                isRefresh && rowsScrollController.reset(true);\r\n                                rowsScrollController.load()\r\n                            } else {\r\n                                if (\"update\" === change.changeType) {\r\n                                    change.rowIndices.forEach(function(rowIndex, index) {\r\n                                        var changeType = change.changeTypes[index];\r\n                                        var newItem = change.items[index];\r\n                                        if (\"update\" === changeType) {\r\n                                            visibleItems[rowIndex] = newItem\r\n                                        } else {\r\n                                            if (\"insert\" === changeType) {\r\n                                                visibleItems.splice(rowIndex, 0, newItem)\r\n                                            } else {\r\n                                                if (\"remove\" === changeType) {\r\n                                                    visibleItems.splice(rowIndex, 1)\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    })\r\n                                } else {\r\n                                    visibleItems.forEach(function(item, index) {\r\n                                        visibleItems[index] = _this3._items[index + delta] || visibleItems[index]\r\n                                    });\r\n                                    change.items = visibleItems\r\n                                }\r\n                                visibleItems.forEach(function(item, index) {\r\n                                    item.rowIndex = index\r\n                                })\r\n                            }\r\n                        }\r\n                    },\r\n                    _applyChange: function(change) {\r\n                        var that = this;\r\n                        var items = change.items;\r\n                        var changeType = change.changeType;\r\n                        var removeCount = change.removeCount;\r\n                        if (removeCount) {\r\n                            var fromEnd = \"prepend\" === changeType;\r\n                            removeCount = _correctCount(that._items, removeCount, fromEnd, function(item, isNextAfterLast) {\r\n                                return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && (that._dataSource.isGroupItemCountable(item.data) || isNextAfterLast)\r\n                            });\r\n                            change.removeCount = removeCount\r\n                        }\r\n                        switch (changeType) {\r\n                            case \"prepend\":\r\n                                that._items.unshift.apply(that._items, items);\r\n                                if (removeCount) {\r\n                                    that._items.splice(-removeCount)\r\n                                }\r\n                                break;\r\n                            case \"append\":\r\n                                that._items.push.apply(that._items, items);\r\n                                if (removeCount) {\r\n                                    that._items.splice(0, removeCount)\r\n                                }\r\n                                break;\r\n                            default:\r\n                                that.callBase(change)\r\n                        }\r\n                    },\r\n                    items: function(allItems) {\r\n                        return allItems ? this._items : this._visibleItems || this._items\r\n                    },\r\n                    getRowIndexDelta: function() {\r\n                        var visibleItems = this._visibleItems;\r\n                        var delta = 0;\r\n                        if (visibleItems && visibleItems[0]) {\r\n                            delta = this._items.indexOf(visibleItems[0])\r\n                        }\r\n                        return delta < 0 ? 0 : delta\r\n                    },\r\n                    getRowIndexOffset: function(byLoadedRows) {\r\n                        var offset = 0;\r\n                        var dataSource = this.dataSource();\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController && !byLoadedRows) {\r\n                            offset = rowsScrollController.beginPageIndex() * rowsScrollController._dataSource.pageSize()\r\n                        } else {\r\n                            if (\"virtual\" === this.option(\"scrolling.mode\") && dataSource) {\r\n                                offset = dataSource.beginPageIndex() * dataSource.pageSize()\r\n                            }\r\n                        }\r\n                        return offset\r\n                    },\r\n                    viewportSize: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        rowsScrollController && rowsScrollController.viewportSize.apply(rowsScrollController, arguments);\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.viewportSize.apply(dataSource, arguments)\r\n                    },\r\n                    viewportItemSize: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        rowsScrollController && rowsScrollController.viewportItemSize.apply(rowsScrollController, arguments);\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.viewportItemSize.apply(dataSource, arguments)\r\n                    },\r\n                    setViewportPosition: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        var dataSource = this._dataSource;\r\n                        if (rowsScrollController) {\r\n                            rowsScrollController.setViewportPosition.apply(rowsScrollController, arguments)\r\n                        } else {\r\n                            null === dataSource || void 0 === dataSource ? void 0 : dataSource.setViewportPosition.apply(dataSource, arguments)\r\n                        }\r\n                    },\r\n                    setContentSize: function(sizes) {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        rowsScrollController && rowsScrollController.setContentSize(sizes);\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.setContentSize(sizes)\r\n                    },\r\n                    loadIfNeed: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        rowsScrollController && rowsScrollController.loadIfNeed();\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.loadIfNeed()\r\n                    },\r\n                    getItemSize: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            return rowsScrollController.getItemSize.apply(rowsScrollController, arguments)\r\n                        }\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.getItemSize.apply(dataSource, arguments)\r\n                    },\r\n                    getItemSizes: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            return rowsScrollController.getItemSizes.apply(rowsScrollController, arguments)\r\n                        }\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.getItemSizes.apply(dataSource, arguments)\r\n                    },\r\n                    getContentOffset: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            return rowsScrollController.getContentOffset.apply(rowsScrollController, arguments)\r\n                        }\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.getContentOffset.apply(dataSource, arguments)\r\n                    },\r\n                    refresh: function(options) {\r\n                        var dataSource = this._dataSource;\r\n                        if (dataSource && options && options.load && isAppendMode(this)) {\r\n                            dataSource.resetCurrentTotalCount()\r\n                        }\r\n                        return this.callBase.apply(this, arguments)\r\n                    },\r\n                    dispose: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        rowsScrollController && rowsScrollController.dispose();\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                };\r\n                _uiGrid_core2.default.proxyMethod(members, \"virtualItemsCount\");\r\n                _uiGrid_core2.default.proxyMethod(members, \"getVirtualContentSize\");\r\n                _uiGrid_core2.default.proxyMethod(members, \"setViewportItemIndex\");\r\n                return members\r\n            }(),\r\n            resizing: {\r\n                resize: function() {\r\n                    var that = this;\r\n                    var callBase = that.callBase;\r\n                    var result;\r\n                    if (!that.option(\"legacyRendering\") && (isVirtualMode(that) || isVirtualRowRendering(that))) {\r\n                        clearTimeout(that._resizeTimeout);\r\n                        var diff = new Date - that._lastTime;\r\n                        var updateTimeout = that.option(\"scrolling.updateTimeout\");\r\n                        if (that._lastTime && diff < updateTimeout) {\r\n                            result = new _deferred.Deferred;\r\n                            that._resizeTimeout = setTimeout(function() {\r\n                                callBase.apply(that).done(result.resolve).fail(result.reject);\r\n                                that._lastTime = new Date\r\n                            }, updateTimeout);\r\n                            that._lastTime = new Date\r\n                        } else {\r\n                            result = callBase.apply(that);\r\n                            if (that._dataController.isLoaded()) {\r\n                                that._lastTime = new Date\r\n                            }\r\n                        }\r\n                    } else {\r\n                        result = callBase.apply(that)\r\n                    }\r\n                    return result\r\n                },\r\n                dispose: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    clearTimeout(this._resizeTimeout)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: VirtualScrollingRowsViewExtender\r\n        }\r\n    }\r\n};\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}