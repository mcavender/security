{"ast":null,"code":"/**\r\n * DevExtreme (ui/data_grid/aggregate_calculator.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _class = _interopRequireDefault(require(\"../../core/class\"));\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _errors = _interopRequireDefault(require(\"../../data/errors\"));\n\nvar _utils = _interopRequireDefault(require(\"../../data/utils\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction depthFirstSearch(i, depth, root, callback) {\n  var j = 0;\n\n  if (i < depth) {\n    for (; j < root.items.length; j++) {\n      depthFirstSearch(i + 1, depth, root.items[j], callback);\n    }\n  }\n\n  if (i === depth) {\n    callback(root);\n  }\n}\n\nfunction map(array, callback) {\n  var i;\n\n  if (\"map\" in array) {\n    return array.map(callback);\n  }\n\n  var result = new Array(array.length);\n\n  for (i in array) {\n    result[i] = callback(array[i], i);\n  }\n\n  return result;\n}\n\nfunction isEmpty(x) {\n  return x !== x || \"\" === x || null === x || void 0 === x;\n}\n\nfunction isCount(aggregator) {\n  return aggregator === _utils.default.aggregators.count;\n}\n\nfunction normalizeAggregate(aggregate) {\n  var selector = (0, _data.compileGetter)(aggregate.selector);\n  var skipEmptyValues = \"skipEmptyValues\" in aggregate ? aggregate.skipEmptyValues : true;\n  var aggregator = aggregate.aggregator;\n\n  if (\"string\" === typeof aggregator) {\n    aggregator = _utils.default.aggregators[aggregator];\n\n    if (!aggregator) {\n      throw _errors.default.errors.Error(\"E4001\", aggregate.aggregator);\n    }\n  }\n\n  return {\n    selector: selector,\n    aggregator: aggregator,\n    skipEmptyValues: skipEmptyValues\n  };\n}\n\nvar _default = _class.default.inherit({\n  ctor: function (options) {\n    this._data = options.data;\n    this._groupLevel = options.groupLevel || 0;\n    this._totalAggregates = map(options.totalAggregates || [], normalizeAggregate);\n    this._groupAggregates = map(options.groupAggregates || [], normalizeAggregate);\n    this._totals = [];\n  },\n  calculate: function () {\n    if (this._totalAggregates.length) {\n      this._calculateTotals(0, {\n        items: this._data\n      });\n    }\n\n    if (this._groupAggregates.length && this._groupLevel > 0) {\n      this._calculateGroups({\n        items: this._data\n      });\n    }\n  },\n  totalAggregates: function () {\n    return this._totals;\n  },\n  _aggregate: function (aggregates, data, container) {\n    var length = data.items ? data.items.length : 0;\n\n    for (var i = 0; i < aggregates.length; i++) {\n      if (isCount(aggregates[i].aggregator)) {\n        container[i] = (container[i] || 0) + length;\n        continue;\n      }\n\n      for (var j = 0; j < length; j++) {\n        this._accumulate(i, aggregates[i], container, data.items[j]);\n      }\n    }\n  },\n  _calculateTotals: function (level, data) {\n    if (0 === level) {\n      this._totals = this._seed(this._totalAggregates);\n    }\n\n    if (level === this._groupLevel) {\n      this._aggregate(this._totalAggregates, data, this._totals);\n    } else {\n      for (var i = 0; i < data.items.length; i++) {\n        this._calculateTotals(level + 1, data.items[i]);\n      }\n    }\n\n    if (0 === level) {\n      this._totals = this._finalize(this._totalAggregates, this._totals);\n    }\n  },\n  _calculateGroups: function (root) {\n    var maxLevel = this._groupLevel;\n    var currentLevel = maxLevel + 1;\n\n    var seedFn = this._seed.bind(this, this._groupAggregates);\n\n    var stepFn = this._aggregate.bind(this, this._groupAggregates);\n\n    var finalizeFn = this._finalize.bind(this, this._groupAggregates);\n\n    function aggregator(node) {\n      node.aggregates = seedFn(currentLevel - 1);\n\n      if (currentLevel === maxLevel) {\n        stepFn(node, node.aggregates);\n      } else {\n        depthFirstSearch(currentLevel, maxLevel, node, function (innerNode) {\n          stepFn(innerNode, node.aggregates);\n        });\n      }\n\n      node.aggregates = finalizeFn(node.aggregates);\n    }\n\n    while (--currentLevel > 0) {\n      depthFirstSearch(0, currentLevel, root, aggregator);\n    }\n  },\n  _seed: function (aggregates, groupIndex) {\n    return map(aggregates, function (aggregate) {\n      var aggregator = aggregate.aggregator;\n      var seed = \"seed\" in aggregator ? (0, _type.isFunction)(aggregator.seed) ? aggregator.seed(groupIndex) : aggregator.seed : NaN;\n      return seed;\n    });\n  },\n  _accumulate: function (aggregateIndex, aggregate, results, item) {\n    var value = aggregate.selector(item);\n    var aggregator = aggregate.aggregator;\n    var skipEmptyValues = aggregate.skipEmptyValues;\n\n    if (skipEmptyValues && isEmpty(value)) {\n      return;\n    }\n\n    if (results[aggregateIndex] !== results[aggregateIndex]) {\n      results[aggregateIndex] = value;\n    } else {\n      results[aggregateIndex] = aggregator.step(results[aggregateIndex], value);\n    }\n  },\n  _finalize: function (aggregates, results) {\n    return map(aggregates, function (aggregate, index) {\n      var fin = aggregate.aggregator.finalize;\n      return fin ? fin(results[index]) : results[index];\n    });\n  }\n});\n\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Users/CapiniaC/Desktop/Collection/Work/project/security/node_modules/devextreme/ui/data_grid/aggregate_calculator.js"],"names":["exports","default","_class","_interopRequireDefault","require","_data","_type","_errors","_utils","obj","__esModule","depthFirstSearch","i","depth","root","callback","j","items","length","map","array","result","Array","isEmpty","x","isCount","aggregator","aggregators","count","normalizeAggregate","aggregate","selector","compileGetter","skipEmptyValues","errors","Error","_default","inherit","ctor","options","data","_groupLevel","groupLevel","_totalAggregates","totalAggregates","_groupAggregates","groupAggregates","_totals","calculate","_calculateTotals","_calculateGroups","_aggregate","aggregates","container","_accumulate","level","_seed","_finalize","maxLevel","currentLevel","seedFn","bind","stepFn","finalizeFn","node","innerNode","groupIndex","seed","isFunction","NaN","aggregateIndex","results","item","value","step","index","fin","finalize","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/data_grid/aggregate_calculator.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _class = _interopRequireDefault(require(\"../../core/class\"));\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _errors = _interopRequireDefault(require(\"../../data/errors\"));\r\nvar _utils = _interopRequireDefault(require(\"../../data/utils\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction depthFirstSearch(i, depth, root, callback) {\r\n    var j = 0;\r\n    if (i < depth) {\r\n        for (; j < root.items.length; j++) {\r\n            depthFirstSearch(i + 1, depth, root.items[j], callback)\r\n        }\r\n    }\r\n    if (i === depth) {\r\n        callback(root)\r\n    }\r\n}\r\n\r\nfunction map(array, callback) {\r\n    var i;\r\n    if (\"map\" in array) {\r\n        return array.map(callback)\r\n    }\r\n    var result = new Array(array.length);\r\n    for (i in array) {\r\n        result[i] = callback(array[i], i)\r\n    }\r\n    return result\r\n}\r\n\r\nfunction isEmpty(x) {\r\n    return x !== x || \"\" === x || null === x || void 0 === x\r\n}\r\n\r\nfunction isCount(aggregator) {\r\n    return aggregator === _utils.default.aggregators.count\r\n}\r\n\r\nfunction normalizeAggregate(aggregate) {\r\n    var selector = (0, _data.compileGetter)(aggregate.selector);\r\n    var skipEmptyValues = \"skipEmptyValues\" in aggregate ? aggregate.skipEmptyValues : true;\r\n    var aggregator = aggregate.aggregator;\r\n    if (\"string\" === typeof aggregator) {\r\n        aggregator = _utils.default.aggregators[aggregator];\r\n        if (!aggregator) {\r\n            throw _errors.default.errors.Error(\"E4001\", aggregate.aggregator)\r\n        }\r\n    }\r\n    return {\r\n        selector: selector,\r\n        aggregator: aggregator,\r\n        skipEmptyValues: skipEmptyValues\r\n    }\r\n}\r\nvar _default = _class.default.inherit({\r\n    ctor: function(options) {\r\n        this._data = options.data;\r\n        this._groupLevel = options.groupLevel || 0;\r\n        this._totalAggregates = map(options.totalAggregates || [], normalizeAggregate);\r\n        this._groupAggregates = map(options.groupAggregates || [], normalizeAggregate);\r\n        this._totals = []\r\n    },\r\n    calculate: function() {\r\n        if (this._totalAggregates.length) {\r\n            this._calculateTotals(0, {\r\n                items: this._data\r\n            })\r\n        }\r\n        if (this._groupAggregates.length && this._groupLevel > 0) {\r\n            this._calculateGroups({\r\n                items: this._data\r\n            })\r\n        }\r\n    },\r\n    totalAggregates: function() {\r\n        return this._totals\r\n    },\r\n    _aggregate: function(aggregates, data, container) {\r\n        var length = data.items ? data.items.length : 0;\r\n        for (var i = 0; i < aggregates.length; i++) {\r\n            if (isCount(aggregates[i].aggregator)) {\r\n                container[i] = (container[i] || 0) + length;\r\n                continue\r\n            }\r\n            for (var j = 0; j < length; j++) {\r\n                this._accumulate(i, aggregates[i], container, data.items[j])\r\n            }\r\n        }\r\n    },\r\n    _calculateTotals: function(level, data) {\r\n        if (0 === level) {\r\n            this._totals = this._seed(this._totalAggregates)\r\n        }\r\n        if (level === this._groupLevel) {\r\n            this._aggregate(this._totalAggregates, data, this._totals)\r\n        } else {\r\n            for (var i = 0; i < data.items.length; i++) {\r\n                this._calculateTotals(level + 1, data.items[i])\r\n            }\r\n        }\r\n        if (0 === level) {\r\n            this._totals = this._finalize(this._totalAggregates, this._totals)\r\n        }\r\n    },\r\n    _calculateGroups: function(root) {\r\n        var maxLevel = this._groupLevel;\r\n        var currentLevel = maxLevel + 1;\r\n        var seedFn = this._seed.bind(this, this._groupAggregates);\r\n        var stepFn = this._aggregate.bind(this, this._groupAggregates);\r\n        var finalizeFn = this._finalize.bind(this, this._groupAggregates);\r\n\r\n        function aggregator(node) {\r\n            node.aggregates = seedFn(currentLevel - 1);\r\n            if (currentLevel === maxLevel) {\r\n                stepFn(node, node.aggregates)\r\n            } else {\r\n                depthFirstSearch(currentLevel, maxLevel, node, function(innerNode) {\r\n                    stepFn(innerNode, node.aggregates)\r\n                })\r\n            }\r\n            node.aggregates = finalizeFn(node.aggregates)\r\n        }\r\n        while (--currentLevel > 0) {\r\n            depthFirstSearch(0, currentLevel, root, aggregator)\r\n        }\r\n    },\r\n    _seed: function(aggregates, groupIndex) {\r\n        return map(aggregates, function(aggregate) {\r\n            var aggregator = aggregate.aggregator;\r\n            var seed = \"seed\" in aggregator ? (0, _type.isFunction)(aggregator.seed) ? aggregator.seed(groupIndex) : aggregator.seed : NaN;\r\n            return seed\r\n        })\r\n    },\r\n    _accumulate: function(aggregateIndex, aggregate, results, item) {\r\n        var value = aggregate.selector(item);\r\n        var aggregator = aggregate.aggregator;\r\n        var skipEmptyValues = aggregate.skipEmptyValues;\r\n        if (skipEmptyValues && isEmpty(value)) {\r\n            return\r\n        }\r\n        if (results[aggregateIndex] !== results[aggregateIndex]) {\r\n            results[aggregateIndex] = value\r\n        } else {\r\n            results[aggregateIndex] = aggregator.step(results[aggregateIndex], value)\r\n        }\r\n    },\r\n    _finalize: function(aggregates, results) {\r\n        return map(aggregates, function(aggregate, index) {\r\n            var fin = aggregate.aggregator.finalize;\r\n            return fin ? fin(results[index]) : results[index]\r\n        })\r\n    }\r\n});\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}