{"ast":null,"code":"/**\r\n * DevExtreme (ui/filter_builder/utils.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.getGroupCriteria = getGroupCriteria;\nexports.setGroupValue = setGroupValue;\nexports.getGroupMenuItem = getGroupMenuItem;\nexports.getGroupValue = getGroupValue;\nexports.getFilterOperations = getFilterOperations;\nexports.getCaptionByOperation = getCaptionByOperation;\nexports.getOperationFromAvailable = getOperationFromAvailable;\nexports.getCustomOperation = getCustomOperation;\nexports.getAvailableOperations = getAvailableOperations;\nexports.getDefaultOperation = getDefaultOperation;\nexports.createCondition = createCondition;\nexports.removeItem = removeItem;\nexports.createEmptyGroup = createEmptyGroup;\nexports.isEmptyGroup = isEmptyGroup;\nexports.addItem = addItem;\nexports.getField = getField;\nexports.isGroup = isGroup;\nexports.isCondition = isCondition;\nexports.convertToInnerStructure = convertToInnerStructure;\nexports.getNormalizedFields = getNormalizedFields;\nexports.getFilterExpression = getFilterExpression;\nexports.getNormalizedFilter = getNormalizedFilter;\nexports.getCurrentLookupValueText = getCurrentLookupValueText;\nexports.getCurrentValueText = getCurrentValueText;\nexports.getItems = getItems;\nexports.getCaptionWithParents = getCaptionWithParents;\nexports.updateConditionByOperation = updateConditionByOperation;\nexports.getOperationValue = getOperationValue;\nexports.isValidCondition = isValidCondition;\nexports.getMergedOperations = getMergedOperations;\nexports.removeFieldConditionsFromFilter = removeFieldConditionsFromFilter;\nexports.syncFilters = syncFilters;\nexports.getMatchedConditions = getMatchedConditions;\nexports.filterHasField = filterHasField;\nexports.renderValueText = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _errors = _interopRequireDefault(require(\"../../data/errors\"));\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\n\nvar _filtering = _interopRequireDefault(require(\"../shared/filtering\"));\n\nvar _format_helper = _interopRequireDefault(require(\"../../format_helper\"));\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _inflector = require(\"../../core/utils/inflector\");\n\nvar _between = require(\"./between\");\n\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _ui2 = _interopRequireDefault(require(\"./ui.filter_operations_dictionary\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DEFAULT_DATA_TYPE = \"string\";\nvar EMPTY_MENU_ICON = \"icon-none\";\nvar AND_GROUP_OPERATION = \"and\";\nvar EQUAL_OPERATION = \"=\";\nvar NOT_EQUAL_OPERATION = \"<>\";\nvar DATATYPE_OPERATIONS = {\n  number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\", \"isblank\", \"isnotblank\"],\n  date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  \"boolean\": [\"=\", \"<>\", \"isblank\", \"isnotblank\"],\n  object: [\"isblank\", \"isnotblank\"]\n};\nvar DEFAULT_FORMAT = {\n  date: \"shortDate\",\n  datetime: \"shortDateShortTime\"\n};\nvar LOOKUP_OPERATIONS = [\"=\", \"<>\", \"isblank\", \"isnotblank\"];\nvar AVAILABLE_FIELD_PROPERTIES = [\"caption\", \"customizeText\", \"dataField\", \"dataType\", \"editorTemplate\", \"falseText\", \"editorOptions\", \"filterOperations\", \"format\", \"lookup\", \"trueText\", \"calculateFilterExpression\", \"name\"];\nvar FILTER_BUILDER_CLASS = \"dx-filterbuilder\";\nvar FILTER_BUILDER_ITEM_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-text\";\nvar FILTER_BUILDER_ITEM_TEXT_PART_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-part\";\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-separator\";\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS = FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS + \"-empty\";\n\nfunction getFormattedValueText(field, value) {\n  var fieldFormat = field.format || DEFAULT_FORMAT[field.dataType];\n  return _format_helper.default.format(value, fieldFormat);\n}\n\nfunction isNegationGroup(group) {\n  return group && group.length > 1 && \"!\" === group[0] && !isCondition(group);\n}\n\nfunction getGroupCriteria(group) {\n  return isNegationGroup(group) ? group[1] : group;\n}\n\nfunction setGroupCriteria(group, criteria) {\n  if (isNegationGroup(group)) {\n    group[1] = criteria;\n  } else {\n    group = criteria;\n  }\n\n  return group;\n}\n\nfunction convertGroupToNewStructure(group, value) {\n  var isNegationValue = function (value) {\n    return value.indexOf(\"!\") !== -1;\n  };\n\n  var convertGroupToNegationGroup = function (group) {\n    var criteria = group.slice(0);\n    group.length = 0;\n    group.push(\"!\", criteria);\n  };\n\n  var convertNegationGroupToGroup = function (group) {\n    var criteria = getGroupCriteria(group);\n    group.length = 0;\n    [].push.apply(group, criteria);\n  };\n\n  if (isNegationValue(value)) {\n    if (!isNegationGroup(group)) {\n      convertGroupToNegationGroup(group);\n    }\n  } else {\n    if (isNegationGroup(group)) {\n      convertNegationGroupToGroup(group);\n    }\n  }\n}\n\nfunction setGroupValue(group, value) {\n  convertGroupToNewStructure(group, value);\n  var criteria = getGroupCriteria(group);\n  var i;\n\n  var getNormalizedGroupValue = function (value) {\n    return value.indexOf(\"!\") === -1 ? value : value.substring(1);\n  };\n\n  var changeCriteriaValue = function (criteria, value) {\n    for (i = 0; i < criteria.length; i++) {\n      if (!Array.isArray(criteria[i])) {\n        criteria[i] = value;\n      }\n    }\n  };\n\n  value = getNormalizedGroupValue(value);\n  changeCriteriaValue(criteria, value);\n  return group;\n}\n\nfunction getGroupMenuItem(group, availableGroups) {\n  var groupValue = getGroupValue(group);\n  return availableGroups.filter(function (item) {\n    return item.value === groupValue;\n  })[0];\n}\n\nfunction getCriteriaOperation(criteria) {\n  if (isCondition(criteria)) {\n    return AND_GROUP_OPERATION;\n  }\n\n  var value = \"\";\n\n  for (var i = 0; i < criteria.length; i++) {\n    var item = criteria[i];\n\n    if (!Array.isArray(item)) {\n      if (value && value !== item) {\n        throw new _errors.default.errors.Error(\"E4019\");\n      }\n\n      if (\"!\" !== item) {\n        value = item;\n      }\n    }\n  }\n\n  return value;\n}\n\nfunction getGroupValue(group) {\n  var criteria = getGroupCriteria(group);\n  var value = getCriteriaOperation(criteria);\n\n  if (!value) {\n    value = AND_GROUP_OPERATION;\n  }\n\n  if (criteria !== group) {\n    value = \"!\" + value;\n  }\n\n  return value;\n}\n\nfunction getDefaultFilterOperations(field) {\n  return field.lookup && LOOKUP_OPERATIONS || DATATYPE_OPERATIONS[field.dataType || DEFAULT_DATA_TYPE];\n}\n\nfunction containItems(entity) {\n  return Array.isArray(entity) && entity.length;\n}\n\nfunction getFilterOperations(field) {\n  var result = containItems(field.filterOperations) ? field.filterOperations : getDefaultFilterOperations(field);\n  return (0, _extend.extend)([], result);\n}\n\nfunction getCaptionByOperation(operation, filterOperationDescriptions) {\n  var operationName = _ui2.default.getNameByFilterOperation(operation);\n\n  return filterOperationDescriptions && filterOperationDescriptions[operationName] ? filterOperationDescriptions[operationName] : operationName;\n}\n\nfunction getOperationFromAvailable(operation, availableOperations) {\n  for (var i = 0; i < availableOperations.length; i++) {\n    if (availableOperations[i].value === operation) {\n      return availableOperations[i];\n    }\n  }\n\n  throw new _ui.default.Error(\"E1048\", operation);\n}\n\nfunction getCustomOperation(customOperations, name) {\n  var filteredOperations = customOperations.filter(function (item) {\n    return item.name === name;\n  });\n  return filteredOperations.length ? filteredOperations[0] : null;\n}\n\nfunction getAvailableOperations(field, filterOperationDescriptions, customOperations) {\n  var filterOperations = getFilterOperations(field);\n  var isLookupField = !!field.lookup;\n  customOperations.forEach(function (customOperation) {\n    if (!field.filterOperations && filterOperations.indexOf(customOperation.name) === -1) {\n      var dataTypes = customOperation && customOperation.dataTypes;\n      var isOperationForbidden = isLookupField ? !!customOperation.notForLookup : false;\n\n      if (!isOperationForbidden && dataTypes && dataTypes.indexOf(field.dataType || DEFAULT_DATA_TYPE) >= 0) {\n        filterOperations.push(customOperation.name);\n      }\n    }\n  });\n  return filterOperations.map(function (operation) {\n    var customOperation = getCustomOperation(customOperations, operation);\n\n    if (customOperation) {\n      return {\n        icon: customOperation.icon || EMPTY_MENU_ICON,\n        text: customOperation.caption || (0, _inflector.captionize)(customOperation.name),\n        value: customOperation.name,\n        isCustom: true\n      };\n    } else {\n      return {\n        icon: _ui2.default.getIconByFilterOperation(operation) || EMPTY_MENU_ICON,\n        text: getCaptionByOperation(operation, filterOperationDescriptions),\n        value: operation\n      };\n    }\n  });\n}\n\nfunction getDefaultOperation(field) {\n  return field.defaultFilterOperation || getFilterOperations(field)[0];\n}\n\nfunction createCondition(field, customOperations) {\n  var condition = [field.dataField, \"\", \"\"];\n  var filterOperation = getDefaultOperation(field);\n  updateConditionByOperation(condition, filterOperation, customOperations);\n  return condition;\n}\n\nfunction removeItem(group, item) {\n  var criteria = getGroupCriteria(group);\n  var index = criteria.indexOf(item);\n  criteria.splice(index, 1);\n\n  if (1 !== criteria.length) {\n    criteria.splice(index, 1);\n  }\n\n  return group;\n}\n\nfunction createEmptyGroup(value) {\n  return value.indexOf(\"not\") !== -1 ? [\"!\", [value.substring(3).toLowerCase()]] : [value];\n}\n\nfunction isEmptyGroup(group) {\n  var criteria = getGroupCriteria(group);\n\n  if (isCondition(criteria)) {\n    return false;\n  }\n\n  var hasConditions = criteria.some(function (item) {\n    return isCondition(item);\n  });\n  return !hasConditions;\n}\n\nfunction addItem(item, group) {\n  var criteria = getGroupCriteria(group);\n  var groupValue = getGroupValue(criteria);\n  1 === criteria.length ? criteria.unshift(item) : criteria.push(item, groupValue);\n  return group;\n}\n\nfunction getField(dataField, fields) {\n  for (var i = 0; i < fields.length; i++) {\n    if (fields[i].name === dataField) {\n      return fields[i];\n    }\n\n    if (fields[i].dataField.toLowerCase() === dataField.toLowerCase()) {\n      return fields[i];\n    }\n  }\n\n  var extendedFields = getItems(fields, true).filter(function (item) {\n    return item.dataField.toLowerCase() === dataField.toLowerCase();\n  });\n\n  if (extendedFields.length > 0) {\n    return extendedFields[0];\n  }\n\n  throw new _ui.default.Error(\"E1047\", dataField);\n}\n\nfunction isGroup(criteria) {\n  if (!Array.isArray(criteria)) {\n    return false;\n  }\n\n  return criteria.length < 2 || Array.isArray(criteria[0]) || Array.isArray(criteria[1]);\n}\n\nfunction isCondition(criteria) {\n  if (!Array.isArray(criteria)) {\n    return false;\n  }\n\n  return criteria.length > 1 && !Array.isArray(criteria[0]) && !Array.isArray(criteria[1]);\n}\n\nfunction convertToInnerGroup(group, customOperations) {\n  var groupOperation = getCriteriaOperation(group).toLowerCase() || AND_GROUP_OPERATION;\n  var innerGroup = [];\n\n  for (var i = 0; i < group.length; i++) {\n    if (isGroup(group[i])) {\n      innerGroup.push(convertToInnerStructure(group[i], customOperations));\n      innerGroup.push(groupOperation);\n    } else {\n      if (isCondition(group[i])) {\n        innerGroup.push(convertToInnerCondition(group[i], customOperations));\n        innerGroup.push(groupOperation);\n      }\n    }\n  }\n\n  if (0 === innerGroup.length) {\n    innerGroup.push(groupOperation);\n  }\n\n  return innerGroup;\n}\n\nfunction conditionHasCustomOperation(condition, customOperations) {\n  var customOperation = getCustomOperation(customOperations, condition[1]);\n  return customOperation && customOperation.name === condition[1];\n}\n\nfunction convertToInnerCondition(condition, customOperations) {\n  if (conditionHasCustomOperation(condition, customOperations)) {\n    return condition;\n  }\n\n  if (condition.length < 3) {\n    condition[2] = condition[1];\n    condition[1] = EQUAL_OPERATION;\n  }\n\n  return condition;\n}\n\nfunction convertToInnerStructure(value, customOperations) {\n  if (!value) {\n    return [AND_GROUP_OPERATION];\n  }\n\n  value = (0, _extend.extend)(true, [], value);\n\n  if (isCondition(value)) {\n    return [convertToInnerCondition(value, customOperations), AND_GROUP_OPERATION];\n  }\n\n  if (isNegationGroup(value)) {\n    return [\"!\", isCondition(value[1]) ? [convertToInnerCondition(value[1], customOperations), AND_GROUP_OPERATION] : isNegationGroup(value[1]) ? [convertToInnerStructure(value[1], customOperations), AND_GROUP_OPERATION] : convertToInnerGroup(value[1], customOperations)];\n  }\n\n  return convertToInnerGroup(value, customOperations);\n}\n\nfunction getNormalizedFields(fields) {\n  return fields.reduce(function (result, field) {\n    if ((0, _type.isDefined)(field.dataField)) {\n      var normalizedField = {};\n\n      for (var key in field) {\n        if (field[key] && AVAILABLE_FIELD_PROPERTIES.indexOf(key) > -1) {\n          normalizedField[key] = field[key];\n        }\n      }\n\n      normalizedField.defaultCalculateFilterExpression = _filtering.default.defaultCalculateFilterExpression;\n\n      if (!(0, _type.isDefined)(normalizedField.dataType)) {\n        normalizedField.dataType = DEFAULT_DATA_TYPE;\n      }\n\n      if (!(0, _type.isDefined)(normalizedField.trueText)) {\n        normalizedField.trueText = _message.default.format(\"dxDataGrid-trueText\");\n      }\n\n      if (!(0, _type.isDefined)(normalizedField.falseText)) {\n        normalizedField.falseText = _message.default.format(\"dxDataGrid-falseText\");\n      }\n\n      result.push(normalizedField);\n    }\n\n    return result;\n  }, []);\n}\n\nfunction getConditionFilterExpression(condition, fields, customOperations, target) {\n  var field = getField(condition[0], fields);\n  var filterExpression = convertToInnerCondition(condition, customOperations);\n  var customOperation = customOperations.length && getCustomOperation(customOperations, filterExpression[1]);\n\n  if (customOperation && customOperation.calculateFilterExpression) {\n    return customOperation.calculateFilterExpression.apply(customOperation, [filterExpression[2], field, fields]);\n  } else {\n    if (field.createFilterExpression) {\n      return field.createFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n    } else {\n      if (field.calculateFilterExpression) {\n        return field.calculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n      } else {\n        return field.defaultCalculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n      }\n    }\n  }\n}\n\nfunction getFilterExpression(value, fields, customOperations, target) {\n  if (!(0, _type.isDefined)(value)) {\n    return null;\n  }\n\n  if (isNegationGroup(value)) {\n    var filterExpression = getFilterExpression(value[1], fields, customOperations, target);\n    return [\"!\", filterExpression];\n  }\n\n  var criteria = getGroupCriteria(value);\n\n  if (isCondition(criteria)) {\n    return getConditionFilterExpression(criteria, fields, customOperations, target) || null;\n  } else {\n    var result = [];\n\n    var _filterExpression;\n\n    var groupValue = getGroupValue(criteria);\n\n    for (var i = 0; i < criteria.length; i++) {\n      if (isGroup(criteria[i])) {\n        _filterExpression = getFilterExpression(criteria[i], fields, customOperations, target);\n\n        if (_filterExpression) {\n          i && result.push(groupValue);\n          result.push(_filterExpression);\n        }\n      } else {\n        if (isCondition(criteria[i])) {\n          _filterExpression = getConditionFilterExpression(criteria[i], fields, customOperations, target);\n\n          if (_filterExpression) {\n            result.length && result.push(groupValue);\n            result.push(_filterExpression);\n          }\n        }\n      }\n    }\n\n    if (1 === result.length) {\n      result = result[0];\n    }\n\n    return result.length ? result : null;\n  }\n}\n\nfunction getNormalizedFilter(group) {\n  var criteria = getGroupCriteria(group);\n  var i;\n\n  if (0 === criteria.length) {\n    return null;\n  }\n\n  var itemsForRemove = [];\n\n  for (i = 0; i < criteria.length; i++) {\n    if (isGroup(criteria[i])) {\n      var normalizedGroupValue = getNormalizedFilter(criteria[i]);\n\n      if (normalizedGroupValue) {\n        criteria[i] = normalizedGroupValue;\n      } else {\n        itemsForRemove.push(criteria[i]);\n      }\n    } else {\n      if (isCondition(criteria[i])) {\n        if (!isValidCondition(criteria[i])) {\n          itemsForRemove.push(criteria[i]);\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < itemsForRemove.length; i++) {\n    removeItem(criteria, itemsForRemove[i]);\n  }\n\n  if (1 === criteria.length) {\n    return null;\n  }\n\n  criteria.splice(criteria.length - 1, 1);\n\n  if (1 === criteria.length) {\n    group = setGroupCriteria(group, criteria[0]);\n  }\n\n  if (0 === group.length) {\n    return null;\n  }\n\n  return group;\n}\n\nfunction getCurrentLookupValueText(field, value, handler) {\n  if (\"\" === value) {\n    handler(\"\");\n    return;\n  }\n\n  var lookup = field.lookup;\n\n  if (lookup.items) {\n    handler(lookup.calculateCellValue(value) || \"\");\n  } else {\n    var lookupDataSource = (0, _type.isFunction)(lookup.dataSource) ? lookup.dataSource({}) : lookup.dataSource;\n    var dataSource = new _data_source.DataSource(lookupDataSource);\n    dataSource.loadSingle(lookup.valueExpr, value).done(function (result) {\n      result ? handler(lookup.displayExpr ? (0, _data.compileGetter)(lookup.displayExpr)(result) : result) : handler(\"\");\n    }).fail(function () {\n      handler(\"\");\n    });\n  }\n}\n\nfunction getPrimitiveValueText(field, value, customOperation, target) {\n  var valueText;\n\n  if (true === value) {\n    valueText = field.trueText || _message.default.format(\"dxDataGrid-trueText\");\n  } else {\n    if (false === value) {\n      valueText = field.falseText || _message.default.format(\"dxDataGrid-falseText\");\n    } else {\n      valueText = getFormattedValueText(field, value);\n    }\n  }\n\n  if (field.customizeText) {\n    valueText = field.customizeText.call(field, {\n      value: value,\n      valueText: valueText,\n      target: target\n    });\n  }\n\n  if (customOperation && customOperation.customizeText) {\n    valueText = customOperation.customizeText.call(customOperation, {\n      value: value,\n      valueText: valueText,\n      field: field,\n      target: target\n    });\n  }\n\n  return valueText;\n}\n\nfunction getArrayValueText(field, value, customOperation, target) {\n  return value.map(function (v) {\n    return getPrimitiveValueText(field, v, customOperation, target);\n  });\n}\n\nfunction checkDefaultValue(value) {\n  return \"\" === value || null === value;\n}\n\nfunction getCurrentValueText(field, value, customOperation) {\n  var target = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : \"filterBuilder\";\n\n  if (checkDefaultValue(value)) {\n    return \"\";\n  }\n\n  if (Array.isArray(value)) {\n    var result = new _deferred.Deferred();\n\n    _deferred.when.apply(this, getArrayValueText(field, value, customOperation, target)).done(function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var text = args.some(function (item) {\n        return !checkDefaultValue(item);\n      }) ? args.map(function (item) {\n        return !checkDefaultValue(item) ? item : \"?\";\n      }) : \"\";\n      result.resolve(text);\n    });\n\n    return result;\n  } else {\n    return getPrimitiveValueText(field, value, customOperation, target);\n  }\n}\n\nfunction itemExists(plainItems, parentId) {\n  return plainItems.some(function (item) {\n    return item.dataField === parentId;\n  });\n}\n\nfunction pushItemAndCheckParent(originalItems, plainItems, item) {\n  var dataField = item.dataField;\n\n  if (hasParent(dataField)) {\n    item.parentId = getParentIdFromItemDataField(dataField);\n\n    if (!itemExists(plainItems, item.parentId) && !itemExists(originalItems, item.parentId)) {\n      pushItemAndCheckParent(originalItems, plainItems, {\n        id: item.parentId,\n        dataType: \"object\",\n        dataField: item.parentId,\n        caption: generateCaptionByDataField(item.parentId, true),\n        filterOperations: [\"isblank\", \"isnotblank\"]\n      });\n    }\n  }\n\n  plainItems.push(item);\n}\n\nfunction generateCaptionByDataField(dataField, allowHierarchicalFields) {\n  var caption = \"\";\n\n  if (allowHierarchicalFields) {\n    dataField = dataField.substring(dataField.lastIndexOf(\".\") + 1);\n  } else {\n    if (hasParent(dataField)) {\n      dataField.split(\".\").forEach(function (field, index, arr) {\n        caption += (0, _inflector.captionize)(field);\n\n        if (index !== arr.length - 1) {\n          caption += \".\";\n        }\n      });\n      return caption;\n    }\n  }\n\n  return (0, _inflector.captionize)(dataField);\n}\n\nfunction getItems(fields, allowHierarchicalFields) {\n  var items = [];\n\n  for (var i = 0; i < fields.length; i++) {\n    var item = (0, _extend.extend)(true, {\n      caption: generateCaptionByDataField(fields[i].dataField, allowHierarchicalFields)\n    }, fields[i]);\n    item.id = item.name || item.dataField;\n\n    if (allowHierarchicalFields) {\n      pushItemAndCheckParent(fields, items, item);\n    } else {\n      items.push(item);\n    }\n  }\n\n  return items;\n}\n\nfunction hasParent(dataField) {\n  return dataField.lastIndexOf(\".\") !== -1;\n}\n\nfunction getParentIdFromItemDataField(dataField) {\n  return dataField.substring(0, dataField.lastIndexOf(\".\"));\n}\n\nfunction getCaptionWithParents(item, plainItems) {\n  if (hasParent(item.dataField)) {\n    var parentId = getParentIdFromItemDataField(item.dataField);\n\n    for (var i = 0; i < plainItems.length; i++) {\n      if (plainItems[i].dataField === parentId) {\n        return getCaptionWithParents(plainItems[i], plainItems) + \".\" + item.caption;\n      }\n    }\n  }\n\n  return item.caption;\n}\n\nfunction updateConditionByOperation(condition, operation, customOperations) {\n  var customOperation = getCustomOperation(customOperations, operation);\n\n  if (customOperation) {\n    if (false === customOperation.hasValue) {\n      condition[1] = operation;\n      condition.length = 2;\n    } else {\n      condition[1] = operation;\n      condition[2] = \"\";\n    }\n\n    return condition;\n  }\n\n  if (\"isblank\" === operation) {\n    condition[1] = EQUAL_OPERATION;\n    condition[2] = null;\n  } else {\n    if (\"isnotblank\" === operation) {\n      condition[1] = NOT_EQUAL_OPERATION;\n      condition[2] = null;\n    } else {\n      customOperation = getCustomOperation(customOperations, condition[1]);\n\n      if (customOperation || 2 === condition.length || null === condition[2]) {\n        condition[2] = \"\";\n      }\n\n      condition[1] = operation;\n    }\n  }\n\n  return condition;\n}\n\nfunction getOperationValue(condition) {\n  var caption;\n\n  if (null === condition[2]) {\n    if (condition[1] === EQUAL_OPERATION) {\n      caption = \"isblank\";\n    } else {\n      caption = \"isnotblank\";\n    }\n  } else {\n    caption = condition[1];\n  }\n\n  return caption;\n}\n\nfunction isValidCondition(condition) {\n  return \"\" !== condition[2];\n}\n\nfunction getMergedOperations(customOperations, betweenCaption, context) {\n  var result = (0, _extend.extend)(true, [], customOperations);\n  var betweenIndex = -1;\n  result.some(function (customOperation, index) {\n    if (\"between\" === customOperation.name) {\n      betweenIndex = index;\n      return true;\n    }\n  });\n\n  if (betweenIndex !== -1) {\n    result[betweenIndex] = (0, _extend.extend)((0, _between.getConfig)(betweenCaption, context), result[betweenIndex]);\n  } else {\n    result.unshift((0, _between.getConfig)(betweenCaption, context));\n  }\n\n  return result;\n}\n\nfunction isMatchedCondition(filter, addedFilterDataField) {\n  return filter[0] === addedFilterDataField;\n}\n\nfunction removeFieldConditionsFromFilter(filter, dataField) {\n  if (!filter || 0 === filter.length) {\n    return null;\n  }\n\n  if (isCondition(filter)) {\n    var hasMatchedCondition = isMatchedCondition(filter, dataField);\n    return !hasMatchedCondition ? filter : null;\n  } else {\n    return syncConditionIntoGroup(filter, [dataField], false);\n  }\n}\n\nfunction syncConditionIntoGroup(filter, addedFilter, canPush) {\n  var result = [];\n  filter.forEach(function (item) {\n    if (isCondition(item)) {\n      if (isMatchedCondition(item, addedFilter[0])) {\n        if (canPush) {\n          result.push(addedFilter);\n          canPush = false;\n        } else {\n          result.splice(result.length - 1, 1);\n        }\n      } else {\n        result.push(item);\n      }\n    } else {\n      (result.length || isGroup(item)) && result.push(item);\n    }\n  });\n\n  if (0 === result.length) {\n    return null;\n  }\n\n  if (canPush) {\n    result.push(AND_GROUP_OPERATION);\n    result.push(addedFilter);\n  }\n\n  return 1 === result.length ? result[0] : result;\n}\n\nfunction syncFilters(filter, addedFilter) {\n  if (null === filter || 0 === filter.length) {\n    return addedFilter;\n  }\n\n  if (isCondition(filter)) {\n    if (isMatchedCondition(filter, addedFilter[0])) {\n      return addedFilter;\n    } else {\n      return [filter, AND_GROUP_OPERATION, addedFilter];\n    }\n  }\n\n  var groupValue = getGroupValue(filter);\n\n  if (groupValue !== AND_GROUP_OPERATION) {\n    return [addedFilter, \"and\", filter];\n  }\n\n  return syncConditionIntoGroup(filter, addedFilter, true);\n}\n\nfunction getMatchedConditions(filter, dataField) {\n  if (null === filter || 0 === filter.length) {\n    return [];\n  }\n\n  if (isCondition(filter)) {\n    if (isMatchedCondition(filter, dataField)) {\n      return [filter];\n    } else {\n      return [];\n    }\n  }\n\n  var groupValue = getGroupValue(filter);\n\n  if (groupValue !== AND_GROUP_OPERATION) {\n    return [];\n  }\n\n  var result = filter.filter(function (item) {\n    return isCondition(item) && isMatchedCondition(item, dataField);\n  });\n  return result;\n}\n\nfunction filterHasField(filter, dataField) {\n  if (null === filter || 0 === filter.length) {\n    return false;\n  }\n\n  if (isCondition(filter)) {\n    return filter[0] === dataField;\n  }\n\n  return filter.some(function (item) {\n    return (isCondition(item) || isGroup(item)) && filterHasField(item, dataField);\n  });\n}\n\nvar renderValueText = function ($container, value, customOperation) {\n  if (Array.isArray(value)) {\n    var lastItemIndex = value.length - 1;\n    $container.empty();\n    value.forEach(function (t, i) {\n      (0, _renderer.default)(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_PART_CLASS).text(t).appendTo($container);\n\n      if (i !== lastItemIndex) {\n        (0, _renderer.default)(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS).text(customOperation && customOperation.valueSeparator ? customOperation.valueSeparator : \"|\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS).appendTo($container);\n      }\n    });\n  } else {\n    if (value) {\n      $container.text(value);\n    } else {\n      $container.text(_message.default.format(\"dxFilterBuilder-enterValueText\"));\n    }\n  }\n};\n\nexports.renderValueText = renderValueText;","map":{"version":3,"sources":["C:/Users/CapiniaC/Desktop/Collection/Work/project/security/node_modules/devextreme/ui/filter_builder/utils.js"],"names":["exports","getGroupCriteria","setGroupValue","getGroupMenuItem","getGroupValue","getFilterOperations","getCaptionByOperation","getOperationFromAvailable","getCustomOperation","getAvailableOperations","getDefaultOperation","createCondition","removeItem","createEmptyGroup","isEmptyGroup","addItem","getField","isGroup","isCondition","convertToInnerStructure","getNormalizedFields","getFilterExpression","getNormalizedFilter","getCurrentLookupValueText","getCurrentValueText","getItems","getCaptionWithParents","updateConditionByOperation","getOperationValue","isValidCondition","getMergedOperations","removeFieldConditionsFromFilter","syncFilters","getMatchedConditions","filterHasField","renderValueText","_renderer","_interopRequireDefault","require","_deferred","_errors","_type","_data","_ui","_filtering","_format_helper","_extend","_inflector","_between","_message","_data_source","_ui2","obj","__esModule","DEFAULT_DATA_TYPE","EMPTY_MENU_ICON","AND_GROUP_OPERATION","EQUAL_OPERATION","NOT_EQUAL_OPERATION","DATATYPE_OPERATIONS","number","string","date","datetime","object","DEFAULT_FORMAT","LOOKUP_OPERATIONS","AVAILABLE_FIELD_PROPERTIES","FILTER_BUILDER_CLASS","FILTER_BUILDER_ITEM_TEXT_CLASS","FILTER_BUILDER_ITEM_TEXT_PART_CLASS","FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS","FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS","getFormattedValueText","field","value","fieldFormat","format","dataType","default","isNegationGroup","group","length","setGroupCriteria","criteria","convertGroupToNewStructure","isNegationValue","indexOf","convertGroupToNegationGroup","slice","push","convertNegationGroupToGroup","apply","i","getNormalizedGroupValue","substring","changeCriteriaValue","Array","isArray","availableGroups","groupValue","filter","item","getCriteriaOperation","errors","Error","getDefaultFilterOperations","lookup","containItems","entity","result","filterOperations","extend","operation","filterOperationDescriptions","operationName","getNameByFilterOperation","availableOperations","customOperations","name","filteredOperations","isLookupField","forEach","customOperation","dataTypes","isOperationForbidden","notForLookup","map","icon","text","caption","captionize","isCustom","getIconByFilterOperation","defaultFilterOperation","condition","dataField","filterOperation","index","splice","toLowerCase","hasConditions","some","unshift","fields","extendedFields","convertToInnerGroup","groupOperation","innerGroup","convertToInnerCondition","conditionHasCustomOperation","reduce","isDefined","normalizedField","key","defaultCalculateFilterExpression","trueText","falseText","getConditionFilterExpression","target","filterExpression","calculateFilterExpression","createFilterExpression","_filterExpression","itemsForRemove","normalizedGroupValue","handler","items","calculateCellValue","lookupDataSource","isFunction","dataSource","DataSource","loadSingle","valueExpr","done","displayExpr","compileGetter","fail","getPrimitiveValueText","valueText","customizeText","call","getArrayValueText","v","checkDefaultValue","arguments","Deferred","when","_len","args","_key","resolve","itemExists","plainItems","parentId","pushItemAndCheckParent","originalItems","hasParent","getParentIdFromItemDataField","id","generateCaptionByDataField","allowHierarchicalFields","lastIndexOf","split","arr","hasValue","betweenCaption","context","betweenIndex","getConfig","isMatchedCondition","addedFilterDataField","hasMatchedCondition","syncConditionIntoGroup","addedFilter","canPush","$container","lastItemIndex","empty","t","addClass","appendTo","valueSeparator"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/filter_builder/utils.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.getGroupCriteria = getGroupCriteria;\r\nexports.setGroupValue = setGroupValue;\r\nexports.getGroupMenuItem = getGroupMenuItem;\r\nexports.getGroupValue = getGroupValue;\r\nexports.getFilterOperations = getFilterOperations;\r\nexports.getCaptionByOperation = getCaptionByOperation;\r\nexports.getOperationFromAvailable = getOperationFromAvailable;\r\nexports.getCustomOperation = getCustomOperation;\r\nexports.getAvailableOperations = getAvailableOperations;\r\nexports.getDefaultOperation = getDefaultOperation;\r\nexports.createCondition = createCondition;\r\nexports.removeItem = removeItem;\r\nexports.createEmptyGroup = createEmptyGroup;\r\nexports.isEmptyGroup = isEmptyGroup;\r\nexports.addItem = addItem;\r\nexports.getField = getField;\r\nexports.isGroup = isGroup;\r\nexports.isCondition = isCondition;\r\nexports.convertToInnerStructure = convertToInnerStructure;\r\nexports.getNormalizedFields = getNormalizedFields;\r\nexports.getFilterExpression = getFilterExpression;\r\nexports.getNormalizedFilter = getNormalizedFilter;\r\nexports.getCurrentLookupValueText = getCurrentLookupValueText;\r\nexports.getCurrentValueText = getCurrentValueText;\r\nexports.getItems = getItems;\r\nexports.getCaptionWithParents = getCaptionWithParents;\r\nexports.updateConditionByOperation = updateConditionByOperation;\r\nexports.getOperationValue = getOperationValue;\r\nexports.isValidCondition = isValidCondition;\r\nexports.getMergedOperations = getMergedOperations;\r\nexports.removeFieldConditionsFromFilter = removeFieldConditionsFromFilter;\r\nexports.syncFilters = syncFilters;\r\nexports.getMatchedConditions = getMatchedConditions;\r\nexports.filterHasField = filterHasField;\r\nexports.renderValueText = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _errors = _interopRequireDefault(require(\"../../data/errors\"));\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\r\nvar _filtering = _interopRequireDefault(require(\"../shared/filtering\"));\r\nvar _format_helper = _interopRequireDefault(require(\"../../format_helper\"));\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _inflector = require(\"../../core/utils/inflector\");\r\nvar _between = require(\"./between\");\r\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _ui2 = _interopRequireDefault(require(\"./ui.filter_operations_dictionary\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DEFAULT_DATA_TYPE = \"string\";\r\nvar EMPTY_MENU_ICON = \"icon-none\";\r\nvar AND_GROUP_OPERATION = \"and\";\r\nvar EQUAL_OPERATION = \"=\";\r\nvar NOT_EQUAL_OPERATION = \"<>\";\r\nvar DATATYPE_OPERATIONS = {\r\n    number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\", \"isblank\", \"isnotblank\"],\r\n    date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    \"boolean\": [\"=\", \"<>\", \"isblank\", \"isnotblank\"],\r\n    object: [\"isblank\", \"isnotblank\"]\r\n};\r\nvar DEFAULT_FORMAT = {\r\n    date: \"shortDate\",\r\n    datetime: \"shortDateShortTime\"\r\n};\r\nvar LOOKUP_OPERATIONS = [\"=\", \"<>\", \"isblank\", \"isnotblank\"];\r\nvar AVAILABLE_FIELD_PROPERTIES = [\"caption\", \"customizeText\", \"dataField\", \"dataType\", \"editorTemplate\", \"falseText\", \"editorOptions\", \"filterOperations\", \"format\", \"lookup\", \"trueText\", \"calculateFilterExpression\", \"name\"];\r\nvar FILTER_BUILDER_CLASS = \"dx-filterbuilder\";\r\nvar FILTER_BUILDER_ITEM_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-text\";\r\nvar FILTER_BUILDER_ITEM_TEXT_PART_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-part\";\r\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-separator\";\r\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS = FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS + \"-empty\";\r\n\r\nfunction getFormattedValueText(field, value) {\r\n    var fieldFormat = field.format || DEFAULT_FORMAT[field.dataType];\r\n    return _format_helper.default.format(value, fieldFormat)\r\n}\r\n\r\nfunction isNegationGroup(group) {\r\n    return group && group.length > 1 && \"!\" === group[0] && !isCondition(group)\r\n}\r\n\r\nfunction getGroupCriteria(group) {\r\n    return isNegationGroup(group) ? group[1] : group\r\n}\r\n\r\nfunction setGroupCriteria(group, criteria) {\r\n    if (isNegationGroup(group)) {\r\n        group[1] = criteria\r\n    } else {\r\n        group = criteria\r\n    }\r\n    return group\r\n}\r\n\r\nfunction convertGroupToNewStructure(group, value) {\r\n    var isNegationValue = function(value) {\r\n        return value.indexOf(\"!\") !== -1\r\n    };\r\n    var convertGroupToNegationGroup = function(group) {\r\n        var criteria = group.slice(0);\r\n        group.length = 0;\r\n        group.push(\"!\", criteria)\r\n    };\r\n    var convertNegationGroupToGroup = function(group) {\r\n        var criteria = getGroupCriteria(group);\r\n        group.length = 0;\r\n        [].push.apply(group, criteria)\r\n    };\r\n    if (isNegationValue(value)) {\r\n        if (!isNegationGroup(group)) {\r\n            convertGroupToNegationGroup(group)\r\n        }\r\n    } else {\r\n        if (isNegationGroup(group)) {\r\n            convertNegationGroupToGroup(group)\r\n        }\r\n    }\r\n}\r\n\r\nfunction setGroupValue(group, value) {\r\n    convertGroupToNewStructure(group, value);\r\n    var criteria = getGroupCriteria(group);\r\n    var i;\r\n    var getNormalizedGroupValue = function(value) {\r\n        return value.indexOf(\"!\") === -1 ? value : value.substring(1)\r\n    };\r\n    var changeCriteriaValue = function(criteria, value) {\r\n        for (i = 0; i < criteria.length; i++) {\r\n            if (!Array.isArray(criteria[i])) {\r\n                criteria[i] = value\r\n            }\r\n        }\r\n    };\r\n    value = getNormalizedGroupValue(value);\r\n    changeCriteriaValue(criteria, value);\r\n    return group\r\n}\r\n\r\nfunction getGroupMenuItem(group, availableGroups) {\r\n    var groupValue = getGroupValue(group);\r\n    return availableGroups.filter(function(item) {\r\n        return item.value === groupValue\r\n    })[0]\r\n}\r\n\r\nfunction getCriteriaOperation(criteria) {\r\n    if (isCondition(criteria)) {\r\n        return AND_GROUP_OPERATION\r\n    }\r\n    var value = \"\";\r\n    for (var i = 0; i < criteria.length; i++) {\r\n        var item = criteria[i];\r\n        if (!Array.isArray(item)) {\r\n            if (value && value !== item) {\r\n                throw new _errors.default.errors.Error(\"E4019\")\r\n            }\r\n            if (\"!\" !== item) {\r\n                value = item\r\n            }\r\n        }\r\n    }\r\n    return value\r\n}\r\n\r\nfunction getGroupValue(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var value = getCriteriaOperation(criteria);\r\n    if (!value) {\r\n        value = AND_GROUP_OPERATION\r\n    }\r\n    if (criteria !== group) {\r\n        value = \"!\" + value\r\n    }\r\n    return value\r\n}\r\n\r\nfunction getDefaultFilterOperations(field) {\r\n    return field.lookup && LOOKUP_OPERATIONS || DATATYPE_OPERATIONS[field.dataType || DEFAULT_DATA_TYPE]\r\n}\r\n\r\nfunction containItems(entity) {\r\n    return Array.isArray(entity) && entity.length\r\n}\r\n\r\nfunction getFilterOperations(field) {\r\n    var result = containItems(field.filterOperations) ? field.filterOperations : getDefaultFilterOperations(field);\r\n    return (0, _extend.extend)([], result)\r\n}\r\n\r\nfunction getCaptionByOperation(operation, filterOperationDescriptions) {\r\n    var operationName = _ui2.default.getNameByFilterOperation(operation);\r\n    return filterOperationDescriptions && filterOperationDescriptions[operationName] ? filterOperationDescriptions[operationName] : operationName\r\n}\r\n\r\nfunction getOperationFromAvailable(operation, availableOperations) {\r\n    for (var i = 0; i < availableOperations.length; i++) {\r\n        if (availableOperations[i].value === operation) {\r\n            return availableOperations[i]\r\n        }\r\n    }\r\n    throw new _ui.default.Error(\"E1048\", operation)\r\n}\r\n\r\nfunction getCustomOperation(customOperations, name) {\r\n    var filteredOperations = customOperations.filter(function(item) {\r\n        return item.name === name\r\n    });\r\n    return filteredOperations.length ? filteredOperations[0] : null\r\n}\r\n\r\nfunction getAvailableOperations(field, filterOperationDescriptions, customOperations) {\r\n    var filterOperations = getFilterOperations(field);\r\n    var isLookupField = !!field.lookup;\r\n    customOperations.forEach(function(customOperation) {\r\n        if (!field.filterOperations && filterOperations.indexOf(customOperation.name) === -1) {\r\n            var dataTypes = customOperation && customOperation.dataTypes;\r\n            var isOperationForbidden = isLookupField ? !!customOperation.notForLookup : false;\r\n            if (!isOperationForbidden && dataTypes && dataTypes.indexOf(field.dataType || DEFAULT_DATA_TYPE) >= 0) {\r\n                filterOperations.push(customOperation.name)\r\n            }\r\n        }\r\n    });\r\n    return filterOperations.map(function(operation) {\r\n        var customOperation = getCustomOperation(customOperations, operation);\r\n        if (customOperation) {\r\n            return {\r\n                icon: customOperation.icon || EMPTY_MENU_ICON,\r\n                text: customOperation.caption || (0, _inflector.captionize)(customOperation.name),\r\n                value: customOperation.name,\r\n                isCustom: true\r\n            }\r\n        } else {\r\n            return {\r\n                icon: _ui2.default.getIconByFilterOperation(operation) || EMPTY_MENU_ICON,\r\n                text: getCaptionByOperation(operation, filterOperationDescriptions),\r\n                value: operation\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nfunction getDefaultOperation(field) {\r\n    return field.defaultFilterOperation || getFilterOperations(field)[0]\r\n}\r\n\r\nfunction createCondition(field, customOperations) {\r\n    var condition = [field.dataField, \"\", \"\"];\r\n    var filterOperation = getDefaultOperation(field);\r\n    updateConditionByOperation(condition, filterOperation, customOperations);\r\n    return condition\r\n}\r\n\r\nfunction removeItem(group, item) {\r\n    var criteria = getGroupCriteria(group);\r\n    var index = criteria.indexOf(item);\r\n    criteria.splice(index, 1);\r\n    if (1 !== criteria.length) {\r\n        criteria.splice(index, 1)\r\n    }\r\n    return group\r\n}\r\n\r\nfunction createEmptyGroup(value) {\r\n    return value.indexOf(\"not\") !== -1 ? [\"!\", [value.substring(3).toLowerCase()]] : [value]\r\n}\r\n\r\nfunction isEmptyGroup(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    if (isCondition(criteria)) {\r\n        return false\r\n    }\r\n    var hasConditions = criteria.some(function(item) {\r\n        return isCondition(item)\r\n    });\r\n    return !hasConditions\r\n}\r\n\r\nfunction addItem(item, group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var groupValue = getGroupValue(criteria);\r\n    1 === criteria.length ? criteria.unshift(item) : criteria.push(item, groupValue);\r\n    return group\r\n}\r\n\r\nfunction getField(dataField, fields) {\r\n    for (var i = 0; i < fields.length; i++) {\r\n        if (fields[i].name === dataField) {\r\n            return fields[i]\r\n        }\r\n        if (fields[i].dataField.toLowerCase() === dataField.toLowerCase()) {\r\n            return fields[i]\r\n        }\r\n    }\r\n    var extendedFields = getItems(fields, true).filter(function(item) {\r\n        return item.dataField.toLowerCase() === dataField.toLowerCase()\r\n    });\r\n    if (extendedFields.length > 0) {\r\n        return extendedFields[0]\r\n    }\r\n    throw new _ui.default.Error(\"E1047\", dataField)\r\n}\r\n\r\nfunction isGroup(criteria) {\r\n    if (!Array.isArray(criteria)) {\r\n        return false\r\n    }\r\n    return criteria.length < 2 || Array.isArray(criteria[0]) || Array.isArray(criteria[1])\r\n}\r\n\r\nfunction isCondition(criteria) {\r\n    if (!Array.isArray(criteria)) {\r\n        return false\r\n    }\r\n    return criteria.length > 1 && !Array.isArray(criteria[0]) && !Array.isArray(criteria[1])\r\n}\r\n\r\nfunction convertToInnerGroup(group, customOperations) {\r\n    var groupOperation = getCriteriaOperation(group).toLowerCase() || AND_GROUP_OPERATION;\r\n    var innerGroup = [];\r\n    for (var i = 0; i < group.length; i++) {\r\n        if (isGroup(group[i])) {\r\n            innerGroup.push(convertToInnerStructure(group[i], customOperations));\r\n            innerGroup.push(groupOperation)\r\n        } else {\r\n            if (isCondition(group[i])) {\r\n                innerGroup.push(convertToInnerCondition(group[i], customOperations));\r\n                innerGroup.push(groupOperation)\r\n            }\r\n        }\r\n    }\r\n    if (0 === innerGroup.length) {\r\n        innerGroup.push(groupOperation)\r\n    }\r\n    return innerGroup\r\n}\r\n\r\nfunction conditionHasCustomOperation(condition, customOperations) {\r\n    var customOperation = getCustomOperation(customOperations, condition[1]);\r\n    return customOperation && customOperation.name === condition[1]\r\n}\r\n\r\nfunction convertToInnerCondition(condition, customOperations) {\r\n    if (conditionHasCustomOperation(condition, customOperations)) {\r\n        return condition\r\n    }\r\n    if (condition.length < 3) {\r\n        condition[2] = condition[1];\r\n        condition[1] = EQUAL_OPERATION\r\n    }\r\n    return condition\r\n}\r\n\r\nfunction convertToInnerStructure(value, customOperations) {\r\n    if (!value) {\r\n        return [AND_GROUP_OPERATION]\r\n    }\r\n    value = (0, _extend.extend)(true, [], value);\r\n    if (isCondition(value)) {\r\n        return [convertToInnerCondition(value, customOperations), AND_GROUP_OPERATION]\r\n    }\r\n    if (isNegationGroup(value)) {\r\n        return [\"!\", isCondition(value[1]) ? [convertToInnerCondition(value[1], customOperations), AND_GROUP_OPERATION] : isNegationGroup(value[1]) ? [convertToInnerStructure(value[1], customOperations), AND_GROUP_OPERATION] : convertToInnerGroup(value[1], customOperations)]\r\n    }\r\n    return convertToInnerGroup(value, customOperations)\r\n}\r\n\r\nfunction getNormalizedFields(fields) {\r\n    return fields.reduce(function(result, field) {\r\n        if ((0, _type.isDefined)(field.dataField)) {\r\n            var normalizedField = {};\r\n            for (var key in field) {\r\n                if (field[key] && AVAILABLE_FIELD_PROPERTIES.indexOf(key) > -1) {\r\n                    normalizedField[key] = field[key]\r\n                }\r\n            }\r\n            normalizedField.defaultCalculateFilterExpression = _filtering.default.defaultCalculateFilterExpression;\r\n            if (!(0, _type.isDefined)(normalizedField.dataType)) {\r\n                normalizedField.dataType = DEFAULT_DATA_TYPE\r\n            }\r\n            if (!(0, _type.isDefined)(normalizedField.trueText)) {\r\n                normalizedField.trueText = _message.default.format(\"dxDataGrid-trueText\")\r\n            }\r\n            if (!(0, _type.isDefined)(normalizedField.falseText)) {\r\n                normalizedField.falseText = _message.default.format(\"dxDataGrid-falseText\")\r\n            }\r\n            result.push(normalizedField)\r\n        }\r\n        return result\r\n    }, [])\r\n}\r\n\r\nfunction getConditionFilterExpression(condition, fields, customOperations, target) {\r\n    var field = getField(condition[0], fields);\r\n    var filterExpression = convertToInnerCondition(condition, customOperations);\r\n    var customOperation = customOperations.length && getCustomOperation(customOperations, filterExpression[1]);\r\n    if (customOperation && customOperation.calculateFilterExpression) {\r\n        return customOperation.calculateFilterExpression.apply(customOperation, [filterExpression[2], field, fields])\r\n    } else {\r\n        if (field.createFilterExpression) {\r\n            return field.createFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n        } else {\r\n            if (field.calculateFilterExpression) {\r\n                return field.calculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n            } else {\r\n                return field.defaultCalculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getFilterExpression(value, fields, customOperations, target) {\r\n    if (!(0, _type.isDefined)(value)) {\r\n        return null\r\n    }\r\n    if (isNegationGroup(value)) {\r\n        var filterExpression = getFilterExpression(value[1], fields, customOperations, target);\r\n        return [\"!\", filterExpression]\r\n    }\r\n    var criteria = getGroupCriteria(value);\r\n    if (isCondition(criteria)) {\r\n        return getConditionFilterExpression(criteria, fields, customOperations, target) || null\r\n    } else {\r\n        var result = [];\r\n        var _filterExpression;\r\n        var groupValue = getGroupValue(criteria);\r\n        for (var i = 0; i < criteria.length; i++) {\r\n            if (isGroup(criteria[i])) {\r\n                _filterExpression = getFilterExpression(criteria[i], fields, customOperations, target);\r\n                if (_filterExpression) {\r\n                    i && result.push(groupValue);\r\n                    result.push(_filterExpression)\r\n                }\r\n            } else {\r\n                if (isCondition(criteria[i])) {\r\n                    _filterExpression = getConditionFilterExpression(criteria[i], fields, customOperations, target);\r\n                    if (_filterExpression) {\r\n                        result.length && result.push(groupValue);\r\n                        result.push(_filterExpression)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (1 === result.length) {\r\n            result = result[0]\r\n        }\r\n        return result.length ? result : null\r\n    }\r\n}\r\n\r\nfunction getNormalizedFilter(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var i;\r\n    if (0 === criteria.length) {\r\n        return null\r\n    }\r\n    var itemsForRemove = [];\r\n    for (i = 0; i < criteria.length; i++) {\r\n        if (isGroup(criteria[i])) {\r\n            var normalizedGroupValue = getNormalizedFilter(criteria[i]);\r\n            if (normalizedGroupValue) {\r\n                criteria[i] = normalizedGroupValue\r\n            } else {\r\n                itemsForRemove.push(criteria[i])\r\n            }\r\n        } else {\r\n            if (isCondition(criteria[i])) {\r\n                if (!isValidCondition(criteria[i])) {\r\n                    itemsForRemove.push(criteria[i])\r\n                }\r\n            }\r\n        }\r\n    }\r\n    for (i = 0; i < itemsForRemove.length; i++) {\r\n        removeItem(criteria, itemsForRemove[i])\r\n    }\r\n    if (1 === criteria.length) {\r\n        return null\r\n    }\r\n    criteria.splice(criteria.length - 1, 1);\r\n    if (1 === criteria.length) {\r\n        group = setGroupCriteria(group, criteria[0])\r\n    }\r\n    if (0 === group.length) {\r\n        return null\r\n    }\r\n    return group\r\n}\r\n\r\nfunction getCurrentLookupValueText(field, value, handler) {\r\n    if (\"\" === value) {\r\n        handler(\"\");\r\n        return\r\n    }\r\n    var lookup = field.lookup;\r\n    if (lookup.items) {\r\n        handler(lookup.calculateCellValue(value) || \"\")\r\n    } else {\r\n        var lookupDataSource = (0, _type.isFunction)(lookup.dataSource) ? lookup.dataSource({}) : lookup.dataSource;\r\n        var dataSource = new _data_source.DataSource(lookupDataSource);\r\n        dataSource.loadSingle(lookup.valueExpr, value).done(function(result) {\r\n            result ? handler(lookup.displayExpr ? (0, _data.compileGetter)(lookup.displayExpr)(result) : result) : handler(\"\")\r\n        }).fail(function() {\r\n            handler(\"\")\r\n        })\r\n    }\r\n}\r\n\r\nfunction getPrimitiveValueText(field, value, customOperation, target) {\r\n    var valueText;\r\n    if (true === value) {\r\n        valueText = field.trueText || _message.default.format(\"dxDataGrid-trueText\")\r\n    } else {\r\n        if (false === value) {\r\n            valueText = field.falseText || _message.default.format(\"dxDataGrid-falseText\")\r\n        } else {\r\n            valueText = getFormattedValueText(field, value)\r\n        }\r\n    }\r\n    if (field.customizeText) {\r\n        valueText = field.customizeText.call(field, {\r\n            value: value,\r\n            valueText: valueText,\r\n            target: target\r\n        })\r\n    }\r\n    if (customOperation && customOperation.customizeText) {\r\n        valueText = customOperation.customizeText.call(customOperation, {\r\n            value: value,\r\n            valueText: valueText,\r\n            field: field,\r\n            target: target\r\n        })\r\n    }\r\n    return valueText\r\n}\r\n\r\nfunction getArrayValueText(field, value, customOperation, target) {\r\n    return value.map(function(v) {\r\n        return getPrimitiveValueText(field, v, customOperation, target)\r\n    })\r\n}\r\n\r\nfunction checkDefaultValue(value) {\r\n    return \"\" === value || null === value\r\n}\r\n\r\nfunction getCurrentValueText(field, value, customOperation) {\r\n    var target = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : \"filterBuilder\";\r\n    if (checkDefaultValue(value)) {\r\n        return \"\"\r\n    }\r\n    if (Array.isArray(value)) {\r\n        var result = new _deferred.Deferred;\r\n        _deferred.when.apply(this, getArrayValueText(field, value, customOperation, target)).done(function() {\r\n            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\r\n                args[_key] = arguments[_key]\r\n            }\r\n            var text = args.some(function(item) {\r\n                return !checkDefaultValue(item)\r\n            }) ? args.map(function(item) {\r\n                return !checkDefaultValue(item) ? item : \"?\"\r\n            }) : \"\";\r\n            result.resolve(text)\r\n        });\r\n        return result\r\n    } else {\r\n        return getPrimitiveValueText(field, value, customOperation, target)\r\n    }\r\n}\r\n\r\nfunction itemExists(plainItems, parentId) {\r\n    return plainItems.some(function(item) {\r\n        return item.dataField === parentId\r\n    })\r\n}\r\n\r\nfunction pushItemAndCheckParent(originalItems, plainItems, item) {\r\n    var dataField = item.dataField;\r\n    if (hasParent(dataField)) {\r\n        item.parentId = getParentIdFromItemDataField(dataField);\r\n        if (!itemExists(plainItems, item.parentId) && !itemExists(originalItems, item.parentId)) {\r\n            pushItemAndCheckParent(originalItems, plainItems, {\r\n                id: item.parentId,\r\n                dataType: \"object\",\r\n                dataField: item.parentId,\r\n                caption: generateCaptionByDataField(item.parentId, true),\r\n                filterOperations: [\"isblank\", \"isnotblank\"]\r\n            })\r\n        }\r\n    }\r\n    plainItems.push(item)\r\n}\r\n\r\nfunction generateCaptionByDataField(dataField, allowHierarchicalFields) {\r\n    var caption = \"\";\r\n    if (allowHierarchicalFields) {\r\n        dataField = dataField.substring(dataField.lastIndexOf(\".\") + 1)\r\n    } else {\r\n        if (hasParent(dataField)) {\r\n            dataField.split(\".\").forEach(function(field, index, arr) {\r\n                caption += (0, _inflector.captionize)(field);\r\n                if (index !== arr.length - 1) {\r\n                    caption += \".\"\r\n                }\r\n            });\r\n            return caption\r\n        }\r\n    }\r\n    return (0, _inflector.captionize)(dataField)\r\n}\r\n\r\nfunction getItems(fields, allowHierarchicalFields) {\r\n    var items = [];\r\n    for (var i = 0; i < fields.length; i++) {\r\n        var item = (0, _extend.extend)(true, {\r\n            caption: generateCaptionByDataField(fields[i].dataField, allowHierarchicalFields)\r\n        }, fields[i]);\r\n        item.id = item.name || item.dataField;\r\n        if (allowHierarchicalFields) {\r\n            pushItemAndCheckParent(fields, items, item)\r\n        } else {\r\n            items.push(item)\r\n        }\r\n    }\r\n    return items\r\n}\r\n\r\nfunction hasParent(dataField) {\r\n    return dataField.lastIndexOf(\".\") !== -1\r\n}\r\n\r\nfunction getParentIdFromItemDataField(dataField) {\r\n    return dataField.substring(0, dataField.lastIndexOf(\".\"))\r\n}\r\n\r\nfunction getCaptionWithParents(item, plainItems) {\r\n    if (hasParent(item.dataField)) {\r\n        var parentId = getParentIdFromItemDataField(item.dataField);\r\n        for (var i = 0; i < plainItems.length; i++) {\r\n            if (plainItems[i].dataField === parentId) {\r\n                return getCaptionWithParents(plainItems[i], plainItems) + \".\" + item.caption\r\n            }\r\n        }\r\n    }\r\n    return item.caption\r\n}\r\n\r\nfunction updateConditionByOperation(condition, operation, customOperations) {\r\n    var customOperation = getCustomOperation(customOperations, operation);\r\n    if (customOperation) {\r\n        if (false === customOperation.hasValue) {\r\n            condition[1] = operation;\r\n            condition.length = 2\r\n        } else {\r\n            condition[1] = operation;\r\n            condition[2] = \"\"\r\n        }\r\n        return condition\r\n    }\r\n    if (\"isblank\" === operation) {\r\n        condition[1] = EQUAL_OPERATION;\r\n        condition[2] = null\r\n    } else {\r\n        if (\"isnotblank\" === operation) {\r\n            condition[1] = NOT_EQUAL_OPERATION;\r\n            condition[2] = null\r\n        } else {\r\n            customOperation = getCustomOperation(customOperations, condition[1]);\r\n            if (customOperation || 2 === condition.length || null === condition[2]) {\r\n                condition[2] = \"\"\r\n            }\r\n            condition[1] = operation\r\n        }\r\n    }\r\n    return condition\r\n}\r\n\r\nfunction getOperationValue(condition) {\r\n    var caption;\r\n    if (null === condition[2]) {\r\n        if (condition[1] === EQUAL_OPERATION) {\r\n            caption = \"isblank\"\r\n        } else {\r\n            caption = \"isnotblank\"\r\n        }\r\n    } else {\r\n        caption = condition[1]\r\n    }\r\n    return caption\r\n}\r\n\r\nfunction isValidCondition(condition) {\r\n    return \"\" !== condition[2]\r\n}\r\n\r\nfunction getMergedOperations(customOperations, betweenCaption, context) {\r\n    var result = (0, _extend.extend)(true, [], customOperations);\r\n    var betweenIndex = -1;\r\n    result.some(function(customOperation, index) {\r\n        if (\"between\" === customOperation.name) {\r\n            betweenIndex = index;\r\n            return true\r\n        }\r\n    });\r\n    if (betweenIndex !== -1) {\r\n        result[betweenIndex] = (0, _extend.extend)((0, _between.getConfig)(betweenCaption, context), result[betweenIndex])\r\n    } else {\r\n        result.unshift((0, _between.getConfig)(betweenCaption, context))\r\n    }\r\n    return result\r\n}\r\n\r\nfunction isMatchedCondition(filter, addedFilterDataField) {\r\n    return filter[0] === addedFilterDataField\r\n}\r\n\r\nfunction removeFieldConditionsFromFilter(filter, dataField) {\r\n    if (!filter || 0 === filter.length) {\r\n        return null\r\n    }\r\n    if (isCondition(filter)) {\r\n        var hasMatchedCondition = isMatchedCondition(filter, dataField);\r\n        return !hasMatchedCondition ? filter : null\r\n    } else {\r\n        return syncConditionIntoGroup(filter, [dataField], false)\r\n    }\r\n}\r\n\r\nfunction syncConditionIntoGroup(filter, addedFilter, canPush) {\r\n    var result = [];\r\n    filter.forEach(function(item) {\r\n        if (isCondition(item)) {\r\n            if (isMatchedCondition(item, addedFilter[0])) {\r\n                if (canPush) {\r\n                    result.push(addedFilter);\r\n                    canPush = false\r\n                } else {\r\n                    result.splice(result.length - 1, 1)\r\n                }\r\n            } else {\r\n                result.push(item)\r\n            }\r\n        } else {\r\n            (result.length || isGroup(item)) && result.push(item)\r\n        }\r\n    });\r\n    if (0 === result.length) {\r\n        return null\r\n    }\r\n    if (canPush) {\r\n        result.push(AND_GROUP_OPERATION);\r\n        result.push(addedFilter)\r\n    }\r\n    return 1 === result.length ? result[0] : result\r\n}\r\n\r\nfunction syncFilters(filter, addedFilter) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return addedFilter\r\n    }\r\n    if (isCondition(filter)) {\r\n        if (isMatchedCondition(filter, addedFilter[0])) {\r\n            return addedFilter\r\n        } else {\r\n            return [filter, AND_GROUP_OPERATION, addedFilter]\r\n        }\r\n    }\r\n    var groupValue = getGroupValue(filter);\r\n    if (groupValue !== AND_GROUP_OPERATION) {\r\n        return [addedFilter, \"and\", filter]\r\n    }\r\n    return syncConditionIntoGroup(filter, addedFilter, true)\r\n}\r\n\r\nfunction getMatchedConditions(filter, dataField) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return []\r\n    }\r\n    if (isCondition(filter)) {\r\n        if (isMatchedCondition(filter, dataField)) {\r\n            return [filter]\r\n        } else {\r\n            return []\r\n        }\r\n    }\r\n    var groupValue = getGroupValue(filter);\r\n    if (groupValue !== AND_GROUP_OPERATION) {\r\n        return []\r\n    }\r\n    var result = filter.filter(function(item) {\r\n        return isCondition(item) && isMatchedCondition(item, dataField)\r\n    });\r\n    return result\r\n}\r\n\r\nfunction filterHasField(filter, dataField) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return false\r\n    }\r\n    if (isCondition(filter)) {\r\n        return filter[0] === dataField\r\n    }\r\n    return filter.some(function(item) {\r\n        return (isCondition(item) || isGroup(item)) && filterHasField(item, dataField)\r\n    })\r\n}\r\nvar renderValueText = function($container, value, customOperation) {\r\n    if (Array.isArray(value)) {\r\n        var lastItemIndex = value.length - 1;\r\n        $container.empty();\r\n        value.forEach(function(t, i) {\r\n            (0, _renderer.default)(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_PART_CLASS).text(t).appendTo($container);\r\n            if (i !== lastItemIndex) {\r\n                (0, _renderer.default)(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS).text(customOperation && customOperation.valueSeparator ? customOperation.valueSeparator : \"|\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS).appendTo($container)\r\n            }\r\n        })\r\n    } else {\r\n        if (value) {\r\n            $container.text(value)\r\n        } else {\r\n            $container.text(_message.default.format(\"dxFilterBuilder-enterValueText\"))\r\n        }\r\n    }\r\n};\r\nexports.renderValueText = renderValueText;\r\n"]},"metadata":{},"sourceType":"script"}