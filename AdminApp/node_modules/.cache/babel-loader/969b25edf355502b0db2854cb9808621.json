{"ast":null,"code":"/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.collapsed.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.GroupingHelper = void 0;\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiData_grid = _interopRequireDefault(require(\"./ui.data_grid.core\"));\n\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\n\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\n\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\n\nvar _errors = _interopRequireDefault(require(\"../../data/errors\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction getContinuationGroupCount(groupOffset, pageSize, groupSize, groupIndex) {\n  groupIndex = groupIndex || 0;\n\n  if (pageSize > 1 && groupSize > 0) {\n    var pageOffset = groupOffset - Math.floor(groupOffset / pageSize) * pageSize || pageSize;\n    pageOffset += groupSize - groupIndex - 2;\n\n    if (pageOffset < 0) {\n      pageOffset += pageSize;\n    }\n\n    return Math.floor(pageOffset / (pageSize - groupIndex - 1));\n  }\n\n  return 0;\n}\n\nvar GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function () {\n  var foreachExpandedGroups = function (that, callback, updateGroups) {\n    return that.foreachGroups(function (groupInfo, parents) {\n      if (groupInfo.isExpanded) {\n        return callback(groupInfo, parents);\n      }\n    }, true, false, updateGroups, updateGroups);\n  };\n\n  var processGroupItems = function processGroupItems(that, items, groupsCount, expandedInfo, path, isCustomLoading, isLastGroupExpanded) {\n    var isExpanded;\n    expandedInfo.items = expandedInfo.items || [];\n    expandedInfo.paths = expandedInfo.paths || [];\n    expandedInfo.count = expandedInfo.count || 0;\n    expandedInfo.lastCount = expandedInfo.lastCount || 0;\n\n    if (!groupsCount) {\n      return;\n    }\n\n    for (var i = 0; i < items.length; i++) {\n      var item = items[i];\n\n      if (void 0 !== item.items) {\n        path.push(item.key);\n\n        if (isCustomLoading) {\n          isExpanded = true;\n        } else {\n          var groupInfo = that.findGroupInfo(path);\n          isExpanded = groupInfo && groupInfo.isExpanded;\n        }\n\n        if (!isExpanded) {\n          item.collapsedItems = item.items;\n          item.items = null;\n        } else {\n          if (item.items) {\n            processGroupItems(that, item.items, groupsCount - 1, expandedInfo, path, isCustomLoading, isLastGroupExpanded);\n          } else {\n            if (1 === groupsCount && item.count && (!isCustomLoading || isLastGroupExpanded)) {\n              expandedInfo.items.push(item);\n              expandedInfo.paths.push(path.slice(0));\n              expandedInfo.count += expandedInfo.lastCount;\n              expandedInfo.lastCount = item.count;\n            }\n          }\n        }\n\n        path.pop();\n      }\n    }\n  };\n\n  var updateGroupInfoItem = function (that, item, isLastGroupLevel, path, offset) {\n    var groupInfo = that.findGroupInfo(path);\n    var count;\n\n    if (!groupInfo) {\n      if (isLastGroupLevel) {\n        count = item.count > 0 ? item.count : item.items.length;\n      }\n\n      that.addGroupInfo({\n        isExpanded: that._isGroupExpanded(path.length - 1),\n        path: path.slice(0),\n        offset: offset,\n        count: count || 0\n      });\n    } else {\n      if (isLastGroupLevel) {\n        groupInfo.count = item.count > 0 ? item.count : item.items && item.items.length || 0;\n      } else {\n        item.count = groupInfo.count || item.count;\n      }\n\n      groupInfo.offset = offset;\n    }\n  };\n\n  var updateGroupInfos = function updateGroupInfos(that, options, items, loadedGroupCount, groupIndex, path, parentIndex) {\n    var groupCount = options.group ? options.group.length : 0;\n    var isLastGroupLevel = groupCount === loadedGroupCount;\n    var remotePaging = options.remoteOperations.paging;\n    var offset = 0;\n    var totalCount = 0;\n    var count;\n    groupIndex = groupIndex || 0;\n    path = path || [];\n\n    if (remotePaging && !parentIndex) {\n      offset = 0 === groupIndex ? options.skip || 0 : options.skips[groupIndex - 1] || 0;\n    }\n\n    if (groupIndex >= loadedGroupCount) {\n      return items.length;\n    }\n\n    for (var i = 0; i < items.length; i++) {\n      var item = items[i];\n\n      if (item) {\n        path.push(item.key);\n\n        if (!item.count && !item.items || void 0 === item.items) {\n          return -1;\n        }\n\n        updateGroupInfoItem(that, item, isLastGroupLevel, path, offset + i);\n        count = item.items ? updateGroupInfos(that, options, item.items, loadedGroupCount, groupIndex + 1, path, i) : item.count || -1;\n\n        if (count < 0) {\n          return -1;\n        }\n\n        totalCount += count;\n        path.pop();\n      }\n    }\n\n    return totalCount;\n  };\n\n  var isGroupExpanded = function (groups, groupIndex) {\n    return groups && groups.length && groups[groupIndex] && !!groups[groupIndex].isExpanded;\n  };\n\n  var getTotalOffset = function (groupInfos, pageSize, offset) {\n    var groupSize;\n    var totalOffset = offset;\n\n    for (var groupIndex = 0; groupIndex < groupInfos.length; groupIndex++) {\n      groupSize = groupInfos[groupIndex].offset + 1;\n\n      if (groupIndex > 0) {\n        groupSize += groupInfos[groupIndex - 1].childrenTotalCount;\n\n        if (pageSize) {\n          groupSize += getContinuationGroupCount(totalOffset, pageSize, groupSize, groupIndex - 1) * groupIndex;\n        }\n      }\n\n      totalOffset += groupSize;\n    }\n\n    return totalOffset;\n  };\n\n  function applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex) {\n    var item = expandedInfo.items[expandedItemIndex];\n    var skip = options.skips && options.skips[groupLevel];\n    var take = options.takes && options.takes[groupLevel];\n    var isLastExpandedItem = expandedItemIndex === expandedInfo.items.length - 1;\n    var isFirstExpandedItem = 0 === expandedItemIndex;\n    var lastExpandedItemSkip = isFirstExpandedItem && skip || 0;\n    var isItemsTruncatedByTake = item.count > take + lastExpandedItemSkip;\n\n    if (isFirstExpandedItem && void 0 !== skip) {\n      item.isContinuation = true;\n    }\n\n    if (isLastExpandedItem && void 0 !== take && isItemsTruncatedByTake) {\n      item.isContinuationOnNextPage = true;\n    }\n  }\n\n  function fillSkipTakeInExpandedInfo(options, expandedInfo, currentGroupCount) {\n    var currentGroupIndex = currentGroupCount - 1;\n    var groupCount = options.group ? options.group.length : 0;\n    expandedInfo.skip = options.skips && options.skips[currentGroupIndex];\n\n    if (options.takes && void 0 !== options.takes[currentGroupIndex]) {\n      if (groupCount === currentGroupCount) {\n        expandedInfo.take = expandedInfo.count ? expandedInfo.count - (expandedInfo.skip || 0) : 0;\n      } else {\n        expandedInfo.take = 0;\n      }\n\n      expandedInfo.take += options.takes[currentGroupIndex];\n    }\n  }\n\n  function isDataDeferred(data) {\n    return !Array.isArray(data);\n  }\n\n  function makeDataDeferred(options) {\n    if (!isDataDeferred(options.data)) {\n      options.data = new _deferred.Deferred();\n    }\n  }\n\n  function loadGroupItems(that, options, loadedGroupCount, expandedInfo, groupLevel, data) {\n    if (!options.isCustomLoading) {\n      expandedInfo = {};\n      processGroupItems(that, data, loadedGroupCount, expandedInfo, []);\n      fillSkipTakeInExpandedInfo(options, expandedInfo, loadedGroupCount);\n    }\n\n    var groupCount = options.group ? options.group.length : 0;\n\n    if (expandedInfo.paths.length && groupCount - loadedGroupCount > 0) {\n      makeDataDeferred(options);\n      loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data);\n    } else {\n      if (expandedInfo.paths.length && options.storeLoadOptions.group) {\n        makeDataDeferred(options);\n        loadLastLevelGroupItems(that, options, expandedInfo, data);\n      } else {\n        if (isDataDeferred(options.data)) {\n          options.data.resolve(data);\n        }\n      }\n    }\n  }\n\n  function loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data) {\n    var groups = options.group || [];\n    var currentGroup = groups[groupLevel + 1];\n    var deferreds = [];\n    (0, _iterator.each)(expandedInfo.paths, function (expandedItemIndex) {\n      var loadOptions = {\n        requireTotalCount: false,\n        requireGroupCount: true,\n        group: [currentGroup],\n        groupSummary: options.storeLoadOptions.groupSummary,\n        filter: (0, _uiData_grid2.createGroupFilter)(expandedInfo.paths[expandedItemIndex], {\n          filter: options.storeLoadOptions.filter,\n          group: groups\n        }),\n        select: options.storeLoadOptions.select\n      };\n\n      if (0 === expandedItemIndex) {\n        loadOptions.skip = expandedInfo.skip || 0;\n      }\n\n      if (expandedItemIndex === expandedInfo.paths.length - 1) {\n        loadOptions.take = expandedInfo.take;\n      }\n\n      var loadResult = 0 === loadOptions.take ? [] : that._dataSource.loadFromStore(loadOptions);\n      (0, _deferred.when)(loadResult).done(function (data) {\n        var item = expandedInfo.items[expandedItemIndex];\n        applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex);\n        item.items = data;\n      });\n      deferreds.push(loadResult);\n    });\n\n    _deferred.when.apply(null, deferreds).done(function () {\n      updateGroupInfos(that, options, data, loadedGroupCount + 1);\n      loadGroupItems(that, options, loadedGroupCount + 1, expandedInfo, groupLevel + 1, data);\n    });\n  }\n\n  function loadLastLevelGroupItems(that, options, expandedInfo, data) {\n    var expandedFilters = [];\n    var groups = options.group || [];\n    (0, _iterator.each)(expandedInfo.paths, function (_, expandedPath) {\n      expandedFilters.push((0, _uiData_grid2.createGroupFilter)(expandedPath, {\n        group: options.isCustomLoading ? options.storeLoadOptions.group : groups\n      }));\n    });\n    var filter = options.storeLoadOptions.filter;\n\n    if (!options.storeLoadOptions.isLoadingAll) {\n      filter = _uiData_grid.default.combineFilters([filter, _uiData_grid.default.combineFilters(expandedFilters, \"or\")]);\n    }\n\n    var loadOptions = (0, _extend.extend)({}, options.storeLoadOptions, {\n      requireTotalCount: false,\n      requireGroupCount: false,\n      group: null,\n      sort: groups.concat(_uiData_grid.default.normalizeSortingInfo(options.storeLoadOptions.sort || [])),\n      filter: filter\n    });\n\n    var isPagingLocal = that._dataSource.isLastLevelGroupItemsPagingLocal();\n\n    if (!isPagingLocal) {\n      loadOptions.skip = expandedInfo.skip;\n      loadOptions.take = expandedInfo.take;\n    }\n\n    (0, _deferred.when)(0 === expandedInfo.take ? [] : that._dataSource.loadFromStore(loadOptions)).done(function (items, extra) {\n      if (isPagingLocal) {\n        items = that._dataSource.sortLastLevelGroupItems(items, groups, expandedInfo.paths);\n        items = expandedInfo.skip ? items.slice(expandedInfo.skip) : items;\n        items = expandedInfo.take ? items.slice(0, expandedInfo.take) : items;\n      }\n\n      (0, _iterator.each)(expandedInfo.items, function (index, item) {\n        var itemCount = item.count - (0 === index && expandedInfo.skip || 0);\n        var expandedItems = items.splice(0, itemCount);\n        applyContinuationToGroupItem(options, expandedInfo, groups.length - 1, index);\n        item.items = expandedItems;\n      });\n      options.data.resolve(data);\n    }).fail(options.data.reject);\n  }\n\n  var loadGroupTotalCount = function (dataSource, options) {\n    var d = new _deferred.Deferred();\n    var isGrouping = !!(options.group && options.group.length);\n    var loadOptions = (0, _extend.extend)({\n      skip: 0,\n      take: 1,\n      requireGroupCount: isGrouping,\n      requireTotalCount: !isGrouping\n    }, options, {\n      group: isGrouping ? options.group : null\n    });\n    dataSource.load(loadOptions).done(function (data, extra) {\n      var count = extra && (isGrouping ? extra.groupCount : extra.totalCount);\n\n      if (!isFinite(count)) {\n        d.reject(_errors.default.errors.Error(isGrouping ? \"E4022\" : \"E4021\"));\n        return;\n      }\n\n      d.resolve(count);\n    }).fail(d.reject.bind(d));\n    return d;\n  };\n\n  return {\n    updateTotalItemsCount: function (options) {\n      var totalItemsCount = 0;\n      var totalCount = options.extra && options.extra.totalCount || 0;\n      var groupCount = options.extra && options.extra.groupCount || 0;\n\n      var pageSize = this._dataSource.pageSize();\n\n      var isVirtualPaging = this._isVirtualPaging();\n\n      foreachExpandedGroups(this, function (groupInfo) {\n        groupInfo.childrenTotalCount = 0;\n      });\n      foreachExpandedGroups(this, function (groupInfo, parents) {\n        var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, totalItemsCount);\n        var count = groupInfo.count + groupInfo.childrenTotalCount;\n\n        if (!isVirtualPaging) {\n          count += getContinuationGroupCount(totalOffset, pageSize, count, parents.length - 1);\n        }\n\n        if (parents[parents.length - 2]) {\n          parents[parents.length - 2].childrenTotalCount += count;\n        } else {\n          totalItemsCount += count;\n        }\n      });\n      this.callBase(totalItemsCount - totalCount + groupCount);\n    },\n    _isGroupExpanded: function (groupIndex) {\n      var groups = this._dataSource.group();\n\n      return isGroupExpanded(groups, groupIndex);\n    },\n    _updatePagingOptions: function (options, callback) {\n      var that = this;\n\n      var isVirtualPaging = that._isVirtualPaging();\n\n      var pageSize = that._dataSource.pageSize();\n\n      var skips = [];\n      var takes = [];\n      var skipChildrenTotalCount = 0;\n      var childrenTotalCount = 0;\n\n      if (options.take) {\n        foreachExpandedGroups(this, function (groupInfo) {\n          groupInfo.childrenTotalCount = 0;\n          groupInfo.skipChildrenTotalCount = 0;\n        });\n        foreachExpandedGroups(that, function (groupInfo, parents) {\n          var take;\n          var takeCorrection = 0;\n          var parentTakeCorrection = 0;\n          var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, childrenTotalCount);\n          var continuationGroupCount = 0;\n          var skipContinuationGroupCount = 0;\n          var groupInfoCount = groupInfo.count + groupInfo.childrenTotalCount;\n          var childrenGroupInfoCount = groupInfoCount;\n          callback && callback(groupInfo, totalOffset);\n          var skip = options.skip - totalOffset;\n\n          if (totalOffset <= options.skip + options.take && groupInfoCount) {\n            take = options.take;\n\n            if (!isVirtualPaging) {\n              continuationGroupCount = getContinuationGroupCount(totalOffset, pageSize, groupInfoCount, parents.length - 1);\n              groupInfoCount += continuationGroupCount * parents.length;\n              childrenGroupInfoCount += continuationGroupCount;\n\n              if (pageSize && skip >= 0) {\n                takeCorrection = parents.length;\n                parentTakeCorrection = parents.length - 1;\n                skipContinuationGroupCount = Math.floor(skip / pageSize);\n              }\n            }\n\n            if (skip >= 0) {\n              if (totalOffset + groupInfoCount > options.skip) {\n                skips.unshift(skip - skipContinuationGroupCount * takeCorrection - groupInfo.skipChildrenTotalCount);\n              }\n\n              if (totalOffset + groupInfoCount >= options.skip + take) {\n                takes.unshift(take - takeCorrection - groupInfo.childrenTotalCount + groupInfo.skipChildrenTotalCount);\n              }\n            } else {\n              if (totalOffset + groupInfoCount >= options.skip + take) {\n                takes.unshift(take + skip - groupInfo.childrenTotalCount);\n              }\n            }\n          }\n\n          if (totalOffset <= options.skip) {\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1 - skipContinuationGroupCount * parentTakeCorrection);\n            } else {\n              skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1);\n            }\n          }\n\n          if (totalOffset <= options.skip + take) {\n            groupInfoCount = Math.min(childrenGroupInfoCount, skip + take - (skipContinuationGroupCount + 1) * parentTakeCorrection);\n\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].childrenTotalCount += groupInfoCount;\n            } else {\n              childrenTotalCount += groupInfoCount;\n            }\n          }\n        });\n        options.skip -= skipChildrenTotalCount;\n        options.take -= childrenTotalCount - skipChildrenTotalCount;\n      }\n\n      options.skips = skips;\n      options.takes = takes;\n    },\n    changeRowExpand: function (path) {\n      var that = this;\n      var groupInfo = that.findGroupInfo(path);\n      var dataSource = that._dataSource;\n      var remoteGroupPaging = dataSource.remoteOperations().groupPaging;\n\n      var groups = _uiData_grid.default.normalizeSortingInfo(dataSource.group());\n\n      if (groupInfo) {\n        groupInfo.isExpanded = !groupInfo.isExpanded;\n\n        if (remoteGroupPaging && groupInfo.isExpanded && path.length < groups.length) {\n          return loadGroupTotalCount(dataSource, {\n            filter: (0, _uiData_grid2.createGroupFilter)(path, {\n              filter: dataSource.lastLoadOptions().filter,\n              group: dataSource.group()\n            }),\n            group: [groups[path.length]],\n            select: dataSource.select()\n          }).done(function (groupCount) {\n            groupInfo.count = groupCount;\n          });\n        }\n\n        return new _deferred.Deferred().resolve();\n      }\n\n      return new _deferred.Deferred().reject();\n    },\n    handleDataLoading: function (options) {\n      var that = this;\n      var storeLoadOptions = options.storeLoadOptions;\n\n      var groups = _uiData_grid.default.normalizeSortingInfo(storeLoadOptions.group || options.loadOptions.group);\n\n      if (options.isCustomLoading || !groups.length) {\n        return;\n      }\n\n      if (options.remoteOperations.grouping) {\n        var remotePaging = that._dataSource.remoteOperations().paging;\n\n        storeLoadOptions.group = _uiData_grid.default.normalizeSortingInfo(storeLoadOptions.group);\n        storeLoadOptions.group.forEach(function (group, index) {\n          var isLastGroup = index === storeLoadOptions.group.length - 1;\n          group.isExpanded = !remotePaging || !isLastGroup;\n        });\n      }\n\n      options.group = options.group || groups;\n\n      if (options.remoteOperations.paging) {\n        options.skip = storeLoadOptions.skip;\n        options.take = storeLoadOptions.take;\n        storeLoadOptions.requireGroupCount = true;\n        storeLoadOptions.group = groups.slice(0, 1);\n\n        that._updatePagingOptions(options);\n\n        storeLoadOptions.skip = options.skip;\n        storeLoadOptions.take = options.take;\n      }\n    },\n    handleDataLoadedCore: function (options, callBase) {\n      var that = this;\n\n      var loadedGroupCount = _uiData_grid.default.normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group).length;\n\n      var groupCount = options.group ? options.group.length : 0;\n      var totalCount;\n      var expandedInfo = {};\n\n      if (options.isCustomLoading) {\n        callBase(options);\n        processGroupItems(that, options.data, loadedGroupCount, expandedInfo, [], options.isCustomLoading, options.storeLoadOptions.isLoadingAll);\n      } else {\n        if (!options.remoteOperations.paging) {\n          that.foreachGroups(function (groupInfo) {\n            groupInfo.count = 0;\n          });\n        }\n\n        totalCount = updateGroupInfos(that, options, options.data, loadedGroupCount);\n\n        if (totalCount < 0) {\n          options.data = new _deferred.Deferred().reject(_ui.default.Error(\"E1037\"));\n          return;\n        }\n\n        if (!options.remoteOperations.paging) {\n          if (loadedGroupCount && options.extra && options.loadOptions.requireTotalCount) {\n            options.extra.totalCount = totalCount;\n            options.extra.groupCount = options.data.length;\n          }\n        }\n\n        if (groupCount && options.storeLoadOptions.requireGroupCount && !isFinite(options.extra.groupCount)) {\n          options.data = new _deferred.Deferred().reject(_errors.default.errors.Error(\"E4022\"));\n          return;\n        }\n\n        that.updateTotalItemsCount(options);\n\n        if (!options.remoteOperations.paging) {\n          that._updatePagingOptions(options);\n        }\n\n        callBase(options);\n\n        if (!options.remoteOperations.paging) {\n          that._processPaging(options, loadedGroupCount);\n        }\n      }\n\n      loadGroupItems(that, options, loadedGroupCount, expandedInfo, 0, options.data);\n    },\n    _processSkips: function (items, skips, groupCount) {\n      if (!groupCount) {\n        return;\n      }\n\n      var firstItem = items[0];\n      var skip = skips[0];\n      var children = firstItem && firstItem.items;\n\n      if (void 0 !== skip) {\n        firstItem.isContinuation = true;\n\n        if (children) {\n          firstItem.items = children.slice(skip);\n\n          this._processSkips(firstItem.items, skips.slice(1), groupCount - 1);\n        }\n      }\n    },\n    _processTakes: function (items, skips, takes, groupCount, parents) {\n      if (!groupCount || !items) {\n        return;\n      }\n\n      parents = parents || [];\n      var lastItem = items[items.length - 1];\n      var children = lastItem && lastItem.items;\n      var take = takes[0];\n      var skip = skips[0];\n\n      if (lastItem) {\n        var maxTakeCount = lastItem.count - (lastItem.isContinuation && skip || 0) || children.length;\n\n        if (void 0 !== take && maxTakeCount > take) {\n          lastItem.isContinuationOnNextPage = true;\n          parents.forEach(function (parent) {\n            parent.isContinuationOnNextPage = true;\n          });\n\n          if (children) {\n            children = children.slice(0, take);\n            lastItem.items = children;\n          }\n        }\n\n        parents.push(lastItem);\n\n        this._processTakes(children, skips.slice(1), takes.slice(1), groupCount - 1, parents);\n      }\n    },\n    _processPaging: function (options, groupCount) {\n      this._processSkips(options.data, options.skips, groupCount);\n\n      this._processTakes(options.data, options.skips, options.takes, groupCount);\n    },\n    isLastLevelGroupItemsPagingLocal: function () {\n      return false;\n    },\n    sortLastLevelGroupItems: function (items) {\n      return items;\n    },\n    refresh: function (options, operationTypes) {\n      var that = this;\n      var dataSource = that._dataSource;\n      var storeLoadOptions = options.storeLoadOptions;\n      var group = options.group || options.storeLoadOptions.group;\n\n      var oldGroups = _uiData_grid.default.normalizeSortingInfo(that._group);\n\n      var isExpanded;\n      var groupIndex;\n\n      function handleGroup(groupInfo, parents) {\n        if (parents.length === groupIndex + 1) {\n          groupInfo.isExpanded = isExpanded;\n        }\n      }\n\n      for (groupIndex = 0; groupIndex < oldGroups.length; groupIndex++) {\n        isExpanded = isGroupExpanded(group, groupIndex);\n\n        if (isGroupExpanded(that._group, groupIndex) !== isExpanded) {\n          that.foreachGroups(handleGroup);\n        }\n      }\n\n      that.callBase.apply(this, arguments);\n\n      if (group && options.remoteOperations.paging && operationTypes.reload) {\n        return foreachExpandedGroups(that, function (groupInfo) {\n          var groupCountQuery = loadGroupTotalCount(dataSource, {\n            filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, {\n              filter: storeLoadOptions.filter,\n              group: group\n            }),\n            group: group.slice(groupInfo.path.length),\n            select: storeLoadOptions.select\n          });\n          var groupOffsetQuery = loadGroupTotalCount(dataSource, {\n            filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, {\n              filter: storeLoadOptions.filter,\n              group: group\n            }),\n            group: group.slice(groupInfo.path.length - 1, groupInfo.path.length),\n            select: storeLoadOptions.select\n          });\n          return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function (offset, count) {\n            offset = parseInt(offset.length ? offset[0] : offset);\n            count = parseInt(count.length ? count[0] : count);\n            groupInfo.offset = offset;\n\n            if (groupInfo.count !== count) {\n              groupInfo.count = count;\n              that.updateTotalItemsCount(options);\n            }\n          });\n        }, true);\n      }\n    }\n  };\n}());\n\nexports.GroupingHelper = GroupingHelper;","map":{"version":3,"sources":["C:/Users/CapiniaC/Desktop/Collection/Work/project/security/node_modules/devextreme/ui/data_grid/ui.data_grid.grouping.collapsed.js"],"names":["exports","GroupingHelper","_extend","require","_iterator","_uiData_grid","_interopRequireDefault","_uiData_gridGrouping","_uiData_grid2","_ui","_errors","_deferred","obj","__esModule","getContinuationGroupCount","groupOffset","pageSize","groupSize","groupIndex","pageOffset","Math","floor","inherit","foreachExpandedGroups","that","callback","updateGroups","foreachGroups","groupInfo","parents","isExpanded","processGroupItems","items","groupsCount","expandedInfo","path","isCustomLoading","isLastGroupExpanded","paths","count","lastCount","i","length","item","push","key","findGroupInfo","collapsedItems","slice","pop","updateGroupInfoItem","isLastGroupLevel","offset","addGroupInfo","_isGroupExpanded","updateGroupInfos","options","loadedGroupCount","parentIndex","groupCount","group","remotePaging","remoteOperations","paging","totalCount","skip","skips","isGroupExpanded","groups","getTotalOffset","groupInfos","totalOffset","childrenTotalCount","applyContinuationToGroupItem","groupLevel","expandedItemIndex","take","takes","isLastExpandedItem","isFirstExpandedItem","lastExpandedItemSkip","isItemsTruncatedByTake","isContinuation","isContinuationOnNextPage","fillSkipTakeInExpandedInfo","currentGroupCount","currentGroupIndex","isDataDeferred","data","Array","isArray","makeDataDeferred","Deferred","loadGroupItems","loadExpandedGroups","storeLoadOptions","loadLastLevelGroupItems","resolve","currentGroup","deferreds","each","loadOptions","requireTotalCount","requireGroupCount","groupSummary","filter","createGroupFilter","select","loadResult","_dataSource","loadFromStore","when","done","apply","expandedFilters","_","expandedPath","isLoadingAll","default","combineFilters","extend","sort","concat","normalizeSortingInfo","isPagingLocal","isLastLevelGroupItemsPagingLocal","extra","sortLastLevelGroupItems","index","itemCount","expandedItems","splice","fail","reject","loadGroupTotalCount","dataSource","d","isGrouping","load","isFinite","errors","Error","bind","updateTotalItemsCount","totalItemsCount","isVirtualPaging","_isVirtualPaging","callBase","_updatePagingOptions","skipChildrenTotalCount","takeCorrection","parentTakeCorrection","continuationGroupCount","skipContinuationGroupCount","groupInfoCount","childrenGroupInfoCount","unshift","min","changeRowExpand","remoteGroupPaging","groupPaging","lastLoadOptions","handleDataLoading","grouping","forEach","isLastGroup","handleDataLoadedCore","_processPaging","_processSkips","firstItem","children","_processTakes","lastItem","maxTakeCount","parent","refresh","operationTypes","oldGroups","_group","handleGroup","arguments","reload","groupCountQuery","groupOffsetQuery","createOffsetFilter","parseInt"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.collapsed.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.GroupingHelper = void 0;\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _uiData_grid = _interopRequireDefault(require(\"./ui.data_grid.core\"));\r\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\r\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\r\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\r\nvar _errors = _interopRequireDefault(require(\"../../data/errors\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction getContinuationGroupCount(groupOffset, pageSize, groupSize, groupIndex) {\r\n    groupIndex = groupIndex || 0;\r\n    if (pageSize > 1 && groupSize > 0) {\r\n        var pageOffset = groupOffset - Math.floor(groupOffset / pageSize) * pageSize || pageSize;\r\n        pageOffset += groupSize - groupIndex - 2;\r\n        if (pageOffset < 0) {\r\n            pageOffset += pageSize\r\n        }\r\n        return Math.floor(pageOffset / (pageSize - groupIndex - 1))\r\n    }\r\n    return 0\r\n}\r\nvar GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function() {\r\n    var foreachExpandedGroups = function(that, callback, updateGroups) {\r\n        return that.foreachGroups(function(groupInfo, parents) {\r\n            if (groupInfo.isExpanded) {\r\n                return callback(groupInfo, parents)\r\n            }\r\n        }, true, false, updateGroups, updateGroups)\r\n    };\r\n    var processGroupItems = function processGroupItems(that, items, groupsCount, expandedInfo, path, isCustomLoading, isLastGroupExpanded) {\r\n        var isExpanded;\r\n        expandedInfo.items = expandedInfo.items || [];\r\n        expandedInfo.paths = expandedInfo.paths || [];\r\n        expandedInfo.count = expandedInfo.count || 0;\r\n        expandedInfo.lastCount = expandedInfo.lastCount || 0;\r\n        if (!groupsCount) {\r\n            return\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            if (void 0 !== item.items) {\r\n                path.push(item.key);\r\n                if (isCustomLoading) {\r\n                    isExpanded = true\r\n                } else {\r\n                    var groupInfo = that.findGroupInfo(path);\r\n                    isExpanded = groupInfo && groupInfo.isExpanded\r\n                }\r\n                if (!isExpanded) {\r\n                    item.collapsedItems = item.items;\r\n                    item.items = null\r\n                } else {\r\n                    if (item.items) {\r\n                        processGroupItems(that, item.items, groupsCount - 1, expandedInfo, path, isCustomLoading, isLastGroupExpanded)\r\n                    } else {\r\n                        if (1 === groupsCount && item.count && (!isCustomLoading || isLastGroupExpanded)) {\r\n                            expandedInfo.items.push(item);\r\n                            expandedInfo.paths.push(path.slice(0));\r\n                            expandedInfo.count += expandedInfo.lastCount;\r\n                            expandedInfo.lastCount = item.count\r\n                        }\r\n                    }\r\n                }\r\n                path.pop()\r\n            }\r\n        }\r\n    };\r\n    var updateGroupInfoItem = function(that, item, isLastGroupLevel, path, offset) {\r\n        var groupInfo = that.findGroupInfo(path);\r\n        var count;\r\n        if (!groupInfo) {\r\n            if (isLastGroupLevel) {\r\n                count = item.count > 0 ? item.count : item.items.length\r\n            }\r\n            that.addGroupInfo({\r\n                isExpanded: that._isGroupExpanded(path.length - 1),\r\n                path: path.slice(0),\r\n                offset: offset,\r\n                count: count || 0\r\n            })\r\n        } else {\r\n            if (isLastGroupLevel) {\r\n                groupInfo.count = item.count > 0 ? item.count : item.items && item.items.length || 0\r\n            } else {\r\n                item.count = groupInfo.count || item.count\r\n            }\r\n            groupInfo.offset = offset\r\n        }\r\n    };\r\n    var updateGroupInfos = function updateGroupInfos(that, options, items, loadedGroupCount, groupIndex, path, parentIndex) {\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        var isLastGroupLevel = groupCount === loadedGroupCount;\r\n        var remotePaging = options.remoteOperations.paging;\r\n        var offset = 0;\r\n        var totalCount = 0;\r\n        var count;\r\n        groupIndex = groupIndex || 0;\r\n        path = path || [];\r\n        if (remotePaging && !parentIndex) {\r\n            offset = 0 === groupIndex ? options.skip || 0 : options.skips[groupIndex - 1] || 0\r\n        }\r\n        if (groupIndex >= loadedGroupCount) {\r\n            return items.length\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            if (item) {\r\n                path.push(item.key);\r\n                if (!item.count && !item.items || void 0 === item.items) {\r\n                    return -1\r\n                }\r\n                updateGroupInfoItem(that, item, isLastGroupLevel, path, offset + i);\r\n                count = item.items ? updateGroupInfos(that, options, item.items, loadedGroupCount, groupIndex + 1, path, i) : item.count || -1;\r\n                if (count < 0) {\r\n                    return -1\r\n                }\r\n                totalCount += count;\r\n                path.pop()\r\n            }\r\n        }\r\n        return totalCount\r\n    };\r\n    var isGroupExpanded = function(groups, groupIndex) {\r\n        return groups && groups.length && groups[groupIndex] && !!groups[groupIndex].isExpanded\r\n    };\r\n    var getTotalOffset = function(groupInfos, pageSize, offset) {\r\n        var groupSize;\r\n        var totalOffset = offset;\r\n        for (var groupIndex = 0; groupIndex < groupInfos.length; groupIndex++) {\r\n            groupSize = groupInfos[groupIndex].offset + 1;\r\n            if (groupIndex > 0) {\r\n                groupSize += groupInfos[groupIndex - 1].childrenTotalCount;\r\n                if (pageSize) {\r\n                    groupSize += getContinuationGroupCount(totalOffset, pageSize, groupSize, groupIndex - 1) * groupIndex\r\n                }\r\n            }\r\n            totalOffset += groupSize\r\n        }\r\n        return totalOffset\r\n    };\r\n\r\n    function applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex) {\r\n        var item = expandedInfo.items[expandedItemIndex];\r\n        var skip = options.skips && options.skips[groupLevel];\r\n        var take = options.takes && options.takes[groupLevel];\r\n        var isLastExpandedItem = expandedItemIndex === expandedInfo.items.length - 1;\r\n        var isFirstExpandedItem = 0 === expandedItemIndex;\r\n        var lastExpandedItemSkip = isFirstExpandedItem && skip || 0;\r\n        var isItemsTruncatedByTake = item.count > take + lastExpandedItemSkip;\r\n        if (isFirstExpandedItem && void 0 !== skip) {\r\n            item.isContinuation = true\r\n        }\r\n        if (isLastExpandedItem && void 0 !== take && isItemsTruncatedByTake) {\r\n            item.isContinuationOnNextPage = true\r\n        }\r\n    }\r\n\r\n    function fillSkipTakeInExpandedInfo(options, expandedInfo, currentGroupCount) {\r\n        var currentGroupIndex = currentGroupCount - 1;\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        expandedInfo.skip = options.skips && options.skips[currentGroupIndex];\r\n        if (options.takes && void 0 !== options.takes[currentGroupIndex]) {\r\n            if (groupCount === currentGroupCount) {\r\n                expandedInfo.take = expandedInfo.count ? expandedInfo.count - (expandedInfo.skip || 0) : 0\r\n            } else {\r\n                expandedInfo.take = 0\r\n            }\r\n            expandedInfo.take += options.takes[currentGroupIndex]\r\n        }\r\n    }\r\n\r\n    function isDataDeferred(data) {\r\n        return !Array.isArray(data)\r\n    }\r\n\r\n    function makeDataDeferred(options) {\r\n        if (!isDataDeferred(options.data)) {\r\n            options.data = new _deferred.Deferred\r\n        }\r\n    }\r\n\r\n    function loadGroupItems(that, options, loadedGroupCount, expandedInfo, groupLevel, data) {\r\n        if (!options.isCustomLoading) {\r\n            expandedInfo = {};\r\n            processGroupItems(that, data, loadedGroupCount, expandedInfo, []);\r\n            fillSkipTakeInExpandedInfo(options, expandedInfo, loadedGroupCount)\r\n        }\r\n        var groupCount = options.group ? options.group.length : 0;\r\n        if (expandedInfo.paths.length && groupCount - loadedGroupCount > 0) {\r\n            makeDataDeferred(options);\r\n            loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data)\r\n        } else {\r\n            if (expandedInfo.paths.length && options.storeLoadOptions.group) {\r\n                makeDataDeferred(options);\r\n                loadLastLevelGroupItems(that, options, expandedInfo, data)\r\n            } else {\r\n                if (isDataDeferred(options.data)) {\r\n                    options.data.resolve(data)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data) {\r\n        var groups = options.group || [];\r\n        var currentGroup = groups[groupLevel + 1];\r\n        var deferreds = [];\r\n        (0, _iterator.each)(expandedInfo.paths, function(expandedItemIndex) {\r\n            var loadOptions = {\r\n                requireTotalCount: false,\r\n                requireGroupCount: true,\r\n                group: [currentGroup],\r\n                groupSummary: options.storeLoadOptions.groupSummary,\r\n                filter: (0, _uiData_grid2.createGroupFilter)(expandedInfo.paths[expandedItemIndex], {\r\n                    filter: options.storeLoadOptions.filter,\r\n                    group: groups\r\n                }),\r\n                select: options.storeLoadOptions.select\r\n            };\r\n            if (0 === expandedItemIndex) {\r\n                loadOptions.skip = expandedInfo.skip || 0\r\n            }\r\n            if (expandedItemIndex === expandedInfo.paths.length - 1) {\r\n                loadOptions.take = expandedInfo.take\r\n            }\r\n            var loadResult = 0 === loadOptions.take ? [] : that._dataSource.loadFromStore(loadOptions);\r\n            (0, _deferred.when)(loadResult).done(function(data) {\r\n                var item = expandedInfo.items[expandedItemIndex];\r\n                applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex);\r\n                item.items = data\r\n            });\r\n            deferreds.push(loadResult)\r\n        });\r\n        _deferred.when.apply(null, deferreds).done(function() {\r\n            updateGroupInfos(that, options, data, loadedGroupCount + 1);\r\n            loadGroupItems(that, options, loadedGroupCount + 1, expandedInfo, groupLevel + 1, data)\r\n        })\r\n    }\r\n\r\n    function loadLastLevelGroupItems(that, options, expandedInfo, data) {\r\n        var expandedFilters = [];\r\n        var groups = options.group || [];\r\n        (0, _iterator.each)(expandedInfo.paths, function(_, expandedPath) {\r\n            expandedFilters.push((0, _uiData_grid2.createGroupFilter)(expandedPath, {\r\n                group: options.isCustomLoading ? options.storeLoadOptions.group : groups\r\n            }))\r\n        });\r\n        var filter = options.storeLoadOptions.filter;\r\n        if (!options.storeLoadOptions.isLoadingAll) {\r\n            filter = _uiData_grid.default.combineFilters([filter, _uiData_grid.default.combineFilters(expandedFilters, \"or\")])\r\n        }\r\n        var loadOptions = (0, _extend.extend)({}, options.storeLoadOptions, {\r\n            requireTotalCount: false,\r\n            requireGroupCount: false,\r\n            group: null,\r\n            sort: groups.concat(_uiData_grid.default.normalizeSortingInfo(options.storeLoadOptions.sort || [])),\r\n            filter: filter\r\n        });\r\n        var isPagingLocal = that._dataSource.isLastLevelGroupItemsPagingLocal();\r\n        if (!isPagingLocal) {\r\n            loadOptions.skip = expandedInfo.skip;\r\n            loadOptions.take = expandedInfo.take\r\n        }(0, _deferred.when)(0 === expandedInfo.take ? [] : that._dataSource.loadFromStore(loadOptions)).done(function(items, extra) {\r\n            if (isPagingLocal) {\r\n                items = that._dataSource.sortLastLevelGroupItems(items, groups, expandedInfo.paths);\r\n                items = expandedInfo.skip ? items.slice(expandedInfo.skip) : items;\r\n                items = expandedInfo.take ? items.slice(0, expandedInfo.take) : items\r\n            }(0, _iterator.each)(expandedInfo.items, function(index, item) {\r\n                var itemCount = item.count - (0 === index && expandedInfo.skip || 0);\r\n                var expandedItems = items.splice(0, itemCount);\r\n                applyContinuationToGroupItem(options, expandedInfo, groups.length - 1, index);\r\n                item.items = expandedItems\r\n            });\r\n            options.data.resolve(data)\r\n        }).fail(options.data.reject)\r\n    }\r\n    var loadGroupTotalCount = function(dataSource, options) {\r\n        var d = new _deferred.Deferred;\r\n        var isGrouping = !!(options.group && options.group.length);\r\n        var loadOptions = (0, _extend.extend)({\r\n            skip: 0,\r\n            take: 1,\r\n            requireGroupCount: isGrouping,\r\n            requireTotalCount: !isGrouping\r\n        }, options, {\r\n            group: isGrouping ? options.group : null\r\n        });\r\n        dataSource.load(loadOptions).done(function(data, extra) {\r\n            var count = extra && (isGrouping ? extra.groupCount : extra.totalCount);\r\n            if (!isFinite(count)) {\r\n                d.reject(_errors.default.errors.Error(isGrouping ? \"E4022\" : \"E4021\"));\r\n                return\r\n            }\r\n            d.resolve(count)\r\n        }).fail(d.reject.bind(d));\r\n        return d\r\n    };\r\n    return {\r\n        updateTotalItemsCount: function(options) {\r\n            var totalItemsCount = 0;\r\n            var totalCount = options.extra && options.extra.totalCount || 0;\r\n            var groupCount = options.extra && options.extra.groupCount || 0;\r\n            var pageSize = this._dataSource.pageSize();\r\n            var isVirtualPaging = this._isVirtualPaging();\r\n            foreachExpandedGroups(this, function(groupInfo) {\r\n                groupInfo.childrenTotalCount = 0\r\n            });\r\n            foreachExpandedGroups(this, function(groupInfo, parents) {\r\n                var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, totalItemsCount);\r\n                var count = groupInfo.count + groupInfo.childrenTotalCount;\r\n                if (!isVirtualPaging) {\r\n                    count += getContinuationGroupCount(totalOffset, pageSize, count, parents.length - 1)\r\n                }\r\n                if (parents[parents.length - 2]) {\r\n                    parents[parents.length - 2].childrenTotalCount += count\r\n                } else {\r\n                    totalItemsCount += count\r\n                }\r\n            });\r\n            this.callBase(totalItemsCount - totalCount + groupCount)\r\n        },\r\n        _isGroupExpanded: function(groupIndex) {\r\n            var groups = this._dataSource.group();\r\n            return isGroupExpanded(groups, groupIndex)\r\n        },\r\n        _updatePagingOptions: function(options, callback) {\r\n            var that = this;\r\n            var isVirtualPaging = that._isVirtualPaging();\r\n            var pageSize = that._dataSource.pageSize();\r\n            var skips = [];\r\n            var takes = [];\r\n            var skipChildrenTotalCount = 0;\r\n            var childrenTotalCount = 0;\r\n            if (options.take) {\r\n                foreachExpandedGroups(this, function(groupInfo) {\r\n                    groupInfo.childrenTotalCount = 0;\r\n                    groupInfo.skipChildrenTotalCount = 0\r\n                });\r\n                foreachExpandedGroups(that, function(groupInfo, parents) {\r\n                    var take;\r\n                    var takeCorrection = 0;\r\n                    var parentTakeCorrection = 0;\r\n                    var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, childrenTotalCount);\r\n                    var continuationGroupCount = 0;\r\n                    var skipContinuationGroupCount = 0;\r\n                    var groupInfoCount = groupInfo.count + groupInfo.childrenTotalCount;\r\n                    var childrenGroupInfoCount = groupInfoCount;\r\n                    callback && callback(groupInfo, totalOffset);\r\n                    var skip = options.skip - totalOffset;\r\n                    if (totalOffset <= options.skip + options.take && groupInfoCount) {\r\n                        take = options.take;\r\n                        if (!isVirtualPaging) {\r\n                            continuationGroupCount = getContinuationGroupCount(totalOffset, pageSize, groupInfoCount, parents.length - 1);\r\n                            groupInfoCount += continuationGroupCount * parents.length;\r\n                            childrenGroupInfoCount += continuationGroupCount;\r\n                            if (pageSize && skip >= 0) {\r\n                                takeCorrection = parents.length;\r\n                                parentTakeCorrection = parents.length - 1;\r\n                                skipContinuationGroupCount = Math.floor(skip / pageSize)\r\n                            }\r\n                        }\r\n                        if (skip >= 0) {\r\n                            if (totalOffset + groupInfoCount > options.skip) {\r\n                                skips.unshift(skip - skipContinuationGroupCount * takeCorrection - groupInfo.skipChildrenTotalCount)\r\n                            }\r\n                            if (totalOffset + groupInfoCount >= options.skip + take) {\r\n                                takes.unshift(take - takeCorrection - groupInfo.childrenTotalCount + groupInfo.skipChildrenTotalCount)\r\n                            }\r\n                        } else {\r\n                            if (totalOffset + groupInfoCount >= options.skip + take) {\r\n                                takes.unshift(take + skip - groupInfo.childrenTotalCount)\r\n                            }\r\n                        }\r\n                    }\r\n                    if (totalOffset <= options.skip) {\r\n                        if (parents[parents.length - 2]) {\r\n                            parents[parents.length - 2].skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1 - skipContinuationGroupCount * parentTakeCorrection)\r\n                        } else {\r\n                            skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1)\r\n                        }\r\n                    }\r\n                    if (totalOffset <= options.skip + take) {\r\n                        groupInfoCount = Math.min(childrenGroupInfoCount, skip + take - (skipContinuationGroupCount + 1) * parentTakeCorrection);\r\n                        if (parents[parents.length - 2]) {\r\n                            parents[parents.length - 2].childrenTotalCount += groupInfoCount\r\n                        } else {\r\n                            childrenTotalCount += groupInfoCount\r\n                        }\r\n                    }\r\n                });\r\n                options.skip -= skipChildrenTotalCount;\r\n                options.take -= childrenTotalCount - skipChildrenTotalCount\r\n            }\r\n            options.skips = skips;\r\n            options.takes = takes\r\n        },\r\n        changeRowExpand: function(path) {\r\n            var that = this;\r\n            var groupInfo = that.findGroupInfo(path);\r\n            var dataSource = that._dataSource;\r\n            var remoteGroupPaging = dataSource.remoteOperations().groupPaging;\r\n            var groups = _uiData_grid.default.normalizeSortingInfo(dataSource.group());\r\n            if (groupInfo) {\r\n                groupInfo.isExpanded = !groupInfo.isExpanded;\r\n                if (remoteGroupPaging && groupInfo.isExpanded && path.length < groups.length) {\r\n                    return loadGroupTotalCount(dataSource, {\r\n                        filter: (0, _uiData_grid2.createGroupFilter)(path, {\r\n                            filter: dataSource.lastLoadOptions().filter,\r\n                            group: dataSource.group()\r\n                        }),\r\n                        group: [groups[path.length]],\r\n                        select: dataSource.select()\r\n                    }).done(function(groupCount) {\r\n                        groupInfo.count = groupCount\r\n                    })\r\n                }\r\n                return (new _deferred.Deferred).resolve()\r\n            }\r\n            return (new _deferred.Deferred).reject()\r\n        },\r\n        handleDataLoading: function(options) {\r\n            var that = this;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var groups = _uiData_grid.default.normalizeSortingInfo(storeLoadOptions.group || options.loadOptions.group);\r\n            if (options.isCustomLoading || !groups.length) {\r\n                return\r\n            }\r\n            if (options.remoteOperations.grouping) {\r\n                var remotePaging = that._dataSource.remoteOperations().paging;\r\n                storeLoadOptions.group = _uiData_grid.default.normalizeSortingInfo(storeLoadOptions.group);\r\n                storeLoadOptions.group.forEach(function(group, index) {\r\n                    var isLastGroup = index === storeLoadOptions.group.length - 1;\r\n                    group.isExpanded = !remotePaging || !isLastGroup\r\n                })\r\n            }\r\n            options.group = options.group || groups;\r\n            if (options.remoteOperations.paging) {\r\n                options.skip = storeLoadOptions.skip;\r\n                options.take = storeLoadOptions.take;\r\n                storeLoadOptions.requireGroupCount = true;\r\n                storeLoadOptions.group = groups.slice(0, 1);\r\n                that._updatePagingOptions(options);\r\n                storeLoadOptions.skip = options.skip;\r\n                storeLoadOptions.take = options.take\r\n            }\r\n        },\r\n        handleDataLoadedCore: function(options, callBase) {\r\n            var that = this;\r\n            var loadedGroupCount = _uiData_grid.default.normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group).length;\r\n            var groupCount = options.group ? options.group.length : 0;\r\n            var totalCount;\r\n            var expandedInfo = {};\r\n            if (options.isCustomLoading) {\r\n                callBase(options);\r\n                processGroupItems(that, options.data, loadedGroupCount, expandedInfo, [], options.isCustomLoading, options.storeLoadOptions.isLoadingAll)\r\n            } else {\r\n                if (!options.remoteOperations.paging) {\r\n                    that.foreachGroups(function(groupInfo) {\r\n                        groupInfo.count = 0\r\n                    })\r\n                }\r\n                totalCount = updateGroupInfos(that, options, options.data, loadedGroupCount);\r\n                if (totalCount < 0) {\r\n                    options.data = (new _deferred.Deferred).reject(_ui.default.Error(\"E1037\"));\r\n                    return\r\n                }\r\n                if (!options.remoteOperations.paging) {\r\n                    if (loadedGroupCount && options.extra && options.loadOptions.requireTotalCount) {\r\n                        options.extra.totalCount = totalCount;\r\n                        options.extra.groupCount = options.data.length\r\n                    }\r\n                }\r\n                if (groupCount && options.storeLoadOptions.requireGroupCount && !isFinite(options.extra.groupCount)) {\r\n                    options.data = (new _deferred.Deferred).reject(_errors.default.errors.Error(\"E4022\"));\r\n                    return\r\n                }\r\n                that.updateTotalItemsCount(options);\r\n                if (!options.remoteOperations.paging) {\r\n                    that._updatePagingOptions(options)\r\n                }\r\n                callBase(options);\r\n                if (!options.remoteOperations.paging) {\r\n                    that._processPaging(options, loadedGroupCount)\r\n                }\r\n            }\r\n            loadGroupItems(that, options, loadedGroupCount, expandedInfo, 0, options.data)\r\n        },\r\n        _processSkips: function(items, skips, groupCount) {\r\n            if (!groupCount) {\r\n                return\r\n            }\r\n            var firstItem = items[0];\r\n            var skip = skips[0];\r\n            var children = firstItem && firstItem.items;\r\n            if (void 0 !== skip) {\r\n                firstItem.isContinuation = true;\r\n                if (children) {\r\n                    firstItem.items = children.slice(skip);\r\n                    this._processSkips(firstItem.items, skips.slice(1), groupCount - 1)\r\n                }\r\n            }\r\n        },\r\n        _processTakes: function(items, skips, takes, groupCount, parents) {\r\n            if (!groupCount || !items) {\r\n                return\r\n            }\r\n            parents = parents || [];\r\n            var lastItem = items[items.length - 1];\r\n            var children = lastItem && lastItem.items;\r\n            var take = takes[0];\r\n            var skip = skips[0];\r\n            if (lastItem) {\r\n                var maxTakeCount = lastItem.count - (lastItem.isContinuation && skip || 0) || children.length;\r\n                if (void 0 !== take && maxTakeCount > take) {\r\n                    lastItem.isContinuationOnNextPage = true;\r\n                    parents.forEach(function(parent) {\r\n                        parent.isContinuationOnNextPage = true\r\n                    });\r\n                    if (children) {\r\n                        children = children.slice(0, take);\r\n                        lastItem.items = children\r\n                    }\r\n                }\r\n                parents.push(lastItem);\r\n                this._processTakes(children, skips.slice(1), takes.slice(1), groupCount - 1, parents)\r\n            }\r\n        },\r\n        _processPaging: function(options, groupCount) {\r\n            this._processSkips(options.data, options.skips, groupCount);\r\n            this._processTakes(options.data, options.skips, options.takes, groupCount)\r\n        },\r\n        isLastLevelGroupItemsPagingLocal: function() {\r\n            return false\r\n        },\r\n        sortLastLevelGroupItems: function(items) {\r\n            return items\r\n        },\r\n        refresh: function(options, operationTypes) {\r\n            var that = this;\r\n            var dataSource = that._dataSource;\r\n            var storeLoadOptions = options.storeLoadOptions;\r\n            var group = options.group || options.storeLoadOptions.group;\r\n            var oldGroups = _uiData_grid.default.normalizeSortingInfo(that._group);\r\n            var isExpanded;\r\n            var groupIndex;\r\n\r\n            function handleGroup(groupInfo, parents) {\r\n                if (parents.length === groupIndex + 1) {\r\n                    groupInfo.isExpanded = isExpanded\r\n                }\r\n            }\r\n            for (groupIndex = 0; groupIndex < oldGroups.length; groupIndex++) {\r\n                isExpanded = isGroupExpanded(group, groupIndex);\r\n                if (isGroupExpanded(that._group, groupIndex) !== isExpanded) {\r\n                    that.foreachGroups(handleGroup)\r\n                }\r\n            }\r\n            that.callBase.apply(this, arguments);\r\n            if (group && options.remoteOperations.paging && operationTypes.reload) {\r\n                return foreachExpandedGroups(that, function(groupInfo) {\r\n                    var groupCountQuery = loadGroupTotalCount(dataSource, {\r\n                        filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, {\r\n                            filter: storeLoadOptions.filter,\r\n                            group: group\r\n                        }),\r\n                        group: group.slice(groupInfo.path.length),\r\n                        select: storeLoadOptions.select\r\n                    });\r\n                    var groupOffsetQuery = loadGroupTotalCount(dataSource, {\r\n                        filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, {\r\n                            filter: storeLoadOptions.filter,\r\n                            group: group\r\n                        }),\r\n                        group: group.slice(groupInfo.path.length - 1, groupInfo.path.length),\r\n                        select: storeLoadOptions.select\r\n                    });\r\n                    return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function(offset, count) {\r\n                        offset = parseInt(offset.length ? offset[0] : offset);\r\n                        count = parseInt(count.length ? count[0] : count);\r\n                        groupInfo.offset = offset;\r\n                        if (groupInfo.count !== count) {\r\n                            groupInfo.count = count;\r\n                            that.updateTotalItemsCount(options)\r\n                        }\r\n                    })\r\n                }, true)\r\n            }\r\n        }\r\n    }\r\n}());\r\nexports.GroupingHelper = GroupingHelper;\r\n"]},"metadata":{},"sourceType":"script"}